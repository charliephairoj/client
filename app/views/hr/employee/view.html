<div class="employee-view-page">
    
    
    <div class="workspace">
			
		<md-toolbar layout="row" layout-align="center center" md-scroll-shrink="true">
			<h3><span>Employees</span></h3>
			<div flex >
			</div>
			<md-button class="md-icon-button md-raised md-accent" ng-show="currentUser.hasPermission('add_employee')" ng-click="showAddEmployee()">
				<md-tooltip>Create Employee</md-tooltip>
				<i class="material-icons">add</i>
			</md-button>
		<md-button class="md-icon-button" ng-click="upload()" ng-disabled="!currentUser.hasModule('hr')">
				<md-tooltip>Upload Clockin Times</md-tooltip>
				<i class="material-icons">file_upload</i>
			</md-button>  
			<div layout="row" layout-align="end center">
				<input class="search" type="text" ng-model="query" />
			</div>
			
		</md-toolbar>
			
		<md-content on-scroll-end="loadNext()">
			<md-card class="employee" ng-class="[employee.status, {'selected': active}]" ng-repeat="employee in employees | filter:search:strict | filter:query track by employee.id" ng-init="active=false" file-drop="addImage($files, employee)" file-drop-class="employee-drag-active">
				<div class="drop-container-text">
					<h2>Drop Image Here</h2>
				</div>
				<md-card-title layout="row" layout-align="center center" flex="nogrow">
					<div class="click-container" ng-click="active=!active" flex layout="row">
						<md-card-title-media flex="nogrow">
							<div class="md-media-sm card-media">
								<i class="material-icons" ng-hide="employee.image.url">account_box</i>
								<img ng-src="{{employee.image.url}}" ng-show="employee.image.url">
							</div>
						</md-card-title-media>
						<md-card-title-text flex="nogrow">
							<h3>{{employee.name}}</h3>
							<h4>{{employee.department}}</h4>
						</md-card-title-text>
						<div flex></div>
					</div>
					<md-button class="md-accent md-icon-button md-raised" ng-if="active" ng-click="update(employee)"
						ng-disabled="employee.$$saving">
						<md-tooltip>บันทึกข้อมูล/Save {{employee.name}}</md-tooltip>
						<i class="material-icons">save</i>
					</md-button>
					<md-button class="md-warn md-icon-button md-raised" ng-if="::currentUser.hasPermission('delete_employee')">
						<md-tooltip>ลบพนักงาน/Delete {{employee.name}}</md-tooltip>
						<i class="material-icons">remove</i>
					</md-button>
					<md-button class="md-icon-button expand" ng-if="!active" ng-click="active=true">
						<md-tooltip>Expand</md-tooltip>
						<i class="material-icons">expand_more</i>
					</md-button>
					<md-button class="md-icon-button minimize" ng-if="active" ng-click="active=false">
						<md-tooltip>Minimize</md-tooltip>
						<i class="material-icons">expand_less</i>
					</md-button>
				</md-card-title>
				
				<md-card-content flex="grow" ng-if="active">
					<div class="employee-info" layout="row" layout-align="start start">
						<md-input-container ng-disabled="!currentUser.hasPermission('change_employee')" flex="20">
							<label>Title</label>
							<input type="text" ng-model="employee.title" />
						</md-input-container>
						<md-input-container ng-disabled="!currentUser.hasPermission('change_employee')" flex="40">
							<label>ชื่อ/Name</label>
							<input type="text" ng-model="employee.name" />
						</md-input-container>
						<md-input-container ng-disabled="!currentUser.hasPermission('change_employee')">
							<label>Status</label>
							<md-select ng-model="employee.status">
								<md-option value='active'>Active</md-option>
								<md-option value='probation'>Probation</md-option>
								<md-option value='fired'>Fired</md-option>
								<md-option value='quit'>Quit</md-option>
							</md-select>
						</md-input-container>
					</div>
					<div class="employee-info" layout="row" layout-align="start start">
						<md-input-container ng-disabled="!currentUser.hasPermission('change_employee')" flex="30">
							<label>National ID/Passport ID</label>
							<input type="text" ng-model="employee.government_id" />
						</md-input-container>
						<md-input-container ng-disabled="!currentUser.hasPermission('change_employee')">
							<label>แผนก/Department</label>
							<md-select ng-model="employee.department">
								<md-option value='woodworking'>ไม้/Woodworking</md-option>
								<md-option value='painting'>สี/Painting</md-option>
								<md-option value='polishing'>ปัดเงา/Polishing</md-option>
								<md-option value='packing'>Packing</md-option>
								<md-option value='upholstery'>หุ้ม/Upholstery</md-option>
								<md-option value='sewing'>เย็บ/Sewing</md-option>
								<md-option value='cutting fabric'>ตัดผ้า/Cutting Fabric</md-option>
								<md-option value='foam'>ฟองน้ำ/Foam</md-option>
								<md-option value='housekeeping'>แม่บ้าน/Housekeeping</md-option>
								<md-option value='accounting'>บัญชี/Accounting</md-option>
								<md-option value='office'>Office</md-option>
								<md-option value='graphic'>Graphic</md-option>
								<md-option value='management'>Management</md-option>
								<md-option value='dyeing'>ย้อม/Dyeing</md-option>
								<md-option value='carpet installation'>ตกแต่งพรม/Carpet Installation</md-option>
								<md-option value='security'>ยาม/Security</md-option>
								<md-option value='technician'>ช่าง/Technician</md-option>
								<md-option value='inventory'>สโตร์/Inventory</md-option>
							</md-select>
						</md-input-container>
						<md-input-container>
							<label>Company</label>
							<md-select ng-model="employee.company" required>
								<md-option value='dellarobbia'>Dellarobbia</md-option>
								<md-option value='pci'>Pacific Carpet</md-option>
							</md-select>
						</md-input-container>
						<md-input-container>
							<label>Location</label>
							<md-select ng-model="employee.location">
								<md-option value='thailand'>Thailand</md-option>
								<md-option value='cambodia'>Cambodia</md-option>
							</md-select>
						</md-input-container>
					</div>
					<div class="employee-info" layout="row">
						<md-input-container>
							<label>Card Number</label>
							<input type="text" ng-model="employee.card_id" />
						</md-input-container>
						<md-input-container>
							<label>Bank</label>
							<md-select ng-model="employee.bank">
								<md-option value="thanachart">Thanachart</md-option>
								<md-option value="kasikorn">Kasikorn</md-option>
								<md-option value="bangkok bank">Bangkok Bank</md-option>
								<md-option value="SCB">SCB</md-option>
								<md-option value="krungsri">Krungsri</md-option>
								<md-option value="khrung thai bank">Khrung Thai Bank</md-option>
							</md-select>
						</md-input-container>
						<md-input-container>
							<label>Bank Account Number</label>
							<input type="text" ng-model="employee.account_number">
						
					</div>
					<div class="employee-info" layout="row">
						<md-input-container>
							<label>สัญชาติ/Nationality</label>
							<md-select ng-model="employee.nationality">
								<md-option value='thai'>ไทย/Thai</md-option>
								<md-option value='cambodian'>กัมพูชา/Cambodian</md-option>
								<md-option value='burmese'>พม่า/Burmese</md-option>
								<md-option value='laos'>ลาว/Laos</md-option>
								<md-option value='vietnam'>เวียตนาม/Vietnam</md-option>
							</md-select>
						</md-input-container>
						
						
						<md-input-container>
					    	<label>Shift Schedule</label>
							<md-select ng-model="employee.shift" ng-model-options="{trackBy: '$value.id'}">
								<md-option ng-value="shift" ng-repeat="shift in shifts">{{shift.start_time + ' - ' + shift.end_time}}</md-option>
							</md-select>
						</md-input-container>
					</div>
					<div class="employee-info" layout="row">
						<md-input-container>
							<label>ประเภทการจ่ายเงิน/Payment Type</label>
							<md-select ng-model="employee.pay_period">
								<md-option value='daily'>รายวัน/Daily</md-option>
								<md-option value='monthly'>รายเดือน/Monthly</md-option>
							</md-select>
						</md-input-container>
						<md-input-container ng-if="currentUser.hasPermission('can_view_pay_rate')">
							<label>Pay Rate</label>
							<input type="text" number-formatter ng-model-options="{ updateOn: 'blur' }" ng-model="employee.wage" />
						</md-input-container>
						<md-input-container>
							<label>เบี้ยขยัน/Stipend</label>
							<input type="text" number-formatter ng-model-options="{ updateOn: 'blur' }" ng-model="employee.incentive_pay" />
						</md-input-container>
						<md-input-container>
							<label>ตำแหน่ง/Manager's Stipend</label>
							<input type="text" number-formatter ng-model-options="{ updateOn: 'blur' }" ng-model="employee.manager_stipend" />
						</md-input-container>
						<md-input-container>
							<label>Payment Option</label>
							<md-select ng-model="employee.payment_option">
								<md-option value='cash'>เงินสด/Cash</md-option>
								<md-option value='direct deposit'>โอนเข้าธนาคาร/Direct Deposit</md-option>
							</md-select>
						</md-input-container>
					</div>
					
					<section class="attendances">
						<subheader class="md-primary"><span>Attendances</span></subheader>
						<div layout="row">
							<md-datepicker ng-model="start_date" md-placeholder="FROM" ng-change="retrieveAttendances(start_date, end_date, employee)"></md-datepicker>
							<md-datepicker ng-model="end_date" md-placeholder="TO" ng-change="retrieveAttendances(start_date, end_date, employee)"></md-datepicker>
							<div flex></div>
							<md-button class="md-raised md-accent" ng-click="addAttendance(employee)">
								Add Attendance
							</md-button>
						</div>
						<md-card class="attendance-container" layout="column" ng-if="active && employee.attendances.length">
						
							<md-card-title class="title">
								<h4 class="date">Date</h4>
								<h4 class="clockin">Clockin</h4>
								<h4 class="clockout">Clockout</h4>
								<h4 class="regular-time">Regular Time</h4>
								<h4 class="overtime">Overtime</h4>
								<h4 class="enable-overtime">Overtime</h4>
								<h4 class="lunch">Lunch</h4>
								<h4 class="sick">Sick Leave</h4>
								<h4 class="vacation">Vacation</h4>
							</md-card-title>
							<md-card-content>
								<div class="attendance" ng-class="{'sunday': isSunday(a)}" ng-repeat="a in employee.attendances | orderBy:'date'">
									<h4 class="col date">{{::a.date | date:'dd/MM/yyyy'}}</h4>
									<h4 class="col clockin">{{::a.start_time | date:'hh:mm:ss a'}}</h4>
									<h4 class="col clockout">{{::a.end_time | date:'hh:mm:ss a'}}</h4>
									<h4 class="col regular-time">{{a.regular_time}}</h4>
									<h4 class="col overtime">{{a.overtime}}</h4>
									<div class="col enable-overtime">
										<md-switch ng-model="a.enable_overtime" ng-change="updateAttendance(a)">
									</div>
									<div class="col lunch">
										<md-switch ng-model="a.receive_lunch_overtime" ng-change="updateAttendance(a)">
									</div>
									<div class="col sick">
										<md-switch ng-model="a.sick_leave" ng-change="updateAttendance(a)">
									</div>
									<div class="col vacation">
										<md-switch ng-model="a.vacation" ng-change="updateAttendance(a)">
									</div>
									
							</md-card-content>
						</md-card>
					</section>
				</md-card-content>
				<md-card-actions ng-show="employee.$active" layout="row" layout-align="end center">
					<md-button class="md-icon-button md-accent" ng-show="currentUser.hasPermission('change_employee')" ng-click="save(employee)">
						<md-tooltip>Save</md-tooltip>
						<i class="material-icons">save</i>
					</md-button>
				</md-card-actions>
			</md-card>
		</md-content>
        
    </div>
    
</div>