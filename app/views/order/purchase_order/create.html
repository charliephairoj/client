<div class="create-po-page">
    
    
    <!--
        Forms
    -->
	
    
	
    <form class="po" name="poForm" novalidate>
      
        
        
        
		
        <!--
            Workspace
        -->
			
        <div class="workspace">
			
			<md-toolbar layout="row" class="md-primary" layout-align="center center" md-scroll-shrink="true">
				<h3><span>Open a Purchase Order</span></h3>
				<div flex></div>
            	<md-button class="md-icon-button md-accent md-raised" id="po-create" ng-click="create()" ng-disabled="po.id">
					<md-tooltip>
						Create
					</md-tooltip>
					<i class="material-icons">create</i>				
				</md-button>
            	<md-button class="md-icon-button md-warn md-raised" href="#/order/purchase_order">
					<md-tooltip>
					    Cancel
					</md-tooltip>
					<i class="material-icons">clear</i>
				</md-button>
			</md-toolbar>
			
			<md-content layout="column" layout-align="start center">
				<section>
					<md-subheader class="md-primary">Order</md-subheader>
					<md-card style="width:90%;" layout="column">
						<md-card-content>
				            <div class="supplier">				
								<div class='info'>
									<md-autocomplete flex="noshrink" required 
										name='supplier'
										md-items="supplier in searchSuppliers(supplierSearchText)" 
										md-selected-item="selectedSupplier"
										md-selected-item-change="addSupplier(selectedSupplier)"
										md-search-text="supplierSearchText"
										md-search-text-change="updateSupplierName(supplierSearchText); retrieveSuppliers(supplierSearchText)"
										md-item-text="supplier.name"
										md-floating-label="Supplier Name"
										md-no-cache="true"
										md-min-length="0">
									    <md-item-template>
									    	<span md-highlight-text="supplierSearchText">{{supplier.name}}</span>
									    </md-item-template>
										<div ng-messages="poForm.supplier.$error">
											<div class="hint" ng-message="true">Starting typing to search or just type the name...</div>
										</div>
									</md-autocomplete>
									<md-input-container>
									  <label>Telephone</label>
									  <md-icon md-font-icon="material-icons">phone</md-icon>
									  <input type="text" ng-model="po.supplier.telephone">
							          <div class="hint">How do we contact them?</div>
							  
									</md-input-container>
									<md-input-container>
									  <label>Fax</label>
									  <md-icon md-font-icon="material-icons">receipt</md-icon>
									  <input type="text" ng-model="po.supplier.fax">
							          <div class="hint">How do we send them an order?</div>
							  
									</md-input-container>
									<md-input-container>
									  <label>Email</label>
									  <md-icon md-font-icon="material-icons">email</md-icon>
									  <input type="text" ng-model="po.supplier.email">
							          <div class="hint">How do we send them messages?</div>
							  
									</md-input-container>
								</div>
			
								<div class="address">
									<md-input-container flex="noshrink">
									  <label>Address</label>
									  <input type="text" ng-model="po.supplier.addresses[0].address1">
									</md-input-container>
									<md-input-container>
									  <label>City</label>
									  <input type="text" ng-model="po.supplier.addresses[0].city">
									</md-input-container>
									<md-input-container>
									  <label>Territory</label>
									  <input type="text" ng-model="po.supplier.addresses[0].territory">
									</md-input-container>
									<md-input-container>
									  <label>Country</label>
									  <input type="text" ng-model="po.supplier.addresses[0].country">
									</md-input-container>
									<md-input-container>
									  <label>Zipcode</label>
									  <input type="text" ng-model="po.supplier.poaddresses[0].zipcode">
									</md-input-container>
								</div>
				            </div>
        
				            <div class="order">
								<div class='details' layout="row" layout="start center">
									<div class="date-container" layout="column">
										<md-datepicker name="dateField" ng-model="po.receive_date" md-placeholder="Receive Date" required>
										</md-datepicker>
							            <div class="hint">When will we receive?</div>
									</div>
									<md-input-container>
								        <label>Currency</label>
								        <md-select ng-model="po.currency" required>
											<md-option ng-value="'THB'">Thai Baht</md-option>
											<md-option ng-value="'USD'">US Dollar</md-option>
											<md-option ng-value="'EUR'">Euro</md-option>
											<md-option ng-value="'RMB'">Renminbi</md-option>
								        </md-select>
										<div ng-messages="poForm.currency.$error" multiple>
											<div ng-message-exp="'required'">This is required</div>
										</div>
								    </md-input-container>
									<md-input-container flex="shrink">
								        <label>Terms</label>
									  	<input name="terms" type="number" ng-model="po.terms" required min="0" max="180">								  
										<div ng-messages="poForm.terms.$error" multiple>
											<div ng-message-exp="'required'">This is required</div>
											<div ng-message-exp="'max'">That's too many days!</div>
										</div>
								    </md-input-container>
									<md-input-container>
								        <label>Discount</label>
									  	<input name="discount" type="number" ng-model="po.discount" required max="60">								  
										<div ng-messages="poForm.discount.$error" multiple>
											<div ng-message-exp="'required'">This is required</div>
											<div ng-message-exp="'max'">Don't you think that's too generous?</div>
										</div>
								    </md-input-container>
									<md-input-container flex="shrink">
									  	<label>Vat (%)</label>
									  	<input name="vat" type="number" ng-model="po.vat" required max="10">								  
										<div ng-messages="poForm.vat.$error" multiple>
											<div ng-message-exp="'required'">This is required</div>
											<div ng-message-exp="'max'">That's too much vat!</div>
										</div>
						            	<div class="hint">How much is the government taking?</div>
									</md-input-container>							
								</div>
					
								<div class="details-2" layout="row" layout="start center">
									<md-input-container>
									  	<label>Deposit</label>
									  	<input name="deposit" type="number" ng-model="po.deposit">								  
										<div ng-messages="poForm.deposit.$error" multiple>
										</div>
						            	<div class="hint">How much to get work started?</div>
									</md-input-container>
									<md-input-container>
									  	<label>Remarks</label>
									  	<md-icon md-font-icon="material-icons">comment</md-icon>
								
										<textarea ng-model="po.comments"></textarea>
							            <div class="hint">Any other details?</div>
								
									</md-input-container>
								</div>
		
								<div class="project" layout="row" layout-align="start start">
										<md-autocomplete flex="noshrink" required 
											md-items="project in searcProjects(projectSearchText)" 
											md-selected-item="selectedProject"
											md-selected-item-change="addProject(selectedProject)"
											md-search-text="projectSearchText"
											md-search-text-change="updateProjectName(projectSearchText)"
											md-item-text="project.codename"
											md-floating-label="Project"
											md-min-length="0">
										    <md-item-template>
										    	<span md-highlight-text="projectSearchText">{{project.codename}}</span>
										    </md-item-template>
										</md-autocomplete>

										<md-input-container>
									        <label>Room</label>
									        <md-select ng-model="po.room"  ng-model-options="{trpoBy: '$value.id'}">
									          	<md-option ng-repeat="room in po.project.rooms" ng-value="room">
									            	{{room.description}}
									         	 </md-option>
									        </md-select>
									    </md-input-container>
										<md-button class="md-accent md-raised" ng-click="showAddRoom()">Add a Room</md-button>
							
										<md-input-container>
									        <label>Phase</label>
									        <md-select ng-model="po.phase"  ng-model-options="{trackBy: '$value.id'}">
									          	<md-option ng-repeat="phase in po.project.phases" ng-value="phase">
									            	{{phase.description}}
									         	 </md-option>
									        </md-select>
									    </md-input-container>
										<md-button class="md-accent md-raised" ng-click="showAddPhase()">Add a Phase</md-button>
								</div>
				            </div>
						</md-card-content>
					</md-card>
				</section>
			
				<!--
					MAP SECTION
					-->
				<section>
					<md-subheader class="md-primary">Map</md-subheader>
					
					<md-card class="map" layout="row">
						<md-card-actions layout="column" layout-align="start center">
				          	<md-button class="md-raised md-accent md-icon-button" ng-disabled="!po.supplier.name || marker" ng-click="addMarker()">
								<md-tooltip>Add a Location</md-tooltip>
								<i class="material-icons">add_location</i>				
							</md-button>
				          	<md-button class="md-raised md-accent md-icon-button" ng-disabled="!marker" ng-click="editMarker()">
								<md-tooltip>Edit Location</md-tooltip>
								<i class="material-icons">edit_location</i>
							</md-button>
				          	<md-button class="md-raised md-accent md-icon-button" ng-disabled="directionsActive || !marker" ng-click="viewDirections()">
								<md-tooltip>View Directions</md-tooltip>
								<i class="material-icons">directions</i>				
							</md-button>
				        </md-card-actions>
						<md-card-content>
							<div class="map-container">
								<div id="create-po-map"></div>
						
							</div>
							<div id="directions"></div>
						</md-card-content>
					</md-card>
				</section>
				
				<section ng-show="po.pdf">
					<md-subheader class="md-primary md-no-sticky">Files</md-subheader>
					<div class="files">
						<md-card class="file" ng-repeat="file in [po.pdf]">
				        	<md-card-title>
								<md-card-title-text>
									<h4><span>PurchaseOrder-{{po.id}}.pdf</span></h4>
								</md-card-title-text>
				          		<md-card-title-media>
				            		<div class="md-media-sm card-media">
				            			<img src="//ssl.gstatic.com/docs/doclist/images/mediatype/icon_3_pdf_x16.png"
											ng-show="file.type == 'pdf'">
				            		</div>
				          		</md-card-title-media>
				          		<md-card-title-text>
				            		<span class="md-headline">{{file.filename}}</span>
				          	  	</md-card-title-text>
				          		
				        	</md-card-title>
				        	<md-card-actions layout="row" layout-align="end center">
				          		<md-button class="md-raised md-icon-button" ng-href="{{file.url}}" target="_blank">
									<md-tooltip>Open in a New Window</md-tooltip>
									<i class="material-icons">open_in_browser</i>
								</md-button>
				        	</md-card-actions>
				      	</md-card>
					</div>
				</section>
				
				<section>
					<md-subheader class="md-primary">Supplies</md-subheader>
			
					<md-card class="add-product" layout="row" layout-align="start center">
						<md-card-actions layout="column" layout-align="center center">
							<md-button class="add md-accent md-raised md-icon-button" ng-click="addItem(selectedSupply || {description: supplySearchText});supplySearchText=''">
								<md-tooltip>Add Product</md-tooltip>
								<i class="material-icons">add_shopping_cart</i>
							</md-button>
							<md-button class="add md-accent md-raised md-icon-button" ng-click="listView=true">
								<md-tooltip>View as List</md-tooltip>
								<i class="material-icons"><i class="material-icons">list</i></i>
							</md-button>
							<md-button class="add md-accent md-raised md-icon-button" ng-click="listView=false">
								<md-tooltip>View as Cards</md-tooltip>
								<i class="material-icons"><i class="material-icons">view_module</i></i>
							</md-button>
				        </md-card-actions>
						<md-card-content layout="row" layout-align="start center" flex="auto">
							<md-autocomplete flex required 
								md-items="supply in searchSupplies(supplySearchText)" 
								md-search-text-change="retrieveSupplies(supplySearchText)"
								md-selected-item="selectedSupply"
								md-search-text="supplySearchText"
								md-item-text="supply.description"
								md-no-cache="true"
								md-floating-label="Supply Description"
								md-min-length="0">
							    <md-item-template>
							    	<span md-highlight-text="supplySearchText">{{supply.description}}</span>
							    </md-item-template>
									<div class="hint">Starting typing to search or just type the description and add...</div>
							</md-autocomplete>
						</md-card-content>
						<md-card-title-media>
							<div class="md-media-md card-media">
								<img ng-src="{{tempProduct.image.url}}">
							</div>
						</md-card-title-media>
					</md-card>
            
		            <md-card class="item" ng-repeat="item in po.items track by $index" layout="column" ng-show="!listView">
						<md-card-title layout="column" layout-align="start start">
				          	<md-card-title-text>
				            	<span class="md-headline">{{item.description}}</span>
				          	</md-card-title-text>
							<h6 ng-show="isNewSupply(item, po.supplier)" class="md-warn">*Item is new for {{po.supplier.name}}</h6>
				        </md-card-title>
				
				
						<md-card-content layout="row">
							<md-card-actions layout="row" layout-align="end center">
								<md-button class="add md-warn md-raised md-icon-button" ng-click="removeItem($index)">
									<md-tooltip>Remove {{item.description}} from the order</md-tooltip>
									<i class="material-icons">remove</i>
								</md-button>
					        </md-card-actions>
							<table class="product-details">
								<tr>
									<td>
										<md-input-container>
											<label>Quantity</label>
											<input name="quantity" type="number" ng-model="item.quantity" min="0" required />
											<div ng-messages="poForm.quantity.$error">
												<div ng-message="required">This required is required</div>
												<div ng-message="min">Quantity should be greater than 0</div>
											</div>
								            <div class="hint">How many pieces did they order?</div>
										</md-input-container>
									</td>
									<td>
										<md-input-container>
											<label>Price Per {{item.purchasing_units || 'PC' | uppercase}}</label>
											<input name="price" type="number" ng-model="item.cost" required />
											<div ng-messages="poForm.price.$error">
												<div ng-message="required">This required is required</div>
											</div>
								            <div class="hint">How many one piece cost?</div>
									
										</md-input-container>
									</td>
									<td>
										<md-input-container>
											<label>Discount</label>
											<input name="discount" type="number" ng-model="item.discount" required />
											<div ng-messages="poForm.discount.$error">
												<div ng-message="required">This required is required</div>
											</div>
									
										</md-input-container>
									</td>
									<td>
										<md-input-container>
											<label>Total</label>
											<input name="price" type="number" ng-model="item.cost * item.quantity" ng-disabled="true" />
										</md-input-container>
									</td>
								</tr>
								<tr>
									<td>
										<md-input-container>
											<label>Width (mm)</label>
											<input name="width" type="number" ng-model="item.width" min="0" required />
										</md-input-container>
									</td>
									<td>
										<md-input-container>
											<label>Depth (mm)</label>
											<input name="depth" type="number" ng-model="item.depth" min="0" required />
										</md-input-container>
									</td>
									<td>
										<md-input-container>
											<label>Height (mm)</label>
											<input name="height" type="number" ng-model="item.height" min="0" required />
										</md-input-container>
									</td>
								</tr>
								<tr>
									<td>
										<md-input-container>
										  	<label>Remarks</label>
		  								  	<md-icon md-font-icon="material-icons">comment</md-icon>
									
											<textarea ng-model="item.comments"></textarea>
								            <div class="hint">Any other details?</div>
									
										</md-input-container>
									</td>
								</tr>
							</table>
							<md-card-title-media flex="shrink">
								<div class="md-media-sm card-media">
									<img ng-src="{{item.image.url}}">
								</div>
							</md-card-title-media>
						</md-card-content>	
				
					</md-card>
			
					<md-card class="order-details" ng-show="listView && po.items">
		            	<md-card-content>
							<table ng-show="po.items">
								<thead>
									<tr class='heading'>
										<td>Description</td>
										<td>Comments</td>
										<td>Discount</td>
										<td>Unit Cost</td>
										<td>Quantity</td>
										<td colspan="2">Total</td>
									</tr>
								</thead>
								<tbody>
									<tr class="items" ng-repeat="item in po.items">
										<td class='description'>{{item.description}}</td>
										<td><textarea ng-model=item.comments row="4"></textarea></td>
										<td class='discount'>
											<input required type="number" min="0" ng-model="item.discount"/> 
										</td>
										<td class='unit-cost'><input required min="0" type="number" ng-model="item.cost" /></td>
										<td class='quantity'>
											<input required type="number" min="0" ng-model="item.quantity" />
										</td>
										<td class='total'>{{unitCost(item.cost, item.discount) * item.quantity || 0 | number:2}}</td>
										<td><md-button class="remove-btn md-warn md-raised" ng-click="removeItem($index)">Remove</md-button></td>
									</tr>
									<tr class="summary subtotal">
										<td></td>
										<td></td>
										<td></td>
										<td></td>
										<td class="title">Subtotal</td>
										<td class="value">{{subtotal() || 0 | number:2}}</td>
										<td></td>
									</tr>
									<tr class="summary discount" ng-show="po.discount">
										<td></td>
										<td></td>
										<td></td>
										<td></td>
										<td class="title">Discount {{po.discount}}%</td>
										<td class="value">-{{discount() || 0 | number:2}}</td>
										<td></td>
									</tr>
									<tr class="summary total" ng-show="po.discount">
										<td></td>
										<td></td>
										<td></td>
										<td></td>
										<td class="title">Total</td>
										<td class="value"> {{total() || 0 | number:2}}</td>
										<td></td>
									</tr>
									<tr class="summary vat" ng-show="po.vat">
										<td></td>
										<td></td>
										<td></td>
										<td></td>
										<td class="title">Vat {{po.vat}}%</td>
										<td class="value">{{total() * (po.vat / 100) || 0 | number:2}}</td>
										<td></td>
									</tr>
									<tr class="summary grand-total" ng-show="po.vat">
										<td></td>
										<td></td>
										<td></td>
										<td></td>
										<td class="title">Grand Total</td>
										<td class="value">{{grandTotal() || 0 | number:2}}</td>
										<td></td>
									</tr>
								</tbody>
							</table>
						</md-card-content>
		            </md-card>
				</section>
			</md-content>
            
        </div>
    </form>
    
</div>