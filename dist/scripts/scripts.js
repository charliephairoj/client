function search(a,b,c,d,e){for(var f=0;f<a.length;f++)if(a[f].hasOwnProperty(b)&&a[f][b]==c)return d(a[f],f),a[f];return angular.isFunction(e)&&e(),!1}function merge(a,b){a&&b&&angular.forEach(b,function(b){search(a,"id",b.id,function(b,c){a[c].status=!0})})}angular.module("employeeApp.services",["ngResource"]),angular.module("employeeApp.directives",[]),angular.module("employeeApp.filters",[]),angular.module("employeeApp",["ngRoute","ngResource","ngCookies","ngMessages","employeeApp.directives","employeeApp.filters","employeeApp.services","ngMaterial"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/contact/customer/add",{templateUrl:"views/contact/customer/add.html",controller:"ContactCustomerAddCtrl"}).when("/contact/customer/:id",{templateUrl:"views/contact/customer/details.html",controller:"ContactCustomerDetailsCtrl"}).when("/contact/customer",{templateUrl:"views/contact/customer/view.html",controller:"ContactCustomerViewCtrl"}).when("/contact/supplier/add",{templateUrl:"views/contact/supplier/add.html",controller:"ContactSupplierAddCtrl"}).when("/contact/supplier",{templateUrl:"views/contact/supplier/view.html",controller:"ContactSupplierViewCtrl"}).when("/contact/supplier/:id",{templateUrl:"views/contact/supplier/details.html",controller:"ContactSupplierDetailsCtrl"}).when("/contact",{templateUrl:"views/contact.html"}).when("/product/upholstery/add",{templateUrl:"views/product/upholstery/add.html",controller:"ProductUpholsteryAddCtrl"}).when("/product/upholstery",{templateUrl:"views/product/upholstery/view.html",controller:"ProductUpholsteryViewCtrl"}).when("/product/upholstery/:id",{templateUrl:"views/product/upholstery/details.html",controller:"ProductUpholsteryDetailsCtrl"}).when("/product",{templateUrl:"views/product.html"}).when("/product/model/add",{templateUrl:"views/product/model/add.html",controller:"ProductModelAddCtrl"}).when("/product/model",{templateUrl:"views/product/model/view.html",controller:"ProductModelViewCtrl"}).when("/product/model/:id",{templateUrl:"views/product/model/details.html",controller:"ProductModelDetailsCtrl"}).when("/order/acknowledgement/create",{templateUrl:"views/order/acknowledgement/create.html",controller:"OrderAcknowledgementCreateCtrl"}).when("/order",{templateUrl:"views/order.html"}).when("/order/acknowledgement",{templateUrl:"views/order/acknowledgement/view.html",controller:"OrderAcknowledgementViewCtrl",reloadOnSearch:!1}).when("/order/shipping/create",{templateUrl:"views/order/shipping/create.html",controller:"OrderShippingCreateCtrl"}).when("/order/shipping",{templateUrl:"views/order/shipping/view.html",controller:"OrderShippingViewCtrl"}).when("/order/shipping/deliveries/today",{templateUrl:"views/order/shipping/today.html",controller:"OrderShippingTodayCtrl"}).when("/order/shipping/deliveries/week",{templateUrl:"views/order/shipping/week.html",controller:"OrderShippingWeekCtrl"}).when("/administrator/group/add",{templateUrl:"views/administrator/group/add.html",controller:"AdministratorGroupAddCtrl"}).when("/administrator/group",{templateUrl:"views/administrator/group/view.html",controller:"AdministratorGroupViewCtrl"}).when("/administrator/group/:id",{templateUrl:"views/administrator/group/details.html",controller:"AdministratorGroupDetailsCtrl"}).when("/administrator/user/add",{templateUrl:"views/administrator/user/add.html",controller:"AdministratorUserAddCtrl"}).when("/administrator/user/:id",{templateUrl:"views/administrator/user/details.html",controller:"AdministratorUserDetailsCtrl"}).when("/administrator/user",{templateUrl:"views/administrator/user/view.html",controller:"AdministratorUserViewCtrl"}).when("/administrator",{templateUrl:"views/administrator.html"}).when("/supply",{templateUrl:"views/supply/view.html",controller:"SupplyViewCtrl"}).when("/supply/fabric",{templateUrl:"views/supply/fabric/view.html",controller:"SupplyFabricViewCtrl"}).when("/supply/fabric/add",{templateUrl:"views/supply/fabric/add.html",controller:"SupplyFabricAddCtrl"}).when("/supply/fabric/:id",{templateUrl:"views/supply/fabric/details.html",controller:"SupplyFabricDetailsCtrl"}).when("/supply/foam/add",{templateUrl:"views/supply/foam/add.html",controller:"SupplyFoamAddCtrl"}).when("/supply/foam/:id",{templateUrl:"views/supply/foam/details.html",controller:"SupplyFoamDetailsCtrl"}).when("/supply/foam",{templateUrl:"views/supply/foam/view.html",controller:"SupplyFoamViewCtrl"}).when("/accounting",{templateUrl:"views/accounting.html"}).when("/accounting/transaction",{templateUrl:"views/accounting/transaction/view.html",controller:"AccountingTransactionViewCtrl"}).when("/accounting/transaction/add",{templateUrl:"views/accounting/transaction/add.html",controller:"AccountingTransactionAddCtrl"}).when("/accounting/transaction/:id",{templateUrl:"views/accounting/transaction/details.html",controller:"AccountingTransactionDetailsCtrl"}).when("/order/acknowledgement/:id",{templateUrl:"views/order/acknowledgement/details.html",controller:"OrderAcknowledgementDetailsCtrl"}).when("/order/shipping/delivery",{templateUrl:"views/order/shipping/delivery.html",controller:"OrderShippingDeliveryCtrl"}).when("/order/shipping/:id",{templateUrl:"views/order/shipping/details.html",controller:"OrderShippingDetailsCtrl"}).when("/order/acknowledgement/item/:id",{templateUrl:"views/order/acknowledgement/item/details.html",controller:"OrderAcknowledgementItemDetailsCtrl"}).when("/supply/prop",{templateUrl:"views/supply/prop/view.html",controller:"SupplyPropViewCtrl"}).when("/supply/prop/add",{templateUrl:"views/supply/prop/add.html",controller:"SupplyPropAddCtrl"}).when("/supply/prop/:id",{templateUrl:"views/supply/prop/details.html",controller:"SupplyPropDetailsCtrl"}).when("/supply/lumber/view",{templateUrl:"views/supply/lumber/view.html",controller:"SupplyLumberViewCtrl"}).when("/product/inventory",{templateUrl:"views/product/inventory.html",controller:"ProductInventoryCtrl"}).when("/product/table",{templateUrl:"views/product/table/view.html",controller:"ProductTableViewCtrl"}).when("/product/rug",{templateUrl:"views/product/rug.html",controller:"ProductRugCtrl"}).when("/product/rug/view",{templateUrl:"views/product/rug/view.html",controller:"ProductRugViewCtrl"}).when("/product/rug/add",{templateUrl:"views/product/rug/add.html",controller:"ProductRugAddCtrl"}).when("/product/table/add",{templateUrl:"views/product/table/add.html",controller:"ProductTableAddCtrl"}).when("/product/table/:id",{templateUrl:"views/product/table/details.html",controller:"ProductTableDetailsCtrl"}).when("/project",{templateUrl:"views/project/view.html",controller:"ProjectViewCtrl"}).when("/project/:id",{templateUrl:"views/project/details.html",controller:"ProjectDetailsCtrl"}).when("/hr",{templateUrl:"views/hr.html"}).when("/hr/employee",{templateUrl:"views/hr/employee/view.html",controller:"HrEmployeeViewCtrl"}).when("/project/room/:id",{templateUrl:"views/project/room/details.html",controller:"ProjectRoomDetailsCtrl"}).when("/order/purchase_order",{templateUrl:"views/order/purchase_order/view.html",controller:"OrderPurchaseOrderViewCtrl",reloadOnSearch:!1}).when("/order/purchase_order/create",{templateUrl:"views/order/purchase_order/create.html",controller:"OrderPurchaseOrderCreateCtrl"}).when("/order/purchase_order/:id",{templateUrl:"views/order/purchase_order/details.html",controller:"OrderPurchaseOrderDetailsCtrl"}).when("/supply/log",{templateUrl:"views/supply/log.html",controller:"SupplyLogCtrl"}).when("/supply/shopping_list",{templateUrl:"views/supply/shopping_list.html",controller:"SupplyShoppingListCtrl"}).when("/supply/buying_guide",{templateUrl:"views/supply/buying_guide.html",controller:"SupplyBuyingGuideCtrl"}).when("/supply/:id",{templateUrl:"views/supply/details.html",controller:"SupplyDetailsCtrl"}).when("/equipment",{templateUrl:"views/equipment/view.html",controller:"EquipmentViewCtrl"}).when("/order/estimate",{templateUrl:"views/order/estimate/view.html",controller:"OrderEstimateViewCtrl"}).when("/order/estimate/create",{templateUrl:"views/order/estimate/create.html",controller:"OrderEstimateCreateCtrl"}).when("/order/estimate/:id",{templateUrl:"views/order/estimate/details.html",controller:"OrderEstimateDetailsCtrl"}).when("/scanner",{templateUrl:"views/scanner.html",controller:"ScannerCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("employeeApp").config(["$httpProvider","$resourceProvider","$mdThemingProvider","$provide",function(a,b,c,d){d.decorator("$log",["$delegate",function(a){var b=a.info,c=a.warn,d=(a.error,function(a,b){$.ajax({type:"POST",url:"/api/v1/client/log/",data:{type:a,message:b},processData:!0})});return a.info=function(){var a=[].slice.call(arguments),c=(new Date).toUTCString(),e=a[0].hasOwnProperty("stack")?a[0].stack:c+"-"+a[0];d("info",a[0]),b(e)},a.warn=function(){var a=[].slice.call(arguments),b=(new Date).toUTCString(),e=a[0].hasOwnProperty("stack")?a[0].stack:b+"-"+a[0];d("warn",a[0]),c(e)},a.error=function(){var a=[].slice.call(arguments),b=(new Date).toUTCString();a[0].hasOwnProperty("stack")?a[0].stack:b+"-"+a[0];d("error",a[0])},a}]),a.defaults.headers.post={"Cache-Control":"no-cache",expires:"-1",pragma:"no-cache","Content-Type":"application/json"},a.defaults.headers.get={"Cache-Control":"no-cache",expires:"-1",pragma:"no-cache"},b.defaults.stripTrailingSlashes=!1,a.defaults.stripTrailingSlashes=!1,a.defaults.transformResponse.push(function(a,b){return"object"==typeof a&&a.hasOwnProperty("results")?a.results:a}),c.theme("default").primaryPalette("blue-grey").accentPalette("blue").backgroundPalette("grey")}]),angular.module("employeeApp").run(function(a,b,c,d,e,f,g,h,i,j,k){d.defaults.headers.common["X-CSRFToken"]=g.get("csrftoken"),$.ajaxPrefilter(function(a,b,c){c.setRequestHeader("X-CSRFToken",g.get("csrftoken"))}),a.currentUser=new b(function(){inventoryUserCheck();for(var b=0;b<a.groups.length;b++)"decoroom"==a.groups[b].toLowerCase()&&k.path("/order/acknowledgement")}),a.currentUser.onready=function(){for(var a=0;a<this.groups.length;a++)"decoroom"==this.groups[a].toLowerCase()&&k.path("/order/acknowledgement")}.bind(a.currentUser),a.currentUser.onready=function(){!this.hasModule("supplies")||this.hasModule("acknowledgements")||this.hasModule("shipping")||(a.inventory=!0,k.path("/scanner"))}.bind(a.currentUser),Array.prototype.indexOfById=function(a){a="object"==typeof a?a.hasOwnProperty("id")?a.id:null:a;for(var b=this,c=0;c<b.length;c++)if(b[c].id==a)return c;return-1},a.safeApply=function(b){var c;try{c=this.$root.$$phase}catch(d){c=a.$$phase}if("$apply"==c||"$digest"==c)b&&"function"==typeof b&&b();else try{this.$apply(b)}catch(d){}},a.units={"in":"Inch",cm:"Centimeter",m:"Meter",mm:"Millimeter",yd:"Yard",kg:"Kilogram",pack:"Pack",container:"Container",pc:"Piece"},window.globalScanner=new c("global"),globalScanner.enable(),a.showChangePassword=function(){j.show({templateUrl:"views/templates/change-password.html",controller:"DialogsChangePasswordCtrl"})},a.country="TH","geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(b){if(e.initialized){var c=e.reverseGeocode(b.coords.latitude,b.coords.longitude);c.then(function(b){for(var c in b[0].address_components){var d=b[0].address_components[c];"object"==typeof d.types&&-1!=d.types.indexOf("country")&&(a.country=d.short_name)}},function(){$log.error("Getting the position failed")})}},function(a){$log.log(a)}):$log.log("Geolocation not available")}),angular.module("employeeApp").controller("ContactCustomerAddCtrl",["$scope","Customer","$location","Notification","Geocoder","$log",function(a,b,c,d,e,f){a.customer=new b,a.save=function(){a.form.$valid?(d.display("Creating customer...",!1),a.customer.$save(function(){d.display("Customer created"),c.path("/contact/customer")},function(a){d.display("There was an error in creating the customer",!1)})):d.display("Please fill out all required fields correctly",!1)},a.getPosition=function(){if(a.customer.address.address1&&a.customer.address.city&&a.customer.address.territory&&a.customer.address.country&&a.customer.address.zipcode){var b=e.geocode(a.customer.address);b.then(function(b){a.marker?a.marker.setPosition(b[0].geometry.location):(a.marker=a.map.createMarker(b[0].geometry.location),a.marker.onchange=function(b){a.customer.address.lat=a.marker.lat,a.customer.address.lng=a.marker.lng}),a.map.setPosition(b[0].geometry.location),a.customer.address.lat=a.marker.lat,a.customer.address.lng=a.marker.lng},function(a){f.error(a)})}}}]),angular.module("employeeApp").controller("ContactCustomerDetailsCtrl",["$scope","Customer","$routeParams","$location","Notification","$timeout",function(a,b,c,d,e,f){function g(b){var c=b.address.latitude||b.latitude,d=b.address.longitude||b.longitude,e=new google.maps.Marker({position:new google.maps.LatLng(c,d),map:i,title:String(b.index+1),draggable:!0});return b.icon&&e.setIcon(b.icon),b.marker=e,b.address.marker=!0,google.maps.event.addListener(e,"dragend",function(){var a=this.marker.getPosition();Number(this.marker.getTitle())-1;this.address.latitude=a.lat(),this.address.longitude=a.lng(),e.setIcon("http://maps.google.com/mapfiles/ms/icons/green-dot.png")}.bind(b)),google.maps.event.addListener(e,"mouseover",function(){a.safeApply(function(){this.address.hover=!0}.bind(this))}.bind(b)),google.maps.event.addListener(e,"mouseout",function(){a.safeApply(function(){this.address.hover=!1}.bind(this))}.bind(b)),b.marker}var h,i,j=!1,k={center:new google.maps.LatLng(13.776239,100.527884),zoom:4,mapTypeId:google.maps.MapTypeId.ROAD},l=[{featureType:"road",stylers:[{visibility:"on"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#DDDDDD"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#FFFFFF"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{visibility:"off"}]}];i=new google.maps.Map($("#customer-map")[0],k),i.setOptions({styles:l}),a.customer=b.get({id:c.id},function(){for(var b=0;b<a.customer.addresses.length;b++){var c=a.customer.addresses[b];c.latitude&&c.longitude&&(marker=g({address:c,index:b,icon:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"}))}1===a.customer.addresses.length&&(i.panTo(marker.getPosition()),i.setZoom(17))}),a.update=function(){e.display("Updating...",!1),a.customer.$update(function(){e.display("Customer Save")},function(){e.display("Unable to Update Customer")})},a.$watch(function(){var b=angular.copy(a.customer);return delete b.last_modified,b},function(b,c){c.hasOwnProperty("id")&&!j&&(j=!0,h=f(function(){e.display("Updating customer...",!1);for(var b=angular.copy(a.customer),c=0;c<b.addresses.length;c++)delete b.addresses[c].marker;b.$update(function(){j=!1,e.display("Customer updated")},function(){j=!1,e.display("There was an error updating the customer")})},5e3))},!0),a.createMarker=function(a,b){var c=i.getCenter();g({address:a,index:b,latitude:c.lat(),longitude:c.lng()})},a.remove=function(){a.customer.$delete(function(){d.path("/contact/customer")})},a.$on("$destroy",function(){f.cancel(h),e.display("Updating customer...",!1),a.customer.$update(function(){e.display("Customer updated.")})})}]),angular.module("employeeApp").controller("ContactCustomerViewCtrl",function(a,b,c,d,e){var f=!1;c.display("Loading Customers...",!1),a.customers=b.query(function(){c.hide()}),a.$watch("query",function(c){c&&b.query({q:c},function(b){for(var c=0;c<b.length;c++)-1==a.customers.indexOfById(b[c])&&a.customers.push(b[c])})}),a.loadNext=function(){f||(f=!0,b.query({offset:a.customers.length,limit:50},function(b){f=!1;for(var c=0;c<b.length;c++)a.customers.push(b[c])}))}}),angular.module("employeeApp").controller("ContactSupplierAddCtrl",function(a,b,c,d){a.supplier=new b,a.addContact=function(){d.display("Contact Added to Supplier"),a.supplier.contacts=a.supplier.contacts||[],a.supplier.contacts.push(angular.copy(a.contact)),a.contact={},a.showAddContact=!1},a.getLocation=function(){a.map.getPosition(a.supplier.address,function(b){angular.extend(a.supplier.address,b),a.map.setPosition({lat:b.lat,lng:b.lng,updateMarker:!0})})},a.save=function(){a.form.$valid?(d.display("Saving supplier...",!1),a.supplier.$save(function(){d.display("Supplier Saved"),c.path("/contact/supplier")},function(a){d.display("There was an error in creating this supplier",!1)})):d.display("Please fill out all required sections correctly")}}),angular.module("employeeApp").controller("ContactSupplierViewCtrl",["$scope","Supplier","Notification","$filter",function(a,b,c,d){c.display("Loading suppliers...",!1),a.suppliers=b.query(function(){c.hide()}),a.$watch("query",function(c){c&&b.query({q:c},function(b){for(var c=0;c<b.length;c++)-1==a.suppliers.indexOfById(b[c])&&a.suppliers.push(b[c])})}),a.loadNext=function(){b.query({offset:a.suppliers.length,limit:50},function(b){for(var c=0;c<b.length;c++)a.suppliers.push(b[c])})}}]),angular.module("employeeApp").controller("ContactSupplierDetailsCtrl",["$scope","Supplier","$routeParams","$location","SupplierContact","Notification","$timeout","$mdDialog","$mdToast","$log",function(a,b,c,d,e,f,g,h,i,j){function k(b){var c=b.address.latitude||b.latitude,d=b.address.longitude||b.longitude,e=new google.maps.Marker({position:new google.maps.LatLng(c,d),map:l,title:b.title,draggable:!0});return b.icon&&e.setIcon(b.icon),b.marker=e,b.address.marker=!0,google.maps.event.addListener(e,"dragend",function(){var b=this.marker.getPosition();Number(this.marker.getTitle())-1;this.address.latitude=b.lat(),this.address.longitude=b.lng(),(this.address.latitude!=a.supplier.addresses[0].latitude||this.address.longitude!=a.supplier.addresses[0].longitude)&&(a.supplier.addresses[0].latitude=b.lat(),a.supplier.addresses[0].longitude=b.lng()),e.setIcon("http://maps.google.com/mapfiles/ms/icons/green-dot.png"),a.update()}.bind(b)),b.marker}var l,m=new google.maps.Geocoder,n={center:new google.maps.LatLng(13.776239,100.527884),zoom:4,mapTypeId:google.maps.MapTypeId.ROAD},o=[{featureType:"road",stylers:[{visibility:"on"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#DDDDDD"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#FFFFFF"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{visibility:"off"}]}];l=new google.maps.Map($("#supplier-map")[0],n),l.setOptions({styles:o}),a.createMarker=function(a,b){var c=l.getPosition();k({address:a,index:b,latitude:c.lat(),longitude:c.lng()})},a.supplier=b.get({id:c.id},function(){var b=a.supplier.addresses[0];if(b.latitude&&b.longitude){var c=l.getCenter();marker=k({address:b,title:a.supplier.name,latitude:c.lat(),longitude:c.lng(),icon:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"}),l.panTo(marker.getPosition()),l.setZoom(17)}else{var d=b.address1||"";d+=(b.address2||"")+", ",d+=(b.city||"")+", ",d+=(b.territory||"")+", ",d+=(b.country||"")+" ",d+=b.zipcode||"",m.geocode({address:d},function(c,d){if(d==google.maps.GeocoderStatus.OK){var e=c[0].geometry.location;marker=k({address:b,title:a.supplier.name,latitude:e.lat(),longitude:e.lng()}),l.panTo(marker.getPosition()),l.setZoom(14)}else j.error(d)})}}),a.contact={},a.showAddContact=function(){h.show({templateUrl:"views/templates/add-supplier-contact.html",controllerAs:"ctrl",controller:function(){this.parent=a}})},a.complete=function(){a.form.$valid?(i.hide(),h.hide(),a.addContact()):i.show(i.simple().position("top right").hideDelay(0).content("Please complete all fields."))},a.cancel=function(){h.hide(),$sccope.contact={}},a.addContact=function(b){a.supplier.contacts=a.supplier.contacts||[],b=b||a.contact,a.supplier.contacts.push(b),a.contact={},a.supplier.$update()},a.deleteContact=function(b){a.supplier.contacts.splice(b,1),a.supplier.$update()},a.update=function(){f.display("Updating Supplier...",!1),j.debug(a.supplier),j.debug(a.supplier.addresses[0].latitude,a.supplier.addresses[0].longitude),a.supplier.$update(function(a){f.display("Supplier Updated")})},a.remove=function(){a.supplier.$remove(function(){d.path("/contact/supplier")})},a.$on("$destroy",function(){f.display("Updating supplier...",!1),a.supplier.$update(function(){f.display("Supplier updated")},function(a){f.display("There was an error updating the supplier")})})}]),angular.module("employeeApp.services").factory("Resource",["eaStorage","$rootScope","$http","$q","$parse","$resource","Notification",function(a,b,c,d,e,f,g){function h(b,c,d){function h(a,b){var d={};return b=angular.extend({},c,b),angular.forEach(b,function(b,c){angular.isFunction(b)&&(b=b()),d[c]=b.charAt&&"@"==b.charAt(0)?p(a,b.substr(1)):b}),d}function i(a,b){for(var c=0;c<a.length;c++)if(a[c].hasOwnProperty("id")&&a[c].id==b)return c;return-1}function j(a){angular.extend(this,a||{}),this.$$poll=!1,this.$$last_checked=null,this.$$timeout=null,this.$$date=!0}var k,l,m,n={get:{method:"GET"},save:{method:"POST"},update:{method:"PUT"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},"delete":{method:"DELETE"}},o=new f(b,c,d),p=(a(b.split(/\//g)[0]),function(a,b){return e(b)(a)});return d=angular.extend({},n,d),angular.forEach(d,function(a,b){var c="POST"==a.method||"PUT"==a.method||"PATCH"==a.method;j[b]=function(d,e,f,h){var n,p={},q=angular.noop,r=null;switch(arguments.length){case 4:r=h,q=f;case 3:case 2:if(!angular.isFunction(e)){p=d,n=e,q=f;break}if(angular.isFunction(d)){q=d,r=e;break}q=e,r=f;case 1:angular.isFunction(d)?q=d:c?n=d:p=d;break;case 0:break;default:throw"Expected between 0-4 arguments [params, data, success, error], got "+arguments.length+" arguments."}(l!=b||p!=m)&&(this.$$last_checked=void 0),a.isArray?k=angular.isArray(k)?k||[]:[]:(k=angular.isObject(k)&&!k.hasOwnProperty("length")?k||{}:{},k=this instanceof j?this:new j(k)),void 0!==this.$$last_checked&&"GET"==a.method&&angular.extend(p,{last_modified:this.$$last_checked.toISOString()});o[b](p,n,function(b){if(("DELETE"==a.method||c)&&angular.extend(this,b),"GET"===a.method)if(a.isArray||angular.isArray(b)){var d;for(var e in b)if(d=i(k,b[e].id),d>-1){if(!angular.equals(k[d],b[e])&&(angular.extend(k[d],new j(b[e])),k[d].deleted)){k.splice(d,1);var f=[];f.splice(d)}}else if(!b[e].deleted)try{k.push(new j(b[e]))}catch(h){}}else b.deleted?(angular.copy({},k),g.display("This resource no longer exists.")):angular.extend(k,new j(b));q(b)}.bind(this),function(a){});return l=b,m=p,k},j.prototype["$"+b]=function(a,d,e){var f,g=h(this),i=angular.noop;switch(arguments.length){case 3:g=a,i=d,f=e;break;case 2:case 1:angular.isFunction(a)?(i=a,f=d):(g=a,i=d||angular.noop);break;case 0:break;default:throw"Expected between 1-3 arguments [params, success, error], got "+arguments.length+" arguments."}var k=c?this:void 0;j[b].call(this,g,k,i,f)}}),j}return h}]),angular.module("employeeApp.services").factory("$storage",[function(){function a(a){function b(a){this.key=a,"localStorage"in window&&null!==window.localStorage&&(this.storage=window.localStorage,this.getKeys())}return b.prototype.isSupported=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}},b.prototype.createKeysArray=function(){return this.keys=[],this.saveKeys(),this.keys},b.prototype.saveKeys=function(){"object"==typeof this.keys?this.storage.setItem(this.key,JSON.stringify(this.keys)):this.createKeysArray()},b.prototype.createKey=function(){return a="storage-temp"+Date.now()},b.prototype.saveKey=function(a){var b=this.key+a;return this.keys=this.keys||this.createKeysArray(),-1===this.keys.indexOf(b)&&(this.keys.push(b),this.saveKeys()),b},b.prototype.getKeys=function(){return this.keys=JSON.parse(this.storage.getItem(this.key)),"object"!=typeof this.keys&&this.createKeysArray(),this.keys},b.prototype.deleteKey=function(a){this.keys=this.keys||this.getKeys();var b=this.keys.indexOf(a);return-1!=b?(this.keys.splice(b),this.saveKeys(),!0):!1},b.prototype.clearKeys=function(){return this.keys=[],this.storage.setItem(this.key,JSON.stringify(this.keys)),0===JSON.parse(this.storage.getItem(this.key)).length?!0:!1},b.prototype.getKey=function(a){return this.key+a},b.prototype.query=function(){var a,b=[];this.keys=this.getKeys();for(a in this.keys)b.push(JSON.parse(this.storage.getItem(this.keys[a])));return b},b.prototype.save=function(a){function b(a){if(a.hasOwnProperty("id")){var b=this.saveKey(a.id);return this.storage.setItem(b,JSON.stringify(a)),!0}return!1}var c=b.bind(this);if(!a)return!1;if(!angular.isArray(a))return c(a)?a:!1;for(var d=0;d<a.length;d++)if(!c(a[d]))return!1},b.prototype.get=function(a){if(a.hasOwnProperty("id")){var b;return b=this.getKey(a.id),b?JSON.parse(this.storage.getItem(b)):"itemKey"}return a},b.prototype.remove=function(a){var b;return a.hasOwnProperty("id")?(b=this.getKey(a.id),this.storage.removeItem(b),this.deleteKey(b),!0):!1},b.prototype.clear=function(){var a;for(a in this.keys)this.storage.removeItem(this.keys[a]);this.clearKeys()},b.prototype.saveLastModified=function(a){this.storage.setItem(this.key+"-last_modified",a.toISOString())},b.prototype.getLastModified=function(){var a=this.storage.getItem(this.key+"-last_modified");return a?new Date(a):!1},new b(a)}return a}]),angular.module("employeeApp.services").factory("Customer",["$resource",function(a){return a("/api/v1/customer/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp.services").factory("Supplier",["$resource",function(a){return a("/api/v1/supplier/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp.services").factory("CurrentUser",["$http",function(a){function b(){this.ready=!1,this._onready=[];var b=a.get("/api/v1/current_user");b.then(function(a){angular.extend(this,a.data||{}),this.ready=!0;for(var b=0;b<this._onready.length;b++)this._onready[b](a.data)}.bind(this))}return b.prototype.hasPermission=function(a){return this.modules&&-1!==this.permissions.indexOf(a)?!0:!1},b.prototype.hasModule=function(a){return this.modules&&-1!==this.modules.indexOf(a)?!0:!1},Object.defineProperties(b.prototype,{onready:{set:function(a){"function"==typeof a&&this._onready.push(a)}}}),b}]),angular.module("employeeApp.services").factory("Notification",["$timeout","$rootScope","$mdToast",function(a,b,c){function d(a){var b=angular.element(window).width(),c=angular.element(a).width();0===angular.element(a).css("left")?angular.element(a).css("left",b-c):angular.element(a).css("margin-left",-(c/2))}function e(a,b){function c(){d.close()}var d=new Notification(a);return b&&setTimeout(function(){this.close()}.bind(d),b),{hide:c,close:c}}function f(a,b){b=void 0===b?2e3:b;c.show(c.simple().action("CLOSE").position("bottom right").content(a).hideDelay(b));return{hide:c.hide,close:c.hide}}function g(c,e){b.safeApply(function(){this.notification.html(c),d(this.notification),this.notification.addClass("active")}.bind(this)),this.promise&&a.cancel(this.promise),e!==!1&&(this.promise=a(function(){this.hide()}.bind(this),1e3));var f=function(){this.notification.removeClass("active")}.bind(this);return{hide:f,close:f}}function h(){this.notification=angular.element(document.getElementById("notification")),this.promise=null,this._display=f,"Notification"in window?"granted"===Notification.permission?this._display=f:Notification.requestPermission(function(a){"granted"===a?this._display=e:this._display=g}):this._display=g}return h.prototype.display=function(a,b){var c=this._display(a,b);return c},h.prototype.hide=function(){this.notification.removeClass("active"),c.hide()},new h}]),angular.module("employeeApp.services").factory("SupplierContact",["$resource",function(a){return a("supplier_contact/:id",{id:"@id"})}]),angular.module("employeeApp.filters").filter("dateRange",[function(){function a(a,b,c,d){b.getTime()<=a.getTime()&&a.getTime()<=c.getTime()&&d()}function b(a){switch(typeof a){case"object":return a;case"string":return new Date(a);case"number":return new Date(a);default:return new Date(a)}}return function(c,d,e,f){var g=[],h=b(e),i=b(f),j=null;return angular.forEach(c,function(b){b.hasOwnProperty(d)&&("object"==typeof b[d]?a(b[d],h,i,function(){g.push(b)}):"string"==typeof b[d]?(j=new Date(b[d]),a(j,h,i,function(){g.push(b)})):"number"==typeof b[d]&&(j=new Date(b[d]),a(j,h,i,function(){g.push(b)})))}),g}}]),angular.module("employeeApp.filters").filter("dateFilter",[function(){function a(a,b,c,d){switch(c){case"equals":if(a.getMonth()==b.getMonth()&&a.getYear()==b.getYear()&&a.getDate()==b.getDate())return!0;break;case"greater":if(a.getTime()>=b.getTime())return!0;break;case"less":if(a.getTime()<=b.getTime())return!0;break;default:if(a.getMonth(a)==b.getMonth()&&a.getYear()==b.getYear()&&a.getDate()==b.getDate())return!0}return!1}return function(b,c,d,e){var f=[];return angular.forEach(b,function(b){if(b.hasOwnProperty(c))if("object"==typeof b[c])a(b[c],d,e)&&f.push(b);else if("string"==typeof b[c]){var g=new Date(b[c]);a(g,d,e,function(a){f.push(a)})}}),f}}]),angular.module("employeeApp.filters").filter("beautify",[function(){return function(a){try{var b,c,d,e=[],f=a.split(/\s+/);return angular.forEach(f,function(a){c=a.charAt(0).toUpperCase(),d=a.slice(1),d=c+d,e.push(d)}),b=e.join(" ")}catch(g){return a}}}]),angular.module("employeeApp.filters").filter("exclude",[function(){return function(a,b,c){if(!(a instanceof Array))return[];var d=[];for(var e in a)a[e][b]!=c&&d.push(a[e]);return d}}]),angular.module("employeeApp.filters").filter("telephone",[function(){return function(a){var b=a.replace(/ /g,"").replace(/\-/g,"");return b}}]),angular.module("employeeApp").controller("ProductUpholsteryAddCtrl",["$scope","Model","Configuration","Upholstery","Notification","$location","FileUploader",function(a,b,c,d,e,f,g){a.modelList=b.query({limit:0}),a.configurationList=c.query({limit:0}),a.upholstery=new d,a.modelText="Choose a Model",a.configurationText="Choose a Configuration",a.widthText="Enter a Width in millimeters",a.depthText="Enter a Depth in millimeters",a.bpText="Enter the number of Back Pillows",a.apText="Enter the number of Accent Pillows",a.lpText="Enter the number of Lumbar Pillows",a.cpText="Enter the number of Corner Pillows",a.upload=function(){e.display("Uploading Image...",!1);var b=g.upload(a.images[0],"/api/v1/upholstery/image/");b.then(function(b){e.display("Image Uploaded"),a.upholstery.image=b.data},function(){$mdToast.show($mdToast.simple().position("top right").hideDelay(0).content("There was an error uploading the file"))})},a.save=function(){e.display("Saving Upholstery Product..."),a.upholstery.$create(function(){e.display("Upholstery Product Saved"),f.path("/product/upholstery")})}}]),angular.module("employeeApp").controller("ProductUpholsteryViewCtrl",["$scope","Upholstery","Notification","$filter","$location",function(a,b,c,d,e){function f(){c.display("Updating "+this.description+".",!1);this.$update(postUpdate)}function g(a,b){for(var c=[],d=0;d<arguments.length;d++)c.push(arguments[d]);for(d in a)if(-1===c.indexOf(d)&&-1===d.indexOf("$")&&b[d]!=a[d])return!1;return!0}var h=!1;c.display("Loading Upholstery...",!1),a.resources=b.query({limit:20},function(){c.hide()}),a.$watch("query",function(c){c&&b.query({q:c,limit:5},function(b){for(var c=0;c<b.length;c++)-1==a.resources.indexOfById(b[c])&&a.resources.push(b[c])})}),a.loadNext=function(){if(!h){var d=(c.display("Loading more upholstery...",6e3),{offset:a.resources.length,limit:10});a.query&&(d.q=a.query),b.query(d,function(b){c.hide();for(var d=0;d<b.length;d++)a.resources.push(b[d])})}},a.$watch("resources",function(a,b){if(a&&b)try{for(var c=0;c<a.length;c++)a[c]&&b[c]&&a[c].id===b[c].id&&g(a,b,"images","last_modified","schematic","image")&&setTimeout(f.bind(a[c]),600)}catch(d){$log.error(d)}},!0)}]),angular.module("employeeApp").controller("ProductUpholsteryDetailsCtrl",["$scope","Upholstery","$routeParams","$mdToast","$location","$timeout","FileUploader","ProductSupply","$mdDialog","Notification",function(a,b,c,d,e,f,g,h,i,j){a.updateLoopActive=!0;a.uphol=b.get({id:c.id},function(){a.safeApply(function(){a.updateLoopActive=!1;
})}),a.supplies=h.query({product__id:c.id},function(){}),a.upload=function(){var b=g.upload(a.images[0],"/api/v1/upholstery/image/");b.then(function(b){d.show(d.simple().position("top right").hideDelay(3e3).content("File was uploaded.")),a.uphol.image=b.data,a.update()},function(){d.show(d.simple().position("top right").hideDelay(0).content("There was an error uploading the file"))})},a.supplyTotal=function(){for(var b=0,c=a.supplies.length;c--;)b+=Number(a.supplies[c].cost);return b},a.showAddProductSupply=function(){a.supply=new h,a.supply.product=a.uphol,i.show({templateUrl:"views/templates/add-product-supply.html",controllerAs:"ctrl",controller:function(){this.parent=a}})},a.completeAddProductSupply=function(){i.hide(),j.display("Creating supply for "+a.uphol.description+"...",!1),a.supply.$create(function(b){a.supplies.push(b),j.hide(),a.supply=new h,a.supply.product=a.uphol},function(a){$log.error(JSON.stringify(a))})},a.cancelAddProductSupply=function(){i.hide(),a.supply=new h,a.supply=a.uphol},a.$watch("supplies",function(a,b){var c=function(){this.$update(function(){this.$updating=!1})};if(a.length&&b.length)for(var d=a.length;d--;)a[d]&&b[d]&&a[d].id==b[d].id&&(angular.equals(a[d],b[d])||a[d].$updating||(a[d].$updating=!0,setTimeout(c.bind(a[d]),600)))},!0),a.$watch(function(){var b=angular.copy(a.uphol);try{delete b.last_modified}catch(c){}return b},function(b,c){b&&c&&b.hasOwnProperty("id")&&(angular.equals(b,c)||b.$updating||(b.$updating=!0,setTimeout(function(){this.$update(function(){this.$updating=!1,d.show(d.simple().position("top right").hideDelay(3e3).content(a.uphol.description+" updated."))})}.bind(b),600)))},!0),a.update=function(){},a.remove=function(){a.uphol.$delete(function(){e.path("/product/upholstery")})},a.$on("$destroy",function(){a.update()})}]),angular.module("employeeApp.services").factory("Upholstery",["$resource",function(a){return a("/api/v1/upholstery/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp.services").factory("Model",["$resource",function(a){return a("/api/v1/model/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp.services").factory("Configuration",["$resource",function(a){return a("/api/v1/configuration/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp").controller("ProductModelAddCtrl",["$scope","Model","Notification","$location","FileUploader",function(a,b,c,d,e){a.model=new b,a.nameText="Enter a Name for this Model",a.modelText="Enter a Model Number for this Model",a.collectionText="Enter this Model's Collection",a.save=function(b){c.display("Saving Model...",!1),a.model.$create(function(){d.path("/product/model"),c.display("Model Saved")})},a.uploadImage=function(){c.display("Uploading Image...",!1);var b=e.upload(a.images[0],"/api/v1/upholstery/image/");b.then(function(b){c.display("Image Uploaded"),a.model.image=b.data},function(a){c.display("There was an error in uploading the file")})}}]),angular.module("employeeApp").controller("ProductModelViewCtrl",["$scope","Model","Notification","$log","$location",function(a,b,c,d,e){function f(a){c.display(a.model+" status updated.",2e3)}function g(a,b){for(var c=[],d=0;d<arguments.length;d++)c.push(arguments[d]);for(d in a)if(-1===c.indexOf(d)&&-1===d.indexOf("$")&&b[d]!=a[d])return!1;return!0}var h=!1;a.models=b.query(function(){}),a.$watch("query",function(c){c&&b.query({q:c,limit:10},function(b){for(var c=0;c<b.length;c++)-1==a.models.indexOfById(b[c])&&a.models.push(b[c])})}),a.loadNext=function(){h||(c.display("Loading more models...",!1),b.query({limit:50,offset:a.models.length},function(b){for(var c=0;c<b.length;c++)a.models.push(b[c])}))};var i=null,j=function(){c.display("Updating "+this.model+".",!1);this.$update(f)};a.$watch("models",function(a,b){if(a&&b)try{for(var c=0;c<a.length;c++)a[c]&&b[c]&&a[c].id===b[c].id&&(g(a[c],b[c],"images","last_modified")||(clearTimeout(i),i=setTimeout(j.bind(a[c]),600)))}catch(e){d.error(e)}},!0),a.$on("$destroy",function(){})}]),angular.module("employeeApp").controller("ProductModelDetailsCtrl",["$scope","Model","$routeParams","$location","Notification","$http","FileUploader",function(a,b,c,d,e,f,g){a.model=b.get({id:c.id}),a.upload=function(){e.display("Uploading Model Image...",!1);var b=g.upload(a.images[0],"/api/v1/upholstery/image/");b.then(function(b){e.display("Image uploaded."),a.model.images.push(b.data),a.update(),a.images=null},function(){e.display("Error uploading image",!1)})},a.remove=function(){e.display("Deleting Model..."),a.model.$delete(function(){e.display("Model Deleted"),d.path("/product/model")})},a.update=function(){e.display("Saving Model...",!1),a.model.$update(function(){e.display("Model Updated")})},a.makePrimaryImage=function(b){for(var c=a.model.images.length;c--;)a.model.images[c].primary=!1;b.primary=!0,a.update()},a.$on("$destroy",function(){a.update()})}]),angular.module("employeeApp.services").factory("Acknowledgement",["$resource","$http",function(a,b){return a("/api/v1/acknowledgement/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp").controller("OrderAcknowledgementCreateCtrl",["$scope","Acknowledgement","Customer","$filter","$window","Project","Notification","FileUploader","Room","Phase","$mdDialog","$log","Upholstery","Fabric","$location",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(b,c,d){var e={origin:b,destination:c,avoidHighways:!1,avoidTolls:!1,travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.METRIC};x.route(e,function(b,c){c==google.maps.DirectionsStatus.OK?(v.setDirections(b),a.directionsActive=!0):(d||angular.noop)()})}function q(){v.set("directions",null),a.directionsActive=!1}function r(b){var c=null,d=null;b.address?(c=b.address.latitude||b.latitude,d=b.address.longitude||b.longitude):(c=b.latitude,d=b.longitude);var e=new google.maps.Marker({position:new google.maps.LatLng(c,d),title:b.title,draggable:!0});return b.icon&&e.setIcon(b.icon),b.marker=e,b.address.marker=!0,google.maps.event.addListener(e,"dragend",function(){var b=this.marker.getPosition();Number(this.marker.getTitle())-1;this.address.latitude=b.lat(),this.address.longitude=b.lng(),(this.address.latitude!=a.ack.customer.addresses[0].latitude||this.address.longitude!=a.ack.customer.addresses[0].longitude)&&(a.ack.customer.addresses[0].latitude=b.lat(),a.ack.customer.addresses[0].longitude=b.lng()),e.setIcon("http://maps.google.com/mapfiles/ms/icons/green-dot.png")}.bind(b)),b.marker}function s(a,b){function d(a){for(var b in e){if(e[b]===!1)return!1;if("error"===e[b])throw new Error}console.log(e),console.log(a),(a||angular.noop)()}var e={};if(!a.customer.id&&a.customer.name){e.customer=!1;var g=new c;angular.extend(g,a.customer),g.$create(function(c){angular.extend(a.customer,c),e.customer=!0,d(b)},function(){e.customer="error"})}else a.customer.id&&(e.customer=!1,a.customer.$update(function(c){angular.extend(a.customer,c),e.customer=!0,d(b)},function(){e.customer="error"}));if(a.project&&!a.project.id&&a.project.codename){e.project=!1;var h=new f;angular.extend(h,a.project),h.$create(function(c){angular.extend(a.project,c),e.project=!0,d(b)},function(){e.project="error"})}for(var i=0;i<a.items.length;i++)a.items[i].hasOwnProperty("id")||(a.items[i].is_custom=!0)}a.uploading=!1,a.customImageScale=100,a.projects=f.query({page_size:99999,limit:0,status__exclude:"completed"}),a.ack=new b;var t=window.localStorage;a.marker=null;var u,v,w=new google.maps.LatLng(13.935441,100.6864353),x=new google.maps.DirectionsService,y=(new google.maps.Geocoder,{center:new google.maps.LatLng(13.776239,100.527884),zoom:4,mapTypeId:google.maps.MapTypeId.ROAD});u=new google.maps.Map($("#create-ack-map")[0],y),v=new google.maps.DirectionsRenderer({map:u,draggable:!0}),v.setMap(u);var z=new google.maps.TrafficLayer;if(z.setMap(u),a.addMarker=function(){a.marker=r({address:{},latitude:13.935441,longitude:100.6864353,title:a.ack.customer.name}),a.marker.setMap(u),u.panTo(a.marker.getPosition()),u.setZoom(17)},a.editMarker=function(){q(),a.marker&&(a.marker.setMap(u),u.panTo(a.marker.getPosition()),u.setZoom(17))},a.viewDirections=function(){a.marker.setMap(null),p(w,a.marker.getPosition(),function(){a.marker.setMap(u),u.panTo(a.marker.getPosition()),u.setZoom(17)})},t.getItem("acknowledgement-create")){angular.extend(a.ack,JSON.parse(t.getItem("acknowledgement-create")));try{if(a.ack.customer){var A=a.ack.customer.addresses[0];A.latitude&&A.longitude&&(a.marker=r({address:A,title:a.ack.customer.name,icon:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"}),p(w,a.marker.getPosition(),function(){q(),a.marker.setMap(u),u.panTo(a.marker.getPosition()),u.setZoom(17)}))}}catch(B){l.error(B)}}a.ack.items=a.ack.items||[],a.employee={id:a.currentUser.id},a.tempSave=function(){t.setItem("acknowledgement-create",JSON.stringify(a.ack))},a.customers=c.query({page_size:9999,limit:0}),a.retrieveCustomers=function(b){b&&c.query({q:b},function(b){for(var c=0;c<b.length;c++)-1===a.customers.indexOfById(b[c])&&a.customers.push(b[c])})},a.searchCustomers=function(b){for(var c=angular.lowercase(b),d=[],e=0;e<a.customers.length;e++)-1!==angular.lowercase(a.customers[e].name).indexOf(c)&&d.push(a.customers[e]);return d},a.updateCustomerName=function(b){a.ack.customer=a.ack.customer||{name:"",addresses:[]},a.ack.customer.id?-1==a.ack.customer.name.indexOf(b)&&(a.ack.customer={name:b,addresses:[]}):(q(),a.ack.customer.name=b||"")},a.addCustomer=function(b){a.ack.customer=b,a.tempSave(),a.marker&&a.marker.setMap(null),q(),u.setZoom(9);try{var c=b.addresses[0];c.latitude&&c.longitude?(a.marker=r({address:c,title:a.ack.customer.name,icon:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"}),p(w,a.marker.getPosition(),function(){q(),a.marker.setMap(u),u.panTo(a.marker.getPosition()),u.setZoom(17)})):a.marker=null}catch(d){l.warn(JSON.stringify(d))}},a.searchProjects=function(b){for(var c=angular.lowercase(b),d=[],e=0;e<a.projects.length;e++)-1!==angular.lowercase(a.projects[e].codename).indexOf(c)&&d.push(a.projects[e]);return console.log(d),d},a.addProject=function(b){a.ack.project=b},a.updateProjectName=function(b){a.ack.project=a.ack.project||{codename:""},a.ack.project.id?-1==a.ack.project.codename.indexOf(b)&&(a.ack.project={codename:b}):a.ack.project.codename=b||""},a.showAddRoom=function(){a.room=new i,k.show({templateUrl:"views/templates/add-room.html",controllerAs:"ctrl",controller:function(){this.parent=a}})},a.completeAddRoom=function(){k.hide();var b=angular.copy(a.room);b.project=a.ack.project,a.room=new i,b.$create(function(b){a.ack.project.rooms.push(b),a.ack.room=b},function(a){l.error(JSON.stringify(a))})},a.cancelAddRoom=function(){k.hide(),a.room=new i},a.showAddPhase=function(){a.phase=new j,k.show({templateUrl:"views/templates/add-phase.html",controllerAs:"ctrl",controller:function(){this.parent=a}})},a.completeAddPhase=function(){k.hide();var b=angular.copy(a.phase);b.project=a.ack.project.id,a.phase=void 0,b.$create(function(b){a.ack.project.phases.push(b),a.ack.phase=b},function(a){l.error(JSON.stringify(a))})},a.cancelAddPhase=function(){k.hide(),a.phase=void 0},a.addItem=function(b){b.description&&(b.width=b.width||0,b.height=b.height||0,b.depth=b.depth||0,a.ack.items.push(b),a.tempSave(),delete a.tempProduct,delete a.productSearchText)},a.removeItem=function(b){a.ack.items.splice(b,1),a.tempSave()},a.addFiles=function(b){a.ack.files=a.ack.files||[];for(var c=0;c<b.length;c++){a.ack.files.push({filename:b[c].name});var d=h.upload(b[c],"/api/v1/acknowledgement/file/");d.then(function(b){for(var c=b.data||b,d=0;d<a.ack.files.length;d++)c.filename==a.ack.files[d].filename&&angular.extend(a.ack.files[d],c)},function(a){l.error(JSON.stringify(a))})}},a.addImage=function(b,c){console.log(b),a.ack.files=a.ack.files||[];var d=h.upload(b[0],"api/v1/acknowledgement/item/image");d.then(function(a){var b=a.data||a;c.image=b},function(a){l.error(JSON.stringify(a))})},a.upholsteries=m.query(),a.retrieveUpholsteries=function(b){b&&m.query({q:b},function(b){for(var c=0;c<b.length;c++)-1===a.upholsteries.indexOfById(b[c])&&a.upholsteries.push(b[c])})},a.searchProducts=function(b){for(var c=angular.lowercase(b.trim()),d=[],e=0;e<a.upholsteries.length;e++)-1!==angular.lowercase(a.upholsteries[e].description).indexOf(c)&&d.push(a.upholsteries[e]);return console.log(c,d),d},a.fabricSearchText=null,a.fabrics=n.query({page_size:9999,limit:0}),a.retrieveFabrics=function(b){b&&n.query({q:b},function(b){for(var c=0;c<b.length;c++)-1===a.fabrics.indexOfById(b[c])&&a.fabrics.push(b[c])})},a.searchFabrics=function(b){for(var c=angular.lowercase(b.trim()),d=[],e=0;e<a.fabrics.length;e++)-1!==angular.lowercase(a.fabrics[e].description).indexOf(c)&&d.push(a.fabrics[e]);return d},a.isValidated=function(){if(!a.ack.customer)throw new TypeError("Please add a customer.");if(!a.ack.customer.hasOwnProperty("name"))throw new ReferenceError("Missin customer name");if(!a.ack.items)throw new TypeError("Products is not an array");if(a.ack.items.length<=0)throw new RangeError("No products added to the order");for(var b=0;b<a.ack.items.length;b++){a.ack.items[b];if(!a.ack.items[b].hasOwnProperty("quantity")||!a.ack.items[b].quantity)throw new RangeError("Expecting a quantity of at least 1 for "+a.ack.items[b].description);a.ack.items[b].hasOwnProperty("has_price")&&!a.ack.items[b].has_price}if(!a.ack.delivery_date)throw new TypeError("Please select a preliminary delivery date.");if(void 0===a.ack.vat||null===a.ack.vat)throw new TypeError("Please set the vat.");if(!a.ack.po_id)throw new TypeError("PO# is not defined");testWords=[{re:/ห้อง/gi,type:"room",message:"Please specify the room in room selection"},{re:/บ้าน/gi,type:"project",message:"Please specify the project in the project selection"},{re:/บ้านตัวอย่าง/gi,type:"project",message:"Please specify the project in the project selection"},{re:/ลดาวัลย์/gi,type:"project",message:"Please specify the project in the project selection"},{re:/โครงการ/gi,type:"project",message:"Please specify the project in the project selection"}];for(var c=0;c<testWords.length;c++)if(testWords[c].re.test(a.ack.remarks)&&!a.ack[testWords[c].type])throw new TypeError(testWords[c].message);return!0},a.create=function(){a.ack.employee=a.currentUser,a.tempSave();try{a.isValidated()&&(g.display("Creating new acknowledgment...",!1),s(a.ack,function(){a.ack.$create(function(b){g.display("Acknowledgement created with ID: "+a.ack.id,2e3),b.pdf.acknowledgement&&e.open(b.pdf.acknowledgement),b.pdf.confirmation&&e.open(b.pdf.confirmation),b.pdf.production&&e.open(b.pdf.production),a.reset(),o.path("order/acknowledgement/"+b.id)},function(a){l.error(JSON.stringify(a)),g.display("There was an error in creating the acknowledgement. A report has been sent to Charlie.",!1)})}))}catch(b){l.error(JSON.stringify({message:b,data:a.ack})),g.display(b.message,!1)}},a.reset=function(){a.ack=new b,a.ack.items=[],t.removeItem("acknowledgement-create")}}]),angular.module("employeeApp").controller("OrderAcknowledgementViewCtrl",["$scope","Acknowledgement","$location","$filter","KeyboardNavigation","Notification","$log","Fabric","FileUploader",function(a,b,c,d,e,f,g,h,i){function j(b){return d("filter")(b,a.query)}function k(b){a.safeApply(function(){l&&(l.$selected=!1),l=j(a.acknowledgements)[b],l&&(l.$selected=!0)});var c=$(".item.selected"),d=c.parents(".outer-container"),e=d.scrollTop(),f=d.innerHeight();e>c.outerHeight()*b?d.scrollTop(c.outerHeight()*b):e+f<c.outerHeight()*b&&d.scrollTop(c.outerHeight()*b)}var l,m=!0,n=0,o=c.search(),p=f.display("Retrieving acknowledgements...",!1);a.query={},o.q&&a.safeApply(function(){a.query={$:{$:o.q}}}),o.status&&a.safeApply(function(){a.query.status=o.status}),a.acknowledgements=b.query({limit:20},function(a){p.hide(),m=!1,k(n)}),a.setCategory=function(d){a.safeApply(function(){a.query.status=d}),c.search("status",d);var e={limit:20,status:d};try{a.query.$.$&&(e.q=a.query.$.$)}catch(f){}b.query(e,function(b){for(var c=0;c<b.length;c++)-1==a.acknowledgements.indexOfById(b[c].id)&&a.acknowledgements.push(b[c])})},a.$watch("query.$.$",function(d){d&&(c.search("q",d),b.query({q:d,limit:d?d.length:5},function(b){for(var c=0;c<b.length;c++)-1==a.acknowledgements.indexOfById(b[c].id)&&a.acknowledgements.push(b[c]);n=0,k(n)}))}),a.loadNext=function(){if(!m){m=!0;var c=f.display("Retrieving more acknowledgements...",!1),d={limit:50,offset:a.acknowledgements.length};a.query.status&&(d.status=a.query.status),b.query(d,function(b){m=!1,c.hide();for(var d=0;d<b.length;d++)-1===a.acknowledgements.indexOfById(b[d])&&a.acknowledgements.push(b[d])})}},a.hasEvent=function(a,b){for(var c in a.logs)if(a.logs[c].hasOwnProperty("message")&&a.logs[c].message.indexOf(b)>-1)return!0;return!1},a.navigate=function(a){c.path("/order/acknowledgement/"+a)};var q=new e;q.ondown=function(){n<j(a.acknowledgements).length-1&&(n+=1,k(n))},q.onup=function(){0!==n&&(n-=1,k(n))},q.onenter=function(){a.safeApply(function(){c.path("/order/acknowledgement/"+l.id)})},q.enable(),a.$on("$destroy",function(){q.disable()}),a.addFiles=function(a,b){b.files=b.files||[];for(var c=0;c<a.length;c++){b.files.push({filename:a[c].name});var d=i.upload(a[c],"/api/v1/acknowledgement/file/");d.then(function(a){for(var c=a.data||a,d=0;d<b.files.length;d++)c.filename==b.files[d].filename&&angular.extend(b.files[d],c)},function(a){g.error(JSON.stringify(a))})}},a.addImage=function(a,b){if(a.length>0){var c=i.upload(a[0],"api/v1/acknowledgement/item/image");c.then(function(a){var c=a.data||a;b.image=c},function(a){g.error(JSON.stringify(a))})}},a.fabricSearchText=null,a.fabrics=h.query({page_size:9999,limit:0}),a.retrieveFabrics=function(b){b&&h.query({q:b},function(b){for(var c=0;c<b.length;c++)-1===a.fabrics.indexOfById(b[c])&&a.fabrics.push(b[c])})},a.searchFabrics=function(b){for(var c=angular.lowercase(b.trim()),d=[],e=0;e<a.fabrics.length;e++)-1!==angular.lowercase(a.fabrics[e].description).indexOf(c)&&d.push(a.fabrics[e]);return d},a.update=function(a){f.display("Updating order #"+a.id),a.$update(function(){f.display("Order #"+a.id+" updated")})}}]),angular.module("employeeApp.services").factory("Fabric",["$resource",function(a){return a("/api/v1/fabric/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"},add:{method:"POST",params:{action:"add"}},subtract:{method:"POST",params:{action:"subtract"}}})}]),angular.module("employeeApp.directives").directive("fadeLoad",[function(){return{restrict:"A",replace:!1,link:function(a,b,c){b.css("opacity",0),b.bind("load",function(){b.fadeTo(1e3,1)})}}}]),angular.module("employeeApp").directive("fadeIn",[function(){return{restrict:"A",replace:!1,link:function(a,b,c){b.addClass("fadeIn")}}}]),angular.module("employeeApp").directive("ecBlur",[function(){return{restrict:"A",replace:!1,link:function(a,b,c){b.bind("blur",function(){a.$eval(c.ecBlur)})}}}]),angular.module("employeeApp").directive("dragOn",[function(){return{restrict:"A",replace:!1,link:function(a,b,c){b.attr("draggable",!0),b.bind("dragstart",function(b){b.originalEvent.dataTransfer.setData("text/plain",JSON.stringify(a.$eval(c.dragOn)))})}}}]),angular.module("employeeApp.directives").directive("onDrop",[function(){function a(a){return JSON.parse(a.originalEvent.dataTransfer.getData("text/plain"))}function b(a){a.stopPropagation(),a.preventDefault(),a.originalEvent.dataTransfer.effectAllowed="copy"}return{restrict:"A",replace:!1,scope:{onDrop:"="},link:function(c,d,e){d.bind("drop",function(f){console.log(f),b(f),d.removeClass("drag"),console.log(f),c.$apply(function(){c.dropOn=a(f),e.onDrop&&c.onDrop({$file:a(f)})})}).bind("dragover",function(a){b(a),d.addClass("drag")}).bind("dragleave",function(a){b(a),d.removeClass("drag")})}}}]),angular.module("employeeApp").directive("imageDropTarget",["$parse",function(a){return{restrict:"A",replace:!1,link:function(a,b,c){var d=new FileReader;d.onload=function(b){var c={url:b.target.result};a.imagePreviews=a.imagePreviews||[],a.$apply(function(){a.imagePreviews.push(c)})},a.clearImages=function(){a.images?a.images.length=0:a.images=[]},b.bind("dragenter",function(a){a.preventDefault(),b.addClass("active")}),b.bind("dragleave",function(a){a.preventDefault(),b.removeClass("active")}),b.bind("dragover",function(a){a.preventDefault(),b.addClass("active")}),b.bind("drop",function(e){e.preventDefault(),e.stopPropagation(),b.removeClass("active");for(var f=e.originalEvent,g=f.dataTransfer.files,h=0;h<g.length;h++)("image/png"==g[h].type||"image/jpeg"==g[h].type)&&(a.images=a.images||[],a.images.push(g[h]),d.readAsDataURL(g[h]));a.$eval(c.imageDropTarget)})}}}]),angular.module("employeeApp").directive("beautify",["$filter","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){d.bind("blur",function(){var f=a("beautify")(d.context.value);d.context.value=f,b(e.ngModel).assign(c,f)})}}}]),angular.module("employeeApp.directives").directive("telephone",["$filter","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){d.bind("blur",function(){var f=a("telephone")(d.context.value);d.context.value=f,b(e.ngModel).assign(c,f)})}}}]),angular.module("employeeApp.directives").directive("map",["mapMarker","$log",function(a,b){var c={};try{var d={center:new google.maps.LatLng(13.776239,100.527884),zoom:4,mapTypeId:google.maps.MapTypeId.ROAD}}catch(e){}var f=[{featureType:"road",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#DDDDDD"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#FFFFFF"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{visibility:"off"}]}];return{restrict:"A",replace:!1,link:function(e,g,h){try{e.map={Marker:a,LatLng:google.maps.LatLng},e.map.map=new google.maps.Map(g.get(0),d),e.map.map.setOptions({styles:f}),e.$on("shown",function(){google.maps.event.trigger(e.map.map,"resize")}),e.map.refresh=function(){google.maps.event.triggger(this.map)},e.map.createMarker=function(a){return c=a instanceof google.maps.LatLng?a:a.hasOwnProperty("lat")&&a.hasOwnProperty("lng")?new google.maps.LatLng(a.lat,a.lng):null,new e.map.Marker({map:this.map,position:c})},e.map.setPosition=function(a){c=a instanceof google.maps.LatLng?a:new google.maps.LatLng(a.lat,a.lng),this.map.panTo(c),this.map.setZoom(14)}}catch(i){b.error(i)}}}}]),angular.module("employeeApp").directive("clickUrl",[function(){return{restrict:"A",link:function(a,b,c){b.bind("click",function(){a.category="fabric",$location.path(c.clickUrl),a.$apply()})}}}]),angular.module("employeeApp.directives").directive("modal",["$log",function(a){function b(){return angular.element('<div id="backdrop"></div>')}var c,d;return{restrict:"A",scope:!1,compile:function(e,f){return{pre:function(a,b,c){if(b.addClass("modal hide"),c.title){d=angular.element('<button type="button" class="close">&times;</button>');var e=angular.element('<div class="modal-title"><h4>'+c.title+"</h4></div>");e.append(d),b.append(e)}},post:function(e,f,g){function h(a,d){d.removeClass("hide"),c=b(),$(document.body).append(c),c.on("click",function(){i(a,d,c)}),c.fadeTo(500,.7),d.fadeTo(500,1,function(){a.$broadcast("shown")})}function i(b,c,d,e){c.fadeOut(400,function(){c.addClass("hide"),b.$broadcast("hidden")}),d&&d.fadeOut(500,function(){d.remove(),(e||angular.noop)();try{(b.modal._onhide&&b.modal||angular.noop)()}catch(c){a.warn(c)}if(g.ngModel||g.modal)if("$apply"==b.$$phase||"$digest"==b.$$phase)b[g.ngModel||g.modal]=!1;else try{b.safeApply(function(){b[g.ngModel||g.modal]=!1})}catch(c){}g.onhide&&b.$eval(g.onhide)})}e.$on("$destroy",function(){c&&c.remove()}),(g.ngModel||g.modal)&&e.$watch(g.ngModel||g.modal,function(a){a?h(e,f):i(e,f,c)}),e.modal={_onhide:void 0},e.modal.show=function(){h(e,f)},e.modal.hide=function(a){i(e,f,c,a)},Object.defineProperties(e.modal,{onhide:{set:function(a){this._onhide=a}}}),d&&d.click(function(){try{e.$apply(function(){e[g.ngModel||g.modal]=!1})}catch(b){a.warn(b)}})}}}}}]),angular.module("employeeApp").controller("OrderShippingCreateCtrl",["$scope","Acknowledgement","$filter","$mdToast","Shipping","$location","scanner","$log",function(a,b,c,d,e,f,g,h){var i=!0;a.acknowledgements=b.query({limit:20},function(){i=!1}),a.shipping=new e;g.onscan=function(c){var e=new RegExp(/^A\-(s+)?/);e.test(c)&&(d.show(d.simple().content("Retrieving Acknowledgement# "+c.split("-")[1]).delay(0)),Notification.display("Retrieving Acknowledgement# "+c.split("-")[1],!1),b.get({id:c.split("-")[1]},function(b){d.hide();var c=b;a.shipping.acknowledgement={id:c.id},a.shipping.customer=c.customer,a.shipping.products=c.products,a.shipping.delivery_date=new Date(c.delivery_date)},function(){d.show(d.simple().content("Unable to locate Acknowledgement#"+c.split("-")[1]).delay(0))}))},a.addAcknowledgement=function(b){a.shipping.acknowledgement={id:b.id},a.shipping.customer=b.customer,a.shipping.items=b.items,a.shipping.delivery_date=new Date(b.delivery_date);for(var c=0;c<a.shipping.items.length;c++)try{a.shipping.items[c].quantity=Number(a.shipping.items[c].quantity),a.shipping.items[c].width=Number(a.shipping.items[c].width||0),a.shipping.items[c].depth=Number(a.shipping.items[c].depth||0),a.shipping.items[c].height=Number(a.shipping.items[c].height||0)}catch(d){h.warn(d)}a.showAck=!1},a.$watch("query",function(c){c&&b.query({limit:5,q:c},function(b){for(var c=0;c<b.length;c++)-1==a.acknowledgements.indexOfById(b[c].id)&&a.acknowledgements.push(b[c])})}),a.loadNext=function(){i||(i=!0,b.query({offset:a.acknowledgements.length,limit:20},function(b){for(var c=0;c<b.length;c++)a.acknowledgements.push(b[c]);i=!1}))},a.create=function(){a.isValidated()?(d.show(d.simple().content("Creating shippping manifest...").hideDelay(0)),a.shipping.$save(function(a){d.show(d.simple().content("Shipping manifest created").hideDelay(2e3)),a.pdf.url&&window.open(a.pdf.url),f.path("/order/shipping")},function(){d.show(d.simple().content("There was an error in creating the shipping manifest").hideDelay(0))})):d.show(d.simple().content("The Order is Not Complete"))},a.removeProduct=function(b){a.shipping.items.splice(b,1)},a.isValidated=function(){return a.shipping.acknowledgement&&a.shipping.delivery_date?!0:!1},a.$on("$destroy",function(){g.onscan=null})}]),angular.module("employeeApp").controller("OrderShippingViewCtrl",["$scope","Shipping","$filter","$mdToast",function(a,b,c,d){var e=!0;d.show(d.simple().content("Loading shipping manifests...").hideDelay(0)),a.shippingList=b.query(function(a){e=!1,d.hide()}),a.$watch("query",function(c){c&&b.query({limit:5,q:c},function(b){for(var c=0;c<b.length;c++)-1==a.shippingList.indexOfById(b[c].id)&&a.shippingList.push(b[c])})}),a.loadNext=function(){e||(d.show(d.simple().content("Loading more shipping manifests...").hideDelay(0)),b.query({offset:a.shippingList.length,limit:20},function(b){d.hide();for(var c=0;c<b.length;c++)a.shippingList.push(b[c])}))}}]),angular.module("employeeApp").controller("OrderShippingTodayCtrl",["$scope","Acknowledgement",function(a,b){a.startDate=new Date,a.startDate.setHours(0,0,0),a.endDate=new Date,a.endDate.setHours(0,0,0),a.endDate.setDate(a.endDate.getDate()+1),a.ackList=b.query({start_date:a.startDate.toISOString(),end_date:a.endDate.toISOString()})}]),angular.module("employeeApp").controller("OrderShippingWeekCtrl",["$scope","Acknowledgement",function(a,b){a.startDate=new Date,a.endDate=new Date,a.endDate.setDate(a.endDate.getDate()+7),a.ackList=b.query({start_date:a.startDate.toISOString(),end_date:a.endDate.toISOString()})}]),angular.module("employeeApp.services").factory("Shipping",["$resource",function(a){return a("/api/v1/shipping/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp").controller("AdministratorGroupAddCtrl",["$scope","Group","Permission","$location",function(a,b,c,d){a.permissions=c.query({limit:0}),a.group=new b,a.group.permissions=[],a.save=function(){for(var b=0;b<a.permissions;b++)a.permissions[b].$checked&&a.group.permissions.push(a.permissions[b]);a.group.$create(function(){d.path("/administrator/group")})}}]),angular.module("employeeApp").controller("AdministratorGroupViewCtrl",["$scope","Group",function(a,b){a.groups=b.query({limit:0})}]),angular.module("employeeApp").controller("AdministratorGroupDetailsCtrl",["$scope","Group","Permission","$routeParams","$location",function(a,b,c,d,e){function f(a,b){if(!a.hasOwnProperty("length"))throw new TypeError("Expecting an Array");if("object"==typeof b&&!b.hasOwnProperty("id"))throw new TypeError("Expecting an id property for argument 2");var c="object"==typeof b?b.id:b;for(var d in a)if(a[d].id==c)return d;return-1}function g(a,b){for(var c in a)for(var d in b)a[c].id==b[d].id&&(a[c].$checked=!0)}a.permissionList=c.query({limit:0,page_size:1e4},function(){g(a.permissionList,a.group.permissions)}),a.group=b.get({id:d.id},function(){g(a.permissionList,a.group.permissions)}),a.updatePermission=function(b){if(b.$checked)-1==f(a.group.permissions,b)&&a.group.permissions.push(angular.copy(b));else{var c=f(a.group.permissions,b);c>-1&&a.group.permissions.splice(c,1)}var d=angular.copy(a.group);d.$update(function(b){angular.extend(a.group,b)})},a.remove=function(){a.group.$delete(function(){e.path("/groups")})},a.$on("$destroy",function(){a.group.$update()})}]),angular.module("employeeApp").controller("AdministratorUserDetailsCtrl",["$scope","Group","User","$routeParams","$location","$http","Notification","$log",function(a,b,c,d,e,f,g,h){function i(a,b){for(var c in a)for(var d in b)a[c].id==b[d].id&&(a[c].$checked=!0)}var j=!1;a.groupList=b.query({limit:0},function(){i(a.groupList,a.user.groups)}),a.user=c.get({id:d.id},function(){i(a.groupList,a.user.groups)}),a.addImage=function(b){a.showAddImage=!1,a.user.image=b.hasOwnProperty("data")?b.data:b,a.user.$update()},a.changePassword=function(){var b="/api/v1/user/"+a.user.id+"/change_password";f.post(b,a.password).success(function(b){g.display("Password successfully changed"),a.password={},a.showChangePassword=!1}).error(function(a){h.error(a)})},a.updateGroup=function(b){if(b.$checked)-1===a.user.groups.indexOfById(b.id)&&a.user.groups.push(angular.copy(b));else{var c=a.user.groups.indexOfById(b.id);-1!=c&&a.user.groups.splice(c,1)}g.display("Updating "+a.user.username+"...",!1),a.user.$update(function(b){g.display(a.user.username+" updated.")})},a.remove=function(){a.currentUser.hasPermission("delete_user")&&(g.display("Deleting user "+a.user.username+"...",!1),a.user.$delete(function(){g.display(a.user.username+" deleted."),j=!0,e.path("/administrator/user")}))},a.update=function(){a.user.$update()},a.$on("$destroy",function(){j||a.user.$update()})}]),angular.module("employeeApp").controller("AdministratorUserAddCtrl",["$scope","User","Group","$location",function(a,b,c,d){a.user=new b,a.user.groups=[],a.groups=c.query({limit:0},function(){}),a.addImage=function(b){a.user.image=b.hasOwnProperty("data")?b.data:b},a.save=function(){if(a.form.$valid){for(var b=0;b<a.groups.length;b++)a.groups[b].$$checked&&a.user.groups.push(angular.copy(a.groups[b]));a.user.$create(function(){d.path("/administrator/user")})}}}]),angular.module("employeeApp").controller("AdministratorUserViewCtrl",["$scope","User","Group","Notification",function(a,b,c,d){a.users=b.query({limit:0}),a.groups=c.query({limit:0}),a.searchGroups=function(b){for(var c=angular.lowercase(b),d=[],e=0;e<a.groups.length;e++)-1!==angular.lowercase(a.groups[e].name).indexOf(c)&&d.push(a.groups[e]);return d},a.save=function(b){a.currentUser.hasPermission("change_user")&&(d.display("Saving user: "+b.username+"...",!1),b.$update(function(){d.display(b.username+" saved.")}))},a.remove=function(b,c){a.currentUser.hasPermission("delete_user")&&(d.display("Deleting user: "+b.username+"...",!1),b.$delete(function(){d.display(b.username+" deleted."),a.users.splice(c,1)}))}}]),angular.module("employeeApp.services").factory("Group",["$resource",function(a){
return a("/api/v1/group/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp.services").factory("User",["$resource",function(a){return a("/api/v1/user/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp").controller("SupplyFabricViewCtrl",["$scope","Fabric","Notification","$log",function(a,b,c,d){var e=!0;a.fabrics=b.query(function(){e=!1}),a.$watch("query",function(c){c&&b.query({q:c,limit:5},function(b){for(var c=0;c<b.length;c++)-1==a.fabrics.indexOfById(b[c].id)&&a.fabrics.push(b[c])})}),a.$watch("fabrics",function(a,b){function e(a){c.display("Fabric "+a.description+" status updated to '"+a.status.toLowerCase()+"'",2e3)}if(a&&b)try{for(var f=0;f<a.length;f++)if(a[f]&&b[f]&&a[f].id===b[f].id&&(console.log(a[f],b[f]),a[f].status!=b[f].status)){c.display("Updating "+a[f].description+" status...",!1);a[f].$update(e)}}catch(g){d.error(g)}},!0),a.loadNext=function(){e||(e=!0,c.display("Loading more fabrics...",!1),b.query({offset:a.fabrics.length,limit:50},function(b){e=!1,c.hide();for(var d=0;d<b.length;d++)-1==a.fabrics.indexOfById(b[d].id)&&a.fabrics.push(b[d])},function(a){d.error(JSON.stringify(a))}))}}]),angular.module("employeeApp").controller("SupplyFabricAddCtrl",["$scope","Supplier","Fabric","$location","Notification","FileUploader","$log",function(a,b,c,d,e,f,g){a.suppliers=b.query({limit:0}),a.fabric=new c,a.supplierText="Choose a Supplier for this Fabric",a.referenceText="Enter the Supplier's Reference Number",a.lengthText="Enter the Current Length of this Fabric in yards",a.widthText="Enter the Width in millimeters",a.patternText="Enter the Pattern of this Fabric",a.colorText="Enter the Color of this Fabric",a.cost="Enter the Cost per Yard of this Fabric",a.save=function(){e.display("Saving Fabric...",!1),a.form.$valid&&a.fabric.$create(function(){e.display("Fabric Saved"),d.path("supply/fabric")},function(a){g.error(JSON.stringify(a))})},a.upload=function(){e.display("Uploading Image...",!1);var b=f.upload(a.images[0],"/api/v1/supply/image/");b.then(function(b){e.display("Image Uploaded"),a.fabric.image=b.data},function(a){g.error(JSON.stringify(a)),e.display("There was an error in uploading the file")})}}]),angular.module("employeeApp").controller("SupplyFabricDetailsCtrl",["$scope","Fabric","$routeParams","$location","Notification","SupplyLog","$mdToast","FileUploader","$log",function(a,b,c,d,e,f,g,h,i){a.fabric=b.get({id:c.id},function(b){a.fabric.quantity=Number(a.fabric.quantity||0),a.fabric.width=Number(a.fabric.width||0)}),a.logs=f.query({supply_id:c.id});a.quantityNeeded=function(){var b=Number(a.fabric.quantity)-Number(a.fabric.reserved),c=0>b?Math.abs(b):"Sufficient fabric in stock.";return c},a.add=function(){a.fabric.$add({quantity:a.quantity},function(){}),a.showAdd=!1,a.quantity=null},a.subtract=function(){a.fabric.$subtract({quantity:a.quantity},function(){}),a.showSubtract=!1,a.quantity=null},a.remove=function(){e.display("Deleting Fabric..."),a.fabric.$delete(function(){e.display("Fabric Deleted"),d.path("/fabric")})},a.upload=function(){e.display("Uploading Image...",!1);var b=h.upload(a.images[0],"/api/v1/supply/image/");b.then(function(b){e.display("Image Uploaded"),a.fabric.image=b.data,a.fabric.$update(function(){e.display("Fabric updated")})},function(a){e.display("There was an error in uploading the file")})},a.update=function(){e.display("Updating Fabric...",!1),a.fabric.$update(function(){e.display("Fabric Updated")},function(a){i.error(JSON.stringify(a))})},a.updateLog=function(d){var e=a.logs[d];("RESERVE"==e.action||"CUT"==e.action||"CANCEL"==e.action)&&(g.show(g.simple().position("top right").content("Updating "+a.fabric.description+" for Ack #"+e.acknowledgement_id+".").hideDelay(0)),a.logs[d].$update(function(b){i.debug(JSON.stringify(b)),b.supply&&(a.fabric.quantity=b.supply.quantity),g.hide(),g.show(g.simple().position("top right").content("Updated.").hideDelay(2e3))},function(a){i.error(JSON.stringify(a)),g.hide(),g.show(g.simple().position("top right").content(a).hideDelay(0))}),b.get({id:c.id},function(b){a.fabric.reserved=b.reserved}))}}]),angular.module("employeeApp").controller("SupplyFoamDetailsCtrl",["$scope","Foam","$routeParams","$location","Notification",function(a,b,c,d,e){a.foam=b.get({id:c.id}),a.upload=function(){e.display("Uploading Image...",!1);var b=new FormData;b.append("image",a.images[0]),a.addLength=null,a.addRemark=null,jQuery.ajax("supply/"+a.foam.id+"/image",{type:"POST",data:b,processData:!1,contentType:!1,success:function(b){e.display("Image Updated"),a.foam.image={},angular.copy(b,a.foam.image),a.foam.$save(),a.profileImageUrl=a.foam.image.url,a.imagePreviews=null,a.images=null,a.$apply()}})},a.remove=function(){a.foam.$delete(function(){d.path("/foam")}),a.foamList=b.query()},a.update=function(){e.display("Updating Foam...",!1),a.foam.$save(function(){e.display("Foam Updated")})}}]),angular.module("employeeApp").controller("SupplyFoamAddCtrl",["$scope","Foam","Supplier","$location","Notificaiton",function(a,b,c,d,e){a.supplierList=c.query(),a.foam=new b,a.save=function(){a.foam.$save(function(){d.path("/foam")})},a.upload=function(){e.display("Uploading Image...",!1);var b=new FormData;b.append("image",a.images[0]),a.addLength=null,a.addRemark=null,jQuery.ajax("supply/image",{type:"POST",data:b,processData:!1,contentType:!1,success:function(b){e.display("Image Updated"),a.foam.image=a.foam.image||{},angular.copy(b,a.foam.image),a.$apply()}})}}]),angular.module("employeeApp").controller("SupplyFoamViewCtrl",["$scope","Foam",function(a,b){a.foamList=b.query()}]),angular.module("employeeApp.services").factory("Foam",["eaResource",function(a){return a("foam/:id",{id:"@id"})}]),angular.module("employeeApp").controller("AccountingTransactionViewCtrl",["$scope","Transaction",function(a,b){a.transactionList=b.poll().query(),a.$on("$destroy",function(){b.stopPolling()})}]),angular.module("employeeApp").controller("AccountingTransactionAddCtrl",["$scope","Transaction","Notification","$location","Contact",function(a,b,c,d,e){a.transaction=new b,a.contactList=e.query(),a.save=function(){c.display("Saving Transaction...",!1),a.transaction.$save(function(){c.display("Transaction Saved"),d.path("/accounting/transaction")})}}]),angular.module("employeeApp").controller("AccountingTransactionDetailsCtrl",["$scope",function(a){}]),angular.module("employeeApp.services").factory("Transaction",["eaResource",function(a){return a("transaction/:id",{id:"@id"})}]),angular.module("employeeApp.services").factory("eaStorage",[function(){function a(a){function b(a,b){var c;for(c in b){if(!a.hasOwnProperty(c))return!1;if(a[c]!==b[c])return!1}return!0}function c(a){return a.hasOwnProperty("delivery_date")&&(a.delivery_date=new Date(a.delivery_date)),a.hasOwnProperty("time_created")&&(a.time_created=new Date(a.time_created)),a.hasOwnProperty("last_login")&&(a.last_login=new Date(a.last_login)),a}function d(a){this.namespace=a,this.collection=this.__loadFromStorage__(this.namespace)||{}}return d.__defineGetter__("length",function(){return"ok"}),d.prototype.__save__=function(a){a.hasOwnProperty("id")&&(this.collection[a.id]=a)},d.prototype.__saveToStorage__=function(a,b){window.localStorage.setItem(a,JSON.stringify(b))},d.prototype.__loadFromStorage__=function(a){return JSON.parse(window.localStorage.getItem(a))},d.prototype.query=function(a){if("object"==typeof a){var d,e=[];for(d in this.collection)b(this.collection[d],a)&&(this.collection[d]=c(this.collection[d]),e.push(this.collection[d]));return e}throw new TypeError("Arguments must be in the form of a key:value object")},d.prototype.save=function(a){var b;if("[object Array]"===Object.prototype.toString.call(a))for(b in a)this.__save__(a[b]);else this.__save__(a);this.__saveToStorage__(this.namespace,this.collection)},d.prototype.get=function(a){return this.collection[a]?c(this.collection[a]):null},d.prototype.iterate=function(a){var b;for(b in this.collection)this.collection.hasOwnProperty(b)&&a(c(this.collection[b]))},d.prototype.remove=function(a){var b="object"==typeof a?a.hasOwnProperty("id")?a.id:null:a;this.collection.hasOwnProperty(b)&&(delete this.collection[b],this.__saveToStorage__(this.namespace,this.collection))},new d(a)}return a}]),angular.module("employeeApp.services").factory("eaResource",["eaStorage","$rootScope","$http","$q","$parse","$resource","$timeout","eaIndexedDB","Notification",function(a,b,c,d,e,f,g,h,i){function j(c,d,j){function k(a,b){var c={};return b=angular.extend({},d,b),angular.forEach(b,function(b,d){angular.isFunction(b)&&(b=b()),c[d]=b.charAt&&"@"==b.charAt(0)?v(a,b.substr(1)):b}),c}function l(a,b){for(var c=0;c<a.length;c++)if(a[c].hasOwnProperty("id")&&a[c].id==b)return c;return-1}function m(a){angular.extend(this,a||{}),this.$$poll=!1,this.$$last_checked=null,this.$$timeout=null,this.$$date=!0}var n,o,p,q={get:{method:"GET"},save:{method:"POST"},update:{method:"PUT"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},"delete":{method:"DELETE"}},r=new f(c,d,j),s=(a(c.split(/\//g)[0]),h(c)),t=!0,u=!0,v=function(a,b){return e(b)(a)};return j=angular.extend({},q,j),m.disableLastChecked=function(){t=!1},m.prototype.disableLastChecked=m.disableLastChecked,m.poll=function(){return this.$$poll=!0,u=!0,this},m.prototype.poll=m.poll,m.stopPolling=function(){return this.$$poll=!1,u=!1,this},m.prototype.poll=m.poll,angular.forEach(j,function(a,c){var d="POST"==a.method||"PUT"==a.method||"PATCH"==a.method;m[c]=function(e,f,h,j){var k,q={},u=angular.noop,v=null;switch(arguments.length){case 4:v=j,u=h;case 3:case 2:if(!angular.isFunction(f)){q=e,k=f,u=h;break}if(angular.isFunction(e)){u=e,v=f;break}u=f,v=h;case 1:angular.isFunction(e)?u=e:d?k=e:q=e;break;case 0:break;default:throw"Expected between 0-4 arguments [params, data, success, error], got "+arguments.length+" arguments."}(o!=c||q!=p)&&(this.$$last_checked=void 0),a.isArray?n=angular.isArray(n)?n||[]:[]:(n=angular.isObject(n)&&!n.hasOwnProperty("length")?n||{}:{},n=this instanceof m?this:new m(n)),"GET"!=a.method||this.$$last_checked||(s.ready?a.isArray?s.query(function(a){var c=function(){for(var b in a){var c=l(n,a[b].id);if(-1!=c)angular.copy(a[b],n[c]);else try{n.push(new m(a[b]))}catch(d){console.warn(d.stack)}}(u||angular.noop)(n)};"$apply"==b.$$phase||"$digest"==b.$$phase?c():b.$apply(function(){c()})}):s.get(q.id,function(a){var c=function(){angular.copy(new m(a),n),(u||angular.noop)(n)};"$digest"==b.$$phase||"$apply"==b.$$phase?c():b.$apply(function(){c()})}):a.isArray?s.onready=function(){s.query(function(a){var c=function(){for(var b in a){var c=l(n,a[b].id);if(-1!=c)angular.copy(a[b],n[c]);else try{n.push(new m(a[b]))}catch(d){console.warn(d.stack)}}(u||angular.noop)(n)};"$digest"==b.$$phase||"$apply"==b.$$phase?c():b.$apply(function(){c()})})}:s.onready=function(){s.get(q.id,function(a){var c=function(){angular.copy(new m(a),n),(u||angular.noop)(n)};"$digest"==b.$$phase||"$apply"==b.$$phase?c():b.$apply(function(){c()})})}),void 0!==this.$$last_checked&&"GET"==a.method&&angular.extend(q,{last_modified:this.$$last_checked.toISOString()});r[c](q,k,function(b){if(("DELETE"==a.method||d)&&angular.extend(this,b),"GET"===a.method)if(a.isArray||angular.isArray(b)){var e;for(var f in b)if(e=l(n,b[f].id),e>-1){if(!angular.equals(n[e],b[f])&&(angular.extend(n[e],new m(b[f])),n[e].deleted)){n.splice(e,1);var h=[];h.splice(e)}}else if(!b[f].deleted)try{n.push(new m(b[f]))}catch(j){console.warn(j.stack)}}else b.deleted?(angular.copy({},n),i.display("This resource no longer exists.")):angular.extend(n,new m(b));s.ready&&("DELETE"==a.method?s.remove(q):d?s.save(this):s.save(n)),t&&(this.$$last_checked=new Date),this.$$poll&&"GET"==a.method&&(this.$$timeout=g(function(){var a=m[c].bind(this);a(q,k,u,v)}.bind(this),3e4)),u(b)}.bind(this),function(a){});return o=c,p=q,n},m.prototype["$"+c]=function(a,b,e){var f,g=k(this),h=angular.noop;switch(arguments.length){case 3:g=a,h=b,f=e;break;case 2:case 1:angular.isFunction(a)?(h=a,f=b):(g=a,h=b||angular.noop);break;case 0:break;default:throw"Expected between 1-3 arguments [params, success, error], got "+arguments.length+" arguments."}var i=d?this:void 0;m[c].call(this,g,i,h,f)}}),m}return j}]),angular.module("employeeApp.services").factory("scanner",["$location","$rootScope","$timeout",function(a,b,c){function d(a){this._identity=a,this._activeParse=!1,this.enabled=!1,this._onscan=null,this.f=o.bind(this),Object.defineProperties(this,{_code:{get:function(){return f}}})}function e(a){return new d(a)}var f="",g="",h="",i=[[/^PO-\d+$/,"/order/purchase_order/"],[/^A-\d+$/,"/order/acknowledgement/"],[/^AI-\d+$/,"/order/acknowledgement/item/"],[/^S-\d+$/,"/order/shipping/"]],j=[],k=!0,l=0,m=/^METROLOGICK07[A-Z]\-\d+$/,n=/[A-Z]\-\d+$/,o=function(a){this._check(a)};return d.prototype.stringCheck=function(a){c.cancel(l);var b,d=a.keyCode;d>=96&&105>=d||d>=48&&90>=d?(b=String.fromCharCode(d>=96&&105>=d?d-48:d),h+=b):189===d&&(b="-",h+=b),l=c(function(){m.test(h)&&(g=n.exec(h),g&&(f=g[0],this._dispatch(f)),h="")}.bind(this),500,!1)},d.prototype._check=function(a,b){this.stringCheck(a),76===a.keyCode&&a.altKey?(a.preventDefault(),this._activeParse=!0):a.altKey&&71==a.keyCode?(a.preventDefault(),this._activeParse=!1,this._dispatch(f),f=""):this._activeParse&&(a.preventDefault(),this._parse(a))},d.prototype._parse=function(a){var b=a.keyCode;if(b>=96&&105>=b||b>=48&&90>=b){var c=String.fromCharCode(b>=96&&105>=b?b-48:b);f+=c}else 189===b&&(f+="-")},d.prototype._dispatch=function(c){if(g=c.split("-"),k)for(var d=0;d<i.length;d++)i[d][0].test(c)&&(g=c.split("-"),b.safeApply(function(){a.path(i[d][1]+g[1])}));for(var e=0;e<j.length;e++)j[e][0].test(c)&&j[e][1](c)},Object.defineProperties(d.prototype,{standardEnabled:{get:function(){return k}}}),d.prototype.enable=function(){angular.element(document.body).on("keydown",this.f),this.enabled=!0},d.prototype.disable=function(){angular.element(document.body).off("keydown",this.f),this.enabled=!1},d.prototype.disableStandard=function(){k=!1},d.prototype.enableStandard=function(){k=!0},d.prototype.register=function(a,b){j.push([a,b])},d.deregister=function(a){for(var b=0;b<j.length;b++)j[b][0]==a&&j.splice(b)},d.prototype.destroy=function(){this.disable()},Object.defineProperty(d.prototype,"onscan",{set:function(a){this._onscan=a}}),e}]),angular.module("employeeApp").controller("OrderAcknowledgementDetailsCtrl",["$scope","Acknowledgement","$routeParams","$http","$window","Notification","FileUploader","Project","$mdDialog","Fabric",function(a,b,c,d,e,f,g,h,i,j){var k=f.display("Retrieving acknowledgement...",!1);a.showCal=!1,a.ack=b.get({id:c.id,pdf:!0},function(){if(k.hide(),a.projects.length>0&&a.acknowledgement.project){var b=a.projects.indexOfById(a.acknowledgement.project.id);a.acknowledgement.project=a.projects[b]}}),a.projects=h.query({limit:0,page_size:1e3},function(){if(a.acknowledgement.id&&a.acknowledgement.project){var b=a.projects.indexOfById(a.acknowledgement.project.id);a.acknowledgement.project=a.projects[b]}}),a.fabrics=j.query({limit:0,page_size:1e3}),a.hasEvent=function(a,b){for(var c in a.logs)if(a.logs[c].hasOwnProperty("message")&&a.logs[c].message.indexOf(b)>-1)return!0;return!1},a.getPDF=function(b){try{var c=a.acknowledgement.pdf[b.toLowerCase()];e.open(c)}catch(d){var g="Missing "+b+" pdf for Acknowledgement #"+a.acknowledgement.id;throw f.display(g,!1),new Error(g)}},a.viewLog=function(){d.get("acknowledgement/"+a.acknowledgement.id+"/log").success(function(b){angular.forEach(b,function(b){a.logs=a.logs||[],a.logs.push(b),a.showLog=!0})})},a.addFiles=function(b){a.acknowledgement.files=a.acknowledgement.files||[];for(var c=0;c<b.length;c++){a.acknowledgement.files.push({filename:b[c].name});var d=g.upload(b[c],"/api/v1/acknowledgement/file/");d.then(function(b){for(var c=b.data||b,d=0;d<a.acknowledgement.files.length;d++)c.filename==a.acknowledgement.files[d].filename&&angular.extend(a.acknowledgement.files[d],c);a.acknowledgement.$update()},function(){})}},a.changeFabric=function(b){i.show({templateUrl:"views/templates/change-fabric.html",controllerAs:"ctrl",locals:{item:a.acknowledgement.items[b],fabrics:a.fabrics},controller:"DialogsChangeFabricCtrl",bindToController:!0})},a.save=function(){var b=f.display("Saving acknowledgement...",!1);a.acknowledgement.$update(function(c){b.hide(),f.display("Acknowledgement "+a.acknowledgement.id+" saved.",2e3);var d=a.projects.indexOfById(a.acknowledgement.project.id);a.acknowledgement.project=a.projects[d];for(var e=0;e<a.acknowledgement.items.length;e++){a.acknowledgement.items[e].quantity=Number(a.acknowledgement.items[e].quantity),a.acknowledgement.items[e].unit_price=Number(a.acknowledgement.items[e].unit_price),a.acknowledgement.items[e].fabric_quantity=Number(a.acknowledgement.items[e].fabric_quantity);for(var g=0;g<a.acknowledgement.items[e].pillows.length;g++)a.acknowledgement.items[e].pillows[g].fabric_quantity=Number(a.acknowledgement.items[e].pillows[g].fabric_quantity)}},function(){f.display("Failed to save acknowledgement "+a.acknowledgement.id,!1)})}}]),angular.module("employeeApp").directive("scanner",["$location","$rootScope",function(a,b){function c(c){var d=c.split("-");if(d.length>1)switch(d[0]){case"A":b.$apply(function(){a.path("/order/acknowledgement/"+d[1])});break;case"S":b.$apply(function(){a.path("/order/shipping/"+d[1])})}}var d="";return{restrict:"A",link:function(a,b,e){b.keyup(function(a){var b=a.keyCode;if(b>=96&&105>=b||b>=48&&90>=b){var e=String.fromCharCode(b>=96&&105>=b?b-48:b);d+=e}else switch(b){case 13:c(d),d="";break;case 189:d+="-"}})}}}]),angular.module("employeeApp.services").factory("dateParser",["$q",function(a){function b(a){return a.hasOwnProperty("delivery_date")&&(a.delivery_date=new Date(a.delivery_date)),a.hasOwnProperty("time_created")&&(a.time_created=new Date(a.time_created)),a.hasOwnProperty("last_login")&&(a.last_login=new Date(a.last_login)),a}return{response:function(c){try{var d=c.data;if(angular.isArray(d))for(var e=0;e<d.length;e++)try{d[e]=b(d[e])}catch(f){}else angular.isObject(d)&&(d=b(d));c.data=d}catch(f){}return c||a.when(c)},responseError:function(b){return a.reject(b)}}}]).config(function(a){a.interceptors.push("dateParser")}),angular.module("employeeApp.services").factory("Permission",["$resource",function(a){return a("/api/v1/permission/:id",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp").controller("OrderAcknowledgementWeeklyCtrl",["$scope","Acknowledgement",function(a,b){a.startDate=new Date,a.endDate=new Date,a.endDate.setDate(a.endDate.getDate()+7),a.ackList=b.query({start_date:a.startDate.toISOString(),end_date:a.endDate.toISOString()})}]),angular.module("employeeApp").controller("OrderAcknowledgementDailyCtrl",["$scope","Acknowledgement",function(a,b){a.today=new Date,a.ackList=b.query({date:a.today.toISOString()})}]),angular.module("employeeApp").controller("OrderShippingDetailsCtrl",["$scope","Shipping","$routeParams","$mdToast","$http",function(a,b,c,d,e){d.show(d.simple().content("Loading Shipping Manifest...").hideDelay(0)),a.showCal=!1,a.shipping=b.get({id:c.id,pdf:!0},function(){d.hide()}),a.updateDeliveryDate=function(){a.showCal=!1},a.getPDF=function(){d.show(d.simple().content("Retrieving PDF...")),a.shipping.pdf.url&&window.open(a.shipping.pdf.url)},a.save=function(){d.show(d.simple().content("Saving Shipping Manifest...").hideDelay(0)),a.shipping.$update(function(){d.show(d.simple().content("Shipping manifest "+a.shipping.id+" saved").hideDelay(0))})}}]),angular.module("employeeApp.directives").directive("tooltipPopup",function(){return{restrict:"EA",replace:!0,scope:{tooltipTitle:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"views/templates/tooltip-popup.html"}}).directive("tooltip",["$compile","$timeout","$parse","$window",function(a,b,c,d){var e='<tooltip-popup tooltip-title="{{tt_tooltip}}" placement="{{tt_placement}}" animation="tt_animation()" is-open="tt_isOpen"></tooltip-popup>';return{scope:!0,link:function(f,g,h){function i(){var a=g[0].getBoundingClientRect();return{width:g.prop("offsetWidth"),height:g.prop("offsetHeight"),top:a.top+d.pageYOffset,left:a.left+d.pageXOffset}}function j(){var a,c,d,e;if(f.tt_tooltip){switch(l&&b.cancel(l),m.css({top:0,left:0,display:"block"}),g.after(m),a=i(),c=m.prop("offsetWidth"),d=m.prop("offsetHeight"),f.tt_placement){case"right":e={top:a.top+a.height/2-d/2+"px",left:a.left+a.width+"px"};break;case"bottom":e={top:a.top+a.height+"px",left:a.left+a.width/2-c/2+"px"};break;case"left":e={top:a.top+a.height/2-d/2+"px",left:a.left-c+"px"};break;default:e={top:a.top-d+"px",left:a.left+a.width/2-c/2+"px"}}m.css(e),f.tt_isOpen=!0}}function k(){f.tt_isOpen=!1,angular.isDefined(f.tt_animation)&&f.tt_animation()?l=b(function(){m.remove()},500):m.remove()}var l,m=a(e)(f),n={focus:"blur",mouseenter:"mouseleave"},o=(h.tooltipTrigger||"mouseenter").toLowerCase();h.$observe("tooltip",function(a){f.tt_tooltip=a}),h.$observe("tooltipPlacement",function(a){f.tt_placement=a||"right"}),h.$observe("tooltipAnimation",function(a){f.tt_animation=c(a)}),f.tt_isOpen=!1,g.bind(o||"mouseenter",function(){f.$apply(j)}),g.bind(n[o]||"mouseleave",function(){f.$apply(k)})}}}]),angular.module("employeeApp").controller("OrderAcknowledgementItemDetailsCtrl",["$scope","$routeParams","AcknowledgementItem","Fabric","Notification","$location",function(a,b,c,d,e,f){a.fabricList=d.query(),a.item=c.get({id:b.id}),a.save=function(){e.display("Saving"+a.item.description+"...",!1),a.item.$save(function(){e.display(a.item.description+" saved")},function(){e.display("There was an error in saving "+a.item.description,!1)})},a.remove=function(){e.display("Deleting "+a.item.description,!1),a.item.$delete(function(){e.display("Deleting "+a.item.description),f.path("/order/acknowledgement")})}}]),angular.module("employeeApp").factory("AcknowledgementItem",["$resource",function(a){return a("/api/v1/acknowledgement-item/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp").controller("SupplyPropViewCtrl",["$scope","Supply","$filter","$q","Notification","$location",function(a,b,c,d,e,f){a.supplyList=b.query({type:"prop"}),a.add=function(){a.safeApply(function(){f.path("/supply/prop/add")})},a.upload=function(b,f){e.display("Uploading Image...",!1);var g,h,i=c("orderBy")(c("filter")(a.supplyList,a.query),"supplier.name")[b],j=new FormData;g=d.defer(),h=g.promise,h.then(function(b){e.display("Image Updated"),a.safeApply(function(){i.image=i.image||{},angular.copy(b,i.image),i.$save(function(){e.display("Prop Saved")})})},function(a){e.display("Unable to Upload Image")}),j.append("image",f),jQuery.ajax("supply/image",{type:"POST",data:j,processData:!1,contentType:!1,success:function(a){g.resolve(a)},error:function(){g.reject()}})}}]),angular.module("employeeApp").controller("SupplyPropAddCtrl",["$scope","Supplier","Supply","Notification","$location","$q",function(a,b,c,d,e,f){var g,h,i=!1;a.supplierList=b.query(),a.prop=new c,a.prop.type="prop",a.supplierText="Choose a Supplier for this Fabric",a.referenceText="Enter the Supplier's Reference Number",a.widthText="Enter the Width in millimeters",a.depthText="Enter the Depth in millimeters",a.heightText="Enter the Height in millimeters",a.cost="Enter the Cost in the format of 100 or 123.45",a.save=function(){if(a.form.$valid){if(i){var b=angular.copy(a.prop);h.then(function(a){b.image=b.image||{},angular.copy(a,b.image),d.display("Saving Prop...",!1),b.$save(function(){d.display("Prop Saved")})},angular.noop)}else d.display("Saving Prop...",!1),a.prop.$save(function(){d.display("Prop Saved")});e.path("/supply/prop")}},a.upload=function(){d.display("Uploading Image...",!1);var b=new FormData;b.append("image",a.images[0]),a.addLength=null,a.addRemark=null,g=f.defer(),h=g.promise,h.then(function(b){d.display("Image Updated"),a&&a.$apply(function(){a.prop.image=a.prop.image||{},angular.copy(b,a.prop.image)})},function(a){d.display("Unable to Upload Image")}),i=!0,jQuery.ajax("supply/image",{type:"POST",data:b,processData:!1,contentType:!1,success:function(a){g.resolve(a)},error:function(){g.reject()}})}}]),angular.module("employeeApp").factory("Supply",["$resource",function(a){return a("/api/v1/supply/:id/",{id:"@id"},{create:{method:"POST"},update:{method:"PUT"},add:{method:"POST",params:{action:"add"}},subtract:{method:"POST",params:{action:"subtract"}}})}]),angular.module("employeeApp").controller("SupplyPropDetailsCtrl",["$scope",function(a){}]),angular.module("employeeApp").directive("searchBar",["$compile",function(a){"use strict";return{restrict:"A",scope:{query:"=ngModel"},link:function(b,c,d){function e(a){"70"==a.which&&(a.metaKey||a.ctrlKey)&&(a.preventDefault(),b.$apply(function(){c.hasClass("focus")?(f.blur(),c.removeClass("focus")):(f.focus(),c.addClass("focus"))}))}var f=null,g=d.ngModel||"query";c.addClass("search-bar"),void 0!==d.searchBarDate?(f=angular.element('<div data-ng-model="'+g+'" class="datepicker" ui-date></div>'),c.addClass("date")):f=angular.element('<input size="40" placeholder="Search" ng-model="query" />');var h=angular.element("<span class='close-button'>&times;</span>");a(f)(b),c.append(f),c.append(h),$(window).on("keydown",e),h.click(function(){try{b.$apply(function(){b.query=""})}catch(a){}}),b.$on("$destroy",function(){$(window).off("keydown",e)})}}}]),angular.module("employeeApp").directive("eaSave",[function(){return{restrict:"A",link:function(a,b,c){b.text("this is the eaSave directive")}}}]),angular.module("employeeApp").directive("eaAdd",[function(){return{restrict:"A",link:function(a,b,c){function d(b){"65"==b.which&&(b.metaKey||b.ctrlKey)&&(b.preventDefault(),a.$eval(c.eaAdd))}$(window).on("keydown",d),a.$on("$destroy",function(){$(window).off("keydown",d)})}}}]),angular.module("employeeApp.directives").directive("imageCropper",["Notification","$compile","$log",function(a,b,c){function d(a,b,c){this.ctx=b,this.canvas=a,this.img=c,this._scale=1,this.bX=0,this.bY=0,this.bH=this.img.height,this.bW=this.img.width,this.cropX=null,this.cropY=null,this.cropW=null,this.cropH=null,this.mouseX=null,this.mouseY=null,this.corners=[],this.xProportion=this.canvas.width/this.img.width,this.yProportion=this.canvas.height/this.img.height}return Object.defineProperties(d.prototype,{scale:{get:function(){return this._scale},set:function(a){this._scale=1>=a?a:a/100}},x:{get:function(){return this.bX},set:function(a){this.bX=a}},y:{get:function(){return this.bY},set:function(a){this.bY=a}},w:{get:function(){return this.bW},set:function(a){this.bW=a}},h:{get:function(){return this.bH},set:function(a){this.bH=a}}}),d.prototype.repositionCorners=function(){this.corners.topLeft={x:this.bX*this.xProportion,y:this.bY*this.yProportion},this.corners.topRight={x:(this.bX+this.bW)*this.xProportion,y:this.bY*this.yProportion},this.corners.bottomRight={x:(this.bX+this.bW)*this.xProportion,y:(this.bY+this.bH)*this.yProportion},this.corners.bottomLeft={x:this.bX*this.xProportion,y:(this.bY+this.bH)*this.yProportion}},d.prototype.inCorner=function(a,b){for(var c in this.corners)if(Math.sqrt(Math.pow(a-this.corners[c].x,2)+Math.pow(b-this.corners[c].y,2))<=10)return c},d.prototype.drawCube=function(a,b){this.ctx.beginPath(),this.ctx.arc(a,b,5,0,2*Math.PI,!0),this.ctx.fill()},d.prototype.drawCubes=function(){this.ctx.fillStyle="rgb(255, 255, 255)",this.drawCube(this.bX*this.xProportion,this.bY*this.yProportion),this.drawCube((this.bX+this.bW)*this.xProportion,(this.bY+this.bH)*this.yProportion),this.drawCube((this.bX+this.bW)*this.xProportion,this.bY*this.yProportion),this.drawCube(this.bX*this.xProportion,(this.bY+this.bH)*this.yProportion)},d.prototype.drawBackground=function(){this.ctx.drawImage(this.img,0,0,this.img.width,this.img.height,0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)},d.prototype.draw=function(){this.repositionCorners(),this.drawBackground(),this.ctx.drawImage(this.img,this.bX,this.bY,this.bW,this.bH,this.bX*this.xProportion,this.bY*this.yProportion,this.bW*this.xProportion,this.bH*this.yProportion),this.drawCubes()},d.prototype.drawImage=function(){this.ctx.drawImage(this.img,0,0,this.img.width,this.img.height,0,0,this.canvas.width,this.canvas.height)},d.prototype.crop=function(a,b){if(b&&a){var c=b/a,d=this.bH/this.bW;c>d?(this.canvas.width=a,this.canvas.height=this.bH*a/this.bW,angular.element(this.canvas).css("top",(b-this.canvas.height)/2),angular.element(this.canvas).css("left",(a-this.canvas.width)/2)):(this.canvas.height=b,this.canvas.width=this.bW*b/this.bH,angular.element(this.canvas).css("left",(a-this.canvas.width)/2),angular.element(this.canvas).css("top",(b-this.canvas.height)/2))}else this.canvas.width=this.bW,this.canvas.height=this.bH;this.ctx.drawImage(this.img,this.x,this.y,this.w,this.h,0,0,this.canvas.width,this.canvas.height)},d.prototype.getImageAsURL=function(){var a=document.createElement("canvas"),b=a.getContext("2d");return a.width=this.w*this._scale,a.height=this.h*this._scale,b.drawImage(this.img,this.x,this.y,this.w,this.h,0,0,this.w*this._scale,this.h*this._scale),a.toDataURL("image/jpeg")},d.prototype.getImageAsBlob=function(){var a=this.getImageAsURL(),b=atob(a.split(",")[1]),c=new Uint8Array(b.length);for(var d in b)c[d]=b.charCodeAt(d);return new Blob([c],{type:"image/jpeg"})},{restrict:"A",template:'<div class="cropper">                        <div class="cropper-message" ng-show="!cropper.image.loaded"><h3>Drop Image Here</h3></div>                        <div class="cropper-controller" ng-show="cropper.image.loaded">                            <button ng-click="cropper.crop()" ng-show="!cropper.cropping">Crop</button>                            <button ng-click="cropper.save()" ng-show="cropper.cropping">Done Cropping</button>                            <button ng-click="save()" ng-show="!cropper.cropping">Save</button>                            <button data-ng-click="preview(cropper.getImageAsURL())">Preview</button>                            <table class="cropper-scale">                                <tr>                                    <td>Scale:</td>                                    <td><input class="scale" type="number" data-ng-model="cropper.scale" min="0" max="100">%</td>                                </tr>                                <tr>                                    <td>Width</td>                                    <td>{{cropper.image.scaled_width | number:0}}px</td>                                </tr>                                <tr>                                    <td>Height</td>                                    <td>{{cropper.image.scaled_height | number:0}}px</td>                                </tr>                            </table>                        </div>                        <div class="canvas-container" ng-class="{show:cropper.image.loaded}">                            <canvas class="cropper-canvas"></canvas>                        </div>                    </div>',replace:!0,scope:{onSave:"&",onLoad:"&"},link:function(b,e,f){function g(a){a.preventDefault(),v=!0,k=a.offsetX,l=a.offsetY,m=n.inCorner(a.offsetX,a.offsetY),n.canvas.style.cursor="move"}function h(a){if(v){if(m)switch(m){case"topLeft":n.w=n.w+(k-a.offsetX)/n.xProportion,n.h=n.h+(l-a.offsetY)/n.yProportion,n.y=n.y-(l-a.offsetY)/n.yProportion,n.x=n.x-(k-a.offsetX)/n.xProportion;break;case"topRight":n.w=n.w-(k-a.offsetX)/n.xProportion,n.h=n.h+(l-a.offsetY)/n.yProportion,n.y=n.y-(l-a.offsetY)/n.yProportion;break;case"bottomRight":n.w=n.w-(k-a.offsetX)/n.xProportion,n.h=n.h-(l-a.offsetY)/n.yProportion;break;case"bottomLeft":n.x=n.x-(k-a.offsetX)/n.xProportion,n.h=n.h-(l-a.offsetY)/n.yProportion,n.w=n.w+(k-a.offsetX)/n.xProportion}else{var c=n.corners.topLeft,d=n.corners.bottomRight;c.y-(l-a.offsetY)>0&&d.y-(l-a.offsetY)<n.img.height*n.yProportion?n.y=n.y-(l-a.offsetY)/n.yProportion:n.y=c.y-(l-a.offsetY)<=0?0:(n.canvas.height-(d.y-c.y))/n.yProportion,
c.x-(k-a.offsetX)>0&&d.x-(k-a.offsetX)<n.img.width*n.xProportion?n.x=n.x-(k-a.offsetX)/n.xProportion:n.x=c.x-(k-a.offsetX)<=0?0:(n.canvas.width-(d.x-c.x))/n.xProportion}k=a.offsetX,l=a.offsetY,n.draw(),b.$apply()}}function i(a){v=!1,m=!1}function j(a){v=!1,m=!1}var k,l,m,n,o,p=e.find(".canvas-container"),q=p.find("canvas"),r=p.find("canvas")[0],s=e,t=new FileReader,u=r.getContext("2d"),v=!1;r.width=p.outerWidth(),r.height=p.outerHeight(),t.onload=function(e){s.removeClass("drag-drop-active"),o=new Image,o.onload=function(e){a.display("Image Rendered");var f=p.outerHeight(),g=p.outerWidth(),h=f/g,i=o.height/o.width;h>i?(r.width=g,r.height=o.height*g/o.width):(r.height=f,r.width=o.width*f/o.height),angular.element(r).css("top",(f-r.height)/2),angular.element(r).css("left",(g-r.width)/2),n=new d(r,u,o),n.drawImage();try{b.onLoad()}catch(j){c.warn(j)}b.$apply()},o.src=e.target.result},e.bind("dragenter",function(a){a.preventDefault(),s.addClass("drag-drop-active")}),e.bind("dragleave",function(a){a.preventDefault(),s.removeClass("drag-drop-active")}),e.bind("dragover",function(a){a.preventDefault(),s.addClass("drag-drop-active")}),e.bind("drop",function(b){b.preventDefault(),b.stopPropagation(),a.display("Processing Image...",!1),s.removeClass("drag-drop-active");var c=b.originalEvent,d=c.dataTransfer.files[0];t.readAsDataURL(d)}),b.cropper={cropping:!1,image:{}},Object.defineProperties(b.cropper,{scale:{get:function(){return n?100*n.scale:100},set:function(a){n&&(n.scale=a)}}}),Object.defineProperties(b.cropper.image,{width:{get:function(){return n&&n.w?n.w:0}},height:{get:function(){return n&&n.h?n.h:0}},scaled_height:{get:function(){return n&&n.h?n.h*n.scale:0}},scaled_width:{get:function(){return n&&n.w?n.w*n.scale:0}},loaded:{get:function(){return n?!0:!1}}}),b.cropper.crop=function(){b.cropper.cropping=!0,n.x=10,n.y=10,n.w=n.w-20,n.h=n.h-20,n.canvas.style.cursor="move",n.draw(),q.bind("mousedown",g),q.bind("mousemove",h),q.bind("mouseup",i),q.bind("mouseleave",j)},b.cropper.save=function(){b.cropper.cropping=!1,n.canvas.style.cursor="move",n.crop(p.innerWidth(),p.innerHeight()),q.unbind("mousedown",g),q.unbind("mousemove",h),q.unbind("mouseup",i),q.unbind("mouseleave",j)},b.cropper.upload=function(){},b.cropper.getImage=function(){return n?n.getImageAsBlob():null},b.cropper.getImageAsURL=function(){return b.cropper.getImageURL()},b.cropper.getImageURL=function(){return n?n.getImageAsURL():null},b.preview=function(a){a&&window.open(a)},b.cropper.reset=function(){n=void 0},b.save=function(){b.onSave({$image:b.cropper.getImage()}),b.cropper.reset()}}}}]),angular.module("employeeApp.services").factory("indexOfId",["$q",function(a){function b(){this.worker=new Worker("scripts/workers/index-of-id.js")}b.prototype._prepare_id=function(a){},b.prototype.filter=function(a,b,c){this._prepare_id(a);this.worker.onmessage=function(a){(c||angular.noop)(a.data)}}}]),angular.module("employeeApp").controller("SupplyLumberViewCtrl",["$scope",function(a){}]),angular.module("employeeApp.services").factory("Contact",["eaResource",function(a){return a("contact/:id/",{id:"@id"})}]),angular.module("employeeApp.services").factory("DB",["$q","$timeout","$rootScope",function(a,b,c){function d(){var a,b=indexedDB.open("employee",h);b.onsuccess=function(a){g=a.target.result},b.onerror=function(a){console.log("Error opening indexedDB"),console.dir(a)},b.onupgradeneeded=function(b){console.log("Upgrading the indexedDB.."),g=b.target.result;for(var c=0;c<i.length;c++){var d=i[c];a=g.objectStoreNames.contains(d.resourceName)?g.transaction.objectStore(d.resourceName):g.createObjectStore(d.resourceName,{keyPath:d.keyPath});for(var e=0;e<d.indexes.length;e++){var f=d.indexes[e];a.indexNames.contains(f)||a.createIndex(f,f,{unique:!1})}}}}function e(b){this.resourceName=b,g||d(),this.query=function(){var b=a.defer(),c=g.transaction([this.resourceName]);return c.openCursor().onsuccess=function(a){var c=[],d=a.target.result;d?(c.append(d.value),d["continue"]()):b.resolve(c)},b.promise},this.get=function(b){var c=a.defer(),d=g.transaction([this.resourceName]),e=d.get(b);return e.onsuccess=function(a){var b=e.result;c.resolve(b)},c.promise},this.create=function(b){var c=a.defer(),d=g.transaction([this.resourceName],"readwrite"),e=d.add(object);return e.onsucces=function(a){c.resolve()},e.onerror=function(a){console.log(a.target.error.name)},c.promise},this.update=function(b){var c=a.defer(),d=g.transaction([this.resourceName],"readwrite"),e=d.put(object);return e.onsucces=function(a){c.resolve()},e.onerror=function(a){console.log(a.target.error.name)},c.promise}}function f(a){return new e(a)}var g,h=1,i=[{resourceName:"supply",keyPath:"id",indexes:["id","supplier"]},{resourceName:"acknowledgement",keyPath:"id",indexes:["id","delivery_date"]}];return window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,f}]),angular.module("employeeApp").controller("ProductInventoryCtrl",["$scope","AcknowledgementItem",function(a,b){a.itemList=b.poll().query({status:"inventory"}),a.showAddInventory=!1,a.addInventory=function(c){a.item=new b,angular.extend(a.item,JSON.parse(JSON.stringify(c))),c.hasOwnProperty("id")&&(a.item.product={id:c.id}),delete a.item.id,a.item.status="INVENTORY",a.item.$save(function(){a.itemList.push(angular.copy(a.item))})},a.$on("$destroy",function(){a.AcknowledgementItem.stopPolling()})}]),angular.module("employeeApp.services").factory("Geocoder",["$q","$rootScope","$log",function(a,b,c){function d(a){var b="";if(!a.hasOwnProperty("address")&&!a.hasOwnProperty("address1"))throw new TypeError("Missing 'address' or 'address1' argument");if(b+=a.address||a.address1,!a.hasOwnProperty("city"))throw new TypeError("Missing 'city' argument");if(b+=", "+a.city,!a.hasOwnProperty("territory"))throw new TypeError("Missing 'territory' argument");if(b+=", "+a.territory,!a.hasOwnProperty("country"))throw new TypeError("Missing 'country' argument");if(b+=", "+a.country,!a.hasOwnProperty("zipcode"))throw new TypeError("Missing 'zipcode' argument");return b+=", "+a.zipcode}function e(){this.google="google"in window?window.google:{maps:{Geocoder:angular.noop,LatLng:angular.noop}},this.geocoder=new this.google.maps.Geocoder,this.initialized="google"in window?!0:!1}return e.prototype._getRegion=function(a){switch(a.toLocaleLowerCase()){case"thailand":return"TH";case"usa":return"US";case"us":return"US";case"italy":return"IT";case"spain":return"ES";case"germany":return"DE";case"china":return"CN";case"india":return"IN";case"new zealand":return"NZ";case"australia":return"AU";default:return!1}},e.prototype._lookup=function(a,b,e){var f=d(a);this.geocoder.geocode({address:f,region:this._getRegion(a.country)},function(a,d){d==google.maps.GeocoderStatus.OK?(b||angular.noop)(a):(c.error(d),(e||angular.noop)(d))})},e.prototype.geocode=function(c){if(angular.isObject(c)){var d=a.defer();return this._lookup(c,function(a){b.safeApply(function(){d.resolve(a)})},function(a){b.safeApply(function(){d.reject(a)})}),d.promise}throw new TypeError("Arguments must be in the form of an object.")},e.prototype.reverseGeocode=function(b,c){var d=a.defer(),e=new this.google.maps.LatLng(b,c);try{this.geocoder.geocode({latLng:e},function(a,b){d.resolve(a)})}catch(f){d.reject("ok")}return d.promise},new e}]),angular.module("employeeApp.services").factory("mapMarker",[function(){function a(a){function b(a){if(angular.isObject(a)){if(!(a.map instanceof google.maps.Map))throw new TypeError("Is not an instance of google.maps.Map");if(this._map=a.map,!a.position instanceof google.maps.LatLng)throw new TypeError("Is not an instance of google.maps.LatLng");this.prototype=new google.maps.Marker({position:a.position,map:this._map,draggable:!0,animation:google.maps.Animation.DROP}),google.maps.event.addListener(this,"dragend",function(a){(this.onchange||angular.noop)({lat:this.lat,lng:this.lng})}.bind(this))}}return Object.defineProperties(b.prototype,{lat:{get:function(){return this.getPosition().lat()||null}},lng:{get:function(){return this.getPosition().lng()||null}}}),b.prototype.setPosition=function(a){a instanceof google.maps.LatLng&&this.setPosition(a)},b.prototype.hide=function(){this.setMap(null)},b.prototype.show=function(){this.setMap(this._map)},b.prototype.focus=function(){this.setCenter(this._marker.getPosition())},new b(a)}return a}]),angular.module("employeeApp").controller("OrderShippingDeliveryCtrl",["$scope","Delivery",function(a,b){a.deliveryList=b.query()}]),angular.module("employeeApp").factory("Delivery",["eaResource",function(a){return a("delivery/:id",{id:"@id"})}]),angular.module("employeeApp").controller("ProductTableViewCtrl",["$scope","Table","Notification",function(a,b,c){var d=!0;c.display("Loading Tables..."),a.tableList=b.query(function(){d=!1,c.hide()}),a.$watch("query",function(c){c&&b.query({q:c,limit:5},function(b){for(var c=0;c<b.length;c++)-1==a.tableList.indexOfById(b[c])&&a.tableList.push(b[c])})}),a.loadNext=function(){d||b.query({offset:a.tableList.length,limit:50},function(b){for(var c=0;c<b.length;c++)a.tableList.push(b[c])})}}]),angular.module("employeeApp.services").factory("Table",["$resource",function(a){return a("api/v1/table/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp").controller("ProductRugViewCtrl",["$scope",function(a){}]),angular.module("employeeApp").controller("ProductRugAddCtrl",["$scope",function(a){}]),angular.module("employeeApp").directive("background",[function(){return{restrict:"E",link:function(a,b,c){if(!c.backgroundImages)throw new TypeError("Missing Images for Background Directive.")}}}]),angular.module("employeeApp").controller("ProductTableDetailsCtrl",["$scope","Table","$routeParams","$mdToast","$location","FileUploader",function(a,b,c,d,e,f){a.table=b.get({id:c.id}),a.upload=function(){var b=f.upload(a.images[0],"/api/v1/upholstery/image/");b.then(function(b){d.show(d.simple().position("top right").hideDelay(3e3).content("File was uploaded.")),a.table.image=b.data,a.update()},function(){d.show(d.simple().position("top right").hideDelay(0).content("There was an error uploading the file"))})},a.update=function(){a.table.$update(function(){d.show(d.simple().position("top right").hideDelay(3e3).content("Table saved."))})},a.remove=function(){a.table.$delete(function(){e.path("/product/table")})},a.$on("$destroy",function(){a.update()})}]),angular.module("employeeApp").controller("ProductTableAddCtrl",["$scope","Table","Configuration","Model","Notification","$location",function(a,b,c,d,e,f){a.configurationList=c.query({limit:0}),a.modelList=d.query({limit:0}),a.table=new b,a.modelText="Choose a Model",a.configurationText="Choose a Configuration",a.widthText="Enter a Width in millimeters",a.depthText="Enter a Depth in millimeters",a.upload=function(){e.display("Uploading Image...",!1);var b=new FormData;b.append("image",a.images[0]),a.addLength=null,a.addRemark=null,jQuery.ajax("/api/v1/upholstery/image",{type:"POST",data:b,processData:!1,contentType:!1,success:function(b){e.display("Image Uploaded"),a.table.image=a.table.image||{},angular.copy(b,a.table.image),a.$apply(),a.table.$update()}})},a.save=function(){e.display("Saving Table Product..."),a.table.$create(function(){e.display("Table Product Saved"),f.path("/product/table")})}}]),angular.module("employeeApp").controller("ProjectViewCtrl",["$scope","Project","Notification","Customer","$location","$mdDialog","$mdToast","$log",function(a,b,c,d,e,f,g,h){a.showAddProject=!1,a.projects=b.query(),a.customers=d.query(),a.showAddProject=function(){a.project=new b,f.show({templateUrl:"views/templates/add-project.html",controllerAs:"ctrl",controller:function(){this.parent=a}})},a.completeAddProject=function(){f.hide(),g.show(g.simple().content("Creating project...").hideDelay(0)),a.project.$create(function(){g.hide(),e.path("/project/"+a.project.id)},function(){})},a.cancelAddProject=function(){f.hide()},a.$watch("query",function(c){c&&b.query({limit:c.length,q:c},function(b){for(var c=0;c<b.length;c++)-1==a.projects.indexOfById(b[c].id)&&a.projects.push(b[c])})}),a.navigate=function(a){e.path("/project/"+a)},a.$watch("projects",function(a,b){function c(a){g.show(g.simple().position("top right").hideDelay(2e3).content("Project: "+a.codename+" status updated to '"+a.status.toLowerCase()+"'"))}if(a&&b)try{for(var d=0;d<a.length;d++)a[d].id===b[d].id&&a[d].status.toLowerCase()!=b[d].status.toLowerCase()&&(g.show(g.simple().position("top right").hideDelay(0).content("Updating Project: "+a[d].codename+" status...")),a[d].$update(c))}catch(e){h.error(e)}},!0),a.create=function(){c.display("Creating new project...",!1);var d=new b;angular.extend(d,a.project),d.$create(function(b){c.display("New project created."),a.projectList.push(b),a.project={},a.showAddProject=!1})}}]),angular.module("employeeApp").controller("ProjectDetailsCtrl",["$scope","Project","$routeParams","Room","Notification","FileUploader","$http","$timeout","PurchaseOrder","Acknowledgement","$mdDialog","Phase",function(a,b,c,d,e,f,g,h,i,j,k,l){var m;a.showAddRoom=!1,a.flag=!1,a.project=b.get({id:c.id}),a.room={},a.purchaseOrders=i.query({limit:0,project_id:c.id}),a.acknowledgements=j.query({limit:0,project_id:c.id}),a.room=new d,a.roomTypes=["Bedroom","Dining Room","Formal Dining Room","Guest Bedroom","Guest Bathroom","Kitchen","Living Room","Maid's Quaters","Master Bathroom","Master Bedroom","Pantry"],a.addCustomer=function(b){a.showCustomers=!1,a.project.customer=b},a.showAddPhase=function(){a.phase=new l,k.show({templateUrl:"views/templates/add-phase.html",controllerAs:"ctrl",controller:function(){this.parent=a}})},a.completeAddPhase=function(){k.hide();var b=angular.copy(a.phase);b.project=a.project.id,a.phase=void 0,b.$create(function(b){a.project.phases.push(b)})},a.cancelAddPhase=function(){k.hide(),a.phase=void 0},a.showAddRoom=function(){k.show({templateUrl:"views/templates/add-room.html",controllerAs:"ctrl",controller:function(){this.parent=a}})},a.completeAddRoom=function(){k.hide();var b=angular.copy(a.room);b.project=a.project,a.room=new d,b.$create(function(b){a.project.rooms.push(b)})},a.cancelAddRoom=function(){k.hide(),a.room=new d},a.addSupply=function(b){a.showAddSupply=!1;var c=angular.copy(b);c.quantity=0,a.project.supplies=a.project.supplies||[],a.project.supplies.push(c)},a.removeSupply=function(b){a.project.supplies.splice(b,1)},a.addImage=function(b){var c=f.upload(b,"project/room/image");c.then(function(b){a.room.image=b,a.cropper.reset()})},a.addSchematic=function(b){var c=angular.isArray(b)?b[0]:b,d=f.upload(c,"project/room/schematic");d.then(function(b){a.room.schematic=b})},a.addRoom=function(){e.display("Adding "+a.room.description,!1);var b=new d;angular.extend(b,a.room),b.project={id:a.project.id},b.$save(function(c){e.display(a.room.description+" added."),a.showAddRoom=!1,a.project.rooms.push(b)},function(b){a.flag=!0})},a.showCreatePacking=function(){k.show({templateUrl:"views/templates/add-packing-list.html",controllerAs:"ctrl",locals:{project:a.project},controller:"DialogsCreatePackingListCtrl",bindToController:!0})},a.$watch("project.supplies",function(b,c){c&&(h.cancel(m),m=h(function(){e.display("Saving...",!1);var b=angular.copy(a.project);b.$update(function(){e.display("Project "+a.project.codename+" saved")})},750))},!0)}]),angular.module("employeeApp.services").factory("Project",["$resource",function(a){return a("/api/v1/project/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp.services").factory("Room",["$resource",function(a){return a("/api/v1/room/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp.directives").directive("checkmark",[function(){return{restrict:"A",link:function(a,b,c){if(!c.checkmark)throw new TypeError("Missing expression to evaluate.");var d=angular.element('<span class="checkmark">✓</span>');a.$watch(c.checkmark,function(a){a?b.append(d):d.remove()})}}}]),angular.module("employeeApp.directives").directive("x",[function(){return{restrict:"A",link:function(a,b,c){if(!c.x)throw new TypeError("Missing expression to evaluate.");var d=angular.element('<span class="x-mark">𐄂</span>');a.$watch(c.x,function(a){a?b.append(d):d.remove()})}}}]),angular.module("employeeApp").controller("HrEmployeeViewCtrl",["$scope","Employee","Notification","$mdDialog",function(a,b,c,d){var e=!1;a.employees=b.query(),a.save=function(a){c.display("Updating employee: "+a.name+"...",!1),a.$update(function(){c.display("Employee: "+a.name+" updated.")})},a.$watch("query",function(c){c&&b.query({limit:10,q:c},function(b){for(var c=0;c<b.length;c++)-1==a.employees.indexOfById(b[c].id)&&a.employees.push(b[c])})}),a.loadNext=function(){e||(c.display("Loading more employees...",!1),b.query({offset:a.employees.length,limit:50},function(b){c.hide();for(var d=0;d<b.length;d++)-1==a.employees.indexOfById(b[d].id)&&a.employees.push(b[d])}))}}]),angular.module("employeeApp").factory("ProjectItem",["eaResource",function(a){return a("project/item/:id",{id:"@id"})}]),angular.module("employeeApp").directive("productSelector",["Upholstery","Fabric","Table","$rootScope","$mdToast","FileUploader",function(a,b,c,d,e,f){return{templateUrl:"views/templates/product-selector.html",replace:!0,restrict:"A",scope:{visible:"=productSelector",url:"@productSelectorUploadUrl",add:"&productSelectorAdd"},link:function(a,d,e){a.fabricList=b.query(),a.tableList=c.query(),a.product={},a.addImage=function(b){var c=b.hasOwnProperty("data")?b.data:b;a.product.image=c},a.addUpholstery=function(b){if(!b)throw new TypeError("Expecting an Upholstery.");a.product=b,a.selection="quantity"},a.addTable=function(b){if(!b)throw new TypeError("Expecting a Table.");a.product=b,a.selection="quantity"},a.addCustomItem=function(b,c){if(!b)throw new TypeError("Expecting a Custom Item and Image.");angular.extend(a.product,b),a.product.is_custom=!0,a.product.type="custom",a.selection="quantity"},a.setQuantity=function(b){a.product.quantity=b,a.selection="fabric"},a.setFabric=function(){a.visible=!1;var b=angular.copy(a.product);a.reset(),a.add({product:b})},a.reset=function(){a.product={},a.selection="upholstery"}}}}]),angular.module("employeeApp").directive("fileHandler",["$rootScope",function(a){return{template:'<div class="file-handler">                        <div class="file-handler-message" ng-hide="files.length>0">                            <h3>Drop File Here</h3>                        </div>                        <div class="file-handler-list">                            <ul>                                <li ng-repeat="file in files">{{file.name}}</li>                            </ul>                        </div>                   </div>',restrict:"A",scope:{files:"=fileHandler"},replace:!0,link:function(a,b,c){new FileReader;b.bind("dragenter",function(a){a.preventDefault(),b.addClass("drag-drop-active"),b.addClass("drag-over")}),b.bind("dragleave",function(a){a.preventDefault(),b.removeClass("drag-drop-active"),b.removeClass("drag-over")}),b.bind("dragover",function(a){a.preventDefault(),b.addClass("drag-drop-active"),b.addClass("drag-over")}),b.bind("drop",function(c){c.preventDefault(),c.stopPropagation(),b.removeClass("drag-drop-active"),b.removeClass("drag-over");var d=c.originalEvent,e=d.dataTransfer.files;a.files=e})}}}]),angular.module("employeeApp").controller("ProjectRoomDetailsCtrl",["$scope","Room","$routeParams","Notification","$mdDialog","RoomItem","FileUploader","$timeout","$mdToast","Phase","ProjectItemPart",function(a,b,c,d,e,f,g,h,i,j,k){function l(a,b){n[b]=setTimeout(function(a){function b(){i.show(i.simple().hideDelay(2e3).position("top right").content(a.description+" saved."))}i.show(i.simple().hideDelay(0).position("top right").content("Saving "+a.description+"...")),a=new f(angular.copy(a)),a.id?a.$update(b):a.$create(b)},2e3,a)}function m(){a.$watch("room.items",function(a,b){if(a.length===b.length)for(var c=0;c<a.length;c++)angular.equals(a[c],b[c])||(clearTimeout(n[c]),l(a[c],c))},!0)}var n={};a.room=b.get({id:c.id},m),a.room.items=a.room.items||[],a.item=new f,a.addListedItemFiles=function(b,c){a.room.items[c].files=a.room.items[c].files||[];for(var d=0;d<b.length;d++){var e=g.upload(b[d],"/api/v1/acknowledgement/file/");e.then(function(b){var d=b.data||b;a.room.items[c].files.push(d);for(var e=0;e<a.room.items[c].files.length;e++);},function(a){})}},a.showAddItem=function(){a.item=new f,e.show({templateUrl:"views/templates/add-room-item.html",controllerAs:"ctrl",controller:function(){this.parent=a}})},a.addItemFiles=function(b,c){var d=a.item||a.room.items[c];d.files=d.files||[];for(var e=0;e<b.length;e++){d.files.push({filename:b[e].name});var f=g.upload(b[e],"/api/v1/acknowledgement/file/");f.then(function(a){for(var b=a.data||a,c=0;c<d.files.length;c++)b.filename==d.files[c].filename&&angular.extend(d.files[c],b)},function(a){})}},a.completeAddItem=function(){e.hide();var b=angular.copy(a.item);b.room=a.room,a.item=void 0,b.$create(function(b){a.room.items=a.room.items||[],a.room.items.push(b)})},a.cancelAddItem=function(){e.hide(),a.item=void 0},a.showAddPart=function(){a.part=new k,e.show({templateUrl:"views/templates/add-part.html",controllerAs:"ctrl",controller:function(){this.parent=a}})},a.completeAddPart=function(b){e.hide();var c=angular.copy(a.part);a.part=void 0,c.item=b,c.$create(function(c){a.room.items[a.room.items.indexOfById(b)].parts.push(c)})},a.cancelAddPart=function(){e.hide(),a.part=void 0},a.showAddSupply=function(b){a.$active=b,a.showSupplyToggle=!0},a.addSupply=function(b){a.room.items[a.$active].supplies=a.room.items[a.$active].supplies||[];var c=angular.copy(b);c.quantity=0,a.room.items[a.$active].supplies.push(c),a.showSupplyToggle=!1}}]),angular.module("employeeApp").factory("s3",[function(){var a=42;return{someMethod:function(){return a}}}]),angular.module("employeeApp").factory("FileUploader",["$q","$http","Notification",function(a,b,c){var d,e={};return e.upload=function(a,c,e){try{d=a.type.split("/")[0]}catch(f){}d=a.isPrototypeOf(Image)||"image"===d?"Image":"File";var g=new FormData;g.append(d.toLowerCase(),a);try{for(var h in e)g.append(h,e[h])}catch(f){}var i=b({method:"POST",url:c||"upload/images",data:g,headers:{"Content-Type":void 0},transformRequest:angular.identity});return i},e}]),angular.module("employeeApp").filter("available",[function(){return function(a){return"available filter: "+a}}]),angular.module("employeeApp").controller("SupplyViewCtrl",["$scope","Supply","Notification","$filter","KeyboardNavigation","$rootScope","$location","$http","FileUploader","$timeout","$mdDialog","$log",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(b){return b=d("filter")(b,a.search),b=d("filter")(b,a.query),b=d("limitTo")(b,30),b=d("orderBy")(b,"description")}function n(b){f.safeApply(function(){o&&(o.$selected=!1),o=m(a.supplies)[b],o&&(o.$selected=!0)});var c=$(".item.selected"),d=c.parents(".outer-container"),e=d.scrollTop(),g=d.innerHeight();e>c.outerHeight()*b?d.scrollTop(c.outerHeight()*b):e+g<c.outerHeight()*b&&d.scrollTop(c.outerHeight()*b)}var o,p=!0,q=0,r=new e,s=c.display("Loading supplies...",!1);h.get("/api/v1/supply/type/").success(function(b){a.types=b,a.types.splice(a.types.indexOf(null),1)}),a.scannerMode=!1,a.supplies=b.query({country:a.country},function(a){p=!1,s.hide(),n(q)}),a.showScanner=function(){r.disable(),k.show({templateUrl:"views/templates/supply-scanner.html",controller:"DialogsSupplyScannerCtrl"})},a.focus=function(a){var b=$("div.outer-container");b.animate({scrollTop:b.scrollTop()+a.offset().top-$(".mainMenu").height()})},a.addImage=function(b,d){var e=i.upload(b.files[0],"/api/v1/supply/image/");e.then(function(b){c.display("Image uploaded"),a.safeApply(function(){d.image=b.hasOwnProperty("data")?b.data:b,d.save()})},function(a){l.error(a),c.display("Unable to upload image",!1)})},a.$watch("query",function(c){c&&b.query({limit:c.length,q:c,country:a.country},function(b){for(var c=0;c<b.length;c++)-1==a.supplies.indexOfById(b[c].id)&&a.supplies.push(b[c]);q=0,n(q)})}),a.loadNext=function(){if(!p){var d=c.display("Loading more supplies...",!1);b.query({offset:a.supplies.length,limit:50,country:a.country},function(b){d.hide();for(var c=0;c<b.length;c++)-1==a.supplies.indexOfById(b[c].id)&&a.supplies.push(b[c])})}},a.customFilter=function(b){if(a.query){var c=new RegExp("\\b("+a.query.split(" ")+")","i");try{if(c.test(b.description))return!0}catch(d){l.error(d)}try{for(var e=0;e<b.suppliers.length;e++)if(c.text(b.suppliers[e].name))return!0}catch(d){l.error(d)}return!1}return!0},r.ondown=function(){q<m(a.supplies).length-1&&(q+=1,n(q))},r.onup=function(){0!==q&&(q-=1,n(q))},r.onenter=function(){f.safeApply(function(){g.path("/supply/"+o.id)})},r.enable(),a.$watch("showAddSupply",function(a,b){a&&!b?r.disable():!a&&b&&r.enable()}),a.$watch("showAddSupplier",function(a,b){a&&!b?r.disable():!a&&b&&r.enable()}),a.$watch("scannerMode",function(a,b){a&&!b?(globalScanner.disable(),r.disable()):!a&&b&&(globalScanner.enable(),r.enable())}),a.$on("$destroy",function(){r.disable()})}]),angular.module("employeeApp").controller("OrderPurchaseOrderViewCtrl",["$scope","PurchaseOrder","$filter","KeyboardNavigation","$location","Notification",function(a,b,c,d,e,f){function g(b){return c("filter")(b,a.query)}function h(b){a.safeApply(function(){i&&(i.$selected=!1),i=g(a.poList)[b],i&&(i.$selected=!0)});var c=$(".item.selected"),d=c.parents(".outer-container"),e=d.scrollTop(),f=d.innerHeight();e>c.outerHeight()*b?d.scrollTop(c.outerHeight()*b):e+f<c.outerHeight()*b&&d.scrollTop(c.outerHeight()*b)}var i,j=!0,k=0,l=e.search();f.display("Loading purchasing orders..."),a.poList=b.query({limit:20},function(){for(var b=0;b<a.poList.length;b++){var c=a.poList[b].receive_date,d=a.poList[b].paid_date;a.poList[b].receive_date=c?new Date(c):c,a.poList[b].paid_date=d?new Date(d):d}j=!1,h(k)},function(){j=!1}),a.hasEvent=function(a,b){for(var c in a.logs)if(a.logs[c].hasOwnProperty("message")&&a.logs[c].message.toLowerCase().indexOf(b)>-1)return!0;return!1},a.$watch("query.$.$",function(c){c&&(e.search("q",c),b.query({limit:c?10*c.length:5,q:c},function(b){for(var c=0;c<b.length;c++){var d=b[c].receive_date,e=b[c].paid_date;b[c].receive_date=d?new Date(d):d,b[c].paid_date=e?new Date(e):e,-1==a.poList.indexOfById(b[c].id)&&a.poList.push(b[c])}k=0,h(k)}))}),l.q&&(a.query={$:{$:l.q}},a.safeApply()),a.loadNext=function(){if(!j){f.display("Loading more purchasing orders..."),j=!0;var d={limit:20,offset:a.poList.length};try{a.query.$.$&&(d.q=a.query.$.$,d.offset=c("filter")(a.poList,d.q).length)}catch(e){}b.query(d,function(b){j=!1;for(var c=0;c<b.length;c++)-1==a.poList.indexOfById(b[c].id)&&a.poList.push(b[c])})}};var m=new d;m.ondown=function(){k<g(a.poList).length-1&&(k+=1,h(k))},m.onup=function(){0!==k&&(k-=1,h(k))},m.onenter=function(){a.safeApply(function(){e.path("/order/purchase_order/"+i.id)})},m.enable(),a.update=function(a){f.display("Updating purchase order #"+a.id),a.$update(function(){f.display("Purchase Order #"+a.id+" updated.")})},a.$on("$destroy",function(){m.disable()})}]),angular.module("employeeApp").factory("PurchaseOrder",["$resource",function(a){return a("/api/v1/purchase-order/:id/",{id:"@id"},{create:{method:"POST"},update:{method:"PUT"}})}]),angular.module("employeeApp").controller("OrderPurchaseOrderCreateCtrl",["$scope","PurchaseOrder","Supplier","Supply","Notification","$filter","$timeout","$window","Project","Room","Phase","$mdDialog","$log","$location",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(b,c,d){var e={origin:b,destination:c,avoidHighways:!1,avoidTolls:!1,travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.METRIC};u.route(e,function(b,c){c==google.maps.DirectionsStatus.OK?(s.setDirections(b),a.directionsActive=!0):(d||angular.noop)()})}function p(){s.set("directions",null),a.directionsActive=!1}function q(b){var c=null,d=null;b.address?(c=b.address.latitude||b.latitude,d=b.address.longitude||b.longitude):(c=b.latitude,d=b.longitude);var e=new google.maps.Marker({position:new google.maps.LatLng(c,d),title:b.title,draggable:!0});return b.icon&&e.setIcon(b.icon),b.marker=e,b.address.marker=!0,google.maps.event.addListener(e,"dragend",function(){var b=this.marker.getPosition();Number(this.marker.getTitle())-1;this.address.latitude=b.lat(),this.address.longitude=b.lng(),(this.address.latitude!=a.po.supplier.addresses[0].latitude||this.address.longitude!=a.po.supplier.addresses[0].longitude)&&(a.po.supplier.addresses[0].latitude=b.lat(),a.po.supplier.addresses[0].longitude=b.lng()),e.setIcon("http://maps.google.com/mapfiles/ms/icons/green-dot.png")}.bind(b)),b.marker}a.po=new b,a.marker=null;var r,s,t=new google.maps.LatLng(13.935441,100.6864353),u=new google.maps.DirectionsService,v=(new google.maps.Geocoder,{center:new google.maps.LatLng(13.776239,100.527884),zoom:4,mapTypeId:google.maps.MapTypeId.ROAD});r=new google.maps.Map($("#create-po-map")[0],v),s=new google.maps.DirectionsRenderer({map:r,draggable:!0}),s.setMap(r);var w=new google.maps.TrafficLayer;w.setMap(r),a.addMarker=function(){a.marker=q({address:{},latitude:13.935441,longitude:100.6864353,title:a.po.supplier.name}),a.marker.setMap(r),r.panTo(a.marker.getPosition()),r.setZoom(17)},a.editMarker=function(){p(),a.marker&&(a.marker.setMap(r),r.panTo(a.marker.getPosition()),r.setZoom(17))},a.viewDirections=function(){a.marker.setMap(null),o(t,a.marker.getPosition(),function(){a.marker.setMap(r),r.panTo(a.marker.getPosition()),r.setZoom(17)})},a.suppliers=c.query({page_size:99999,limit:0}),a.searchSuppliers=function(b){for(var c=angular.lowercase(b.trim()),d=[],e=0;e<a.suppliers.length;e++)-1!==angular.lowercase(a.suppliers[e].name).indexOf(c)&&d.push(a.suppliers[e]);return d},a.retrieveSuppliers=function(b){b&&c.query({q:b},function(b){for(var c=0;c<b.length;c++)-1===a.suppliers.indexOfById(b[c])&&a.suppliers.push(b[c])})},a.updateSupplierName=function(b){a.po.supplier=a.po.supplier||{name:"",addresses:[]},a.po.supplier.id?-1==a.po.supplier.name.indexOf(b)&&(a.po.supplier={name:b,addresses:[]}):a.po.supplier.name=b||""},a.addSupplier=function(b){a.supplies=[],a.po.supplier=b,a.po.discount=b.discount,a.po.terms=b.terms,a.po.currency=b.currency,d.query({supplier_id:b.id,limit:0,page_size:99999},function(c){a.supplies=f("filter")(c,b.name)}),a.safeApply(),a.marker&&a.marker.setMap(null),p(),r.setZoom(9);try{var c=b.addresses[0];c.latitude&&c.longitude?(a.marker=q({address:c,title:a.po.supplier.name,icon:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"}),o(t,a.marker.getPosition(),function(){p(),a.marker.setMap(r),r.panTo(a.marker.getPosition()),r.setZoom(17)})):a.marker=null}catch(e){m.warn(JSON.stringify(e))}if(a.po.items)for(var g=0;g<a.po.items.length;g++)try{if(a.po.items[g].hasOwnProperty("suppliers")&&a.po.supplier&&a.po.supplier.id)for(var h=0;h<a.po.items[g].suppliers.length;h++)a.po.items[g].suppliers[h].supplier==a.po.supplier.id&&(a.po.items[g].cost=Number(a.po.items[g].suppliers[h].cost),a.po.items[g].purchasing_units=a.po.items[g].suppliers[h].purchasing_units)}catch(e){m.warn(e)}a.retrieveSupplies()},a.projects=i.query({page_size:99999,limit:0}),a.searcProjects=function(b){for(var c=angular.lowercase(b),d=[],e=0;e<a.projects.length;e++)-1!==angular.lowercase(a.projects[e].codename).indexOf(c)&&d.push(a.projects[e]);return d},a.addProject=function(b){a.po.project=b},a.updateProjectName=function(b){a.po.project=a.po.project||{codename:""},a.po.project.id?-1==a.po.project.codename.indexOf(b)&&(a.po.project={codename:b}):a.po.project.codename=b||""},a.showAddRoom=function(){a.room=new j,l.show({templateUrl:"views/templates/add-room.html",controllerAs:"ctrl",controller:function(){this.parent=a}})},a.completeAddRoom=function(){l.hide();var b=angular.copy(a.room);b.project=a.po.project,a.room=new j,b.$create(function(b){a.po.project.rooms.push(b),a.po.room=b},function(a){m.error(JSON.stringify(a))})},a.cancelAddRoom=function(){l.hide(),a.room=new j;
},a.showAddPhase=function(){a.phase=new k,l.show({templateUrl:"views/templates/add-phase.html",controllerAs:"ctrl",controller:function(){this.parent=a}})},a.completeAddPhase=function(){l.hide();var b=angular.copy(a.phase);b.project=a.po.project.id,a.phase=void 0,b.$create(function(b){a.po.project.phases.push(b),a.po.phase=b},function(a){m.error(JSON.stringify(a))})},a.retrieveSupplies=function(b){a.supplies=a.supplies||[];var c={};b&&(c.q=b),a.po.supplier&&a.po.supplier.id,d.query(c,function(b){for(var c=0;c<b.length;c++)-1===a.supplies.indexOfById(b[c])&&a.supplies.push(b[c])})},a.searchSupplies=function(b){var c=angular.lowercase(b.trim()),d=[];a.supplies=a.supplies||[];for(var e=0;e<a.supplies.length;e++)console.log(a.supplies[e]),c?-1!==angular.lowercase(String(a.supplies[e].description)).indexOf(c)&&d.push(a.supplies[e]):d.push(a.supplies[e]);return d},a.cancelAddPhase=function(){l.hide(),a.phase=void 0},a.addItem=function(b){if(b.description){a.po.items=a.po.items||[];var c=angular.copy(b);if(delete c.quantity,c.cost=Number(c.cost||c.unit_cost||0),!c.cost&&c.hasOwnProperty("suppliers")&&a.po.supplier&&a.po.supplier.id)for(var d=0;d<c.suppliers.length;d++)c.suppliers[d].supplier.id===a.po.supplier.id&&(c.cost=Number(c.suppliers[d].cost),c.purchasing_units=c.suppliers[d].purchasing_units,c.suppliers[d].supplier={id:a.po.supplier.id});a.po.items.push(c)}},a.removeItem=function(b){a.po.items.splice(b,1),0===a.po.items.length&&(a.po.items=[])},a.isNewSupply=function(a,b){if(a.id&&b)for(var c=0;c<a.suppliers.length;c++)if(a.suppliers[c].supplier.id===b.id)return!1;return!0},a.unitCost=function(a,b){return a-a*(b/100)},a.subtotal=function(){var b=0;if(a.po.items)for(var c=0;c<a.po.items.length;c++){var d=a.po.items[c];discount=d.discount||0,b+=a.unitCost(d.cost,discount)*d.quantity}return b},a.discount=function(){return a.subtotal()*((a.po.discount||0)/100)},a.total=function(){return a.subtotal()-a.discount()},a.grandTotal=function(){var b=a.total();return b+b*(a.po.vat/100)},a.validatePurchaseOrder=function(b){if(b=b||a.po,!b.hasOwnProperty("supplier"))throw new Error("Please select a supplier");if(b.items.length<=0)throw new Error("Please add items to the purchase order");for(var c=0;c<(b.items.length||[]);c++)if(!b.items[c].quantity||b.items[c].quantity<=0)throw new Error(b.items[c].description+" is missing a quantity");return!0},a._checkProgress=function(a,b){for(var c in a){if(a[c]===!1)return!1;if("error"===a[c])throw new Error}(b||angular.noop)()},a._prepareSupplier=function(b,d,e){if(!b.supplier.id&&b.supplier.name){d.supplier=!1;var f=new c;angular.extend(f,b.supplier),f.$create(function(c){angular.extend(b.supplier,c),d.supplier=!0,a._checkProgress(d,e)},function(){d.supplier="error"})}else b.supplier.id&&(d.supplier=!1,b.supplier.$update(function(c){angular.extend(b.supplier,c),d.supplier=!0,a._checkProgress(d,e)},function(){d.supplier="error"}))},a._createSupply=function(b,c,e,f){e[b.description]=!1,b.suppliers=[c],b.suppliers[0].supplier={id:c.id},b.suppliers[0].cost=b.cost;var g=new d(b);g.$create(function(c){angular.extend(b,c),b.supply={id:b.id},delete b.id,e[b.description]=!0,a._checkProgress(e,f)},function(a){m.error(a)})},a._updateSupply=function(b,c,e,f){if(a.isNewSupply(b,c)){var g=angular.copy(c);g.cost=b.cost,g.supplier={id:g.id},delete g.id,b.suppliers.push(g),e[b.id]=!1;var h=new d(b);h.$update(function(c){angular.extend(b,c),b.supply={id:b.id},delete b.id,e[b.supply.id]=!0,a._checkProgress(e,f)},function(a){m.error(a)})}},a._preparePurchaseOrder=function(b,c){var d={supplies:!1};if(a._prepareSupplier(b,d,c),b.project&&!b.project.id&&b.project.codename){d.project=!1;var e=new i;angular.extend(e,b.project),e.$create(function(e){angular.extend(b.project,e),d.project=!0,a._checkProgress(d,c)},function(){d.project="error"})}for(var f=0;f<b.items.length;f++)b.items[f].hasOwnProperty("id")?a._updateSupply(b.items[f],b.supplier,d,c):a._createSupply(b.items[f],b.supplier,d,c);d.supplies=!0,a._checkProgress(d,c)},a._sendCreateRequest=function(){purchaseOrder=this||a.po,purchaseOrder.$create(function(a){e.display("Purchase order created."),angular.extend(purchaseOrder,a)},function(a){m.error(JSON.stringify(a)),e.display("There was an error in creeating the purchase order. A report has been sent to Charlie")})},a.create=function(b){b=b||a.po;try{a.validatePurchaseOrder(b),e.display("Creating new purchase order..."),a._preparePurchaseOrder(b,a._sendCreateRequest.bind(b))}catch(c){m.error(JSON.stringify(c)),e.display(c.message)}},a.reset=function(){a.po=new b,a.po.items=[]}}]),angular.module("employeeApp.directives").directive("addSupply",["$rootScope","Supplier","Supply","$mdToast","$http","$log",function(a,b,c,d,e,f){return{templateUrl:"views/templates/add-supply.html",replace:!0,restrict:"EA",scope:{visible:"=addSupply",onAdd:"&",assignedSupplier:"=supplier"},require:"?supplyList",link:function(g,h,i,j){g.types={},e.get("/api/v1/supply/type").then(function(a){for(var b=0;b<a.data.length;b++)a.data[b]&&"custom"!=a.data[b]&&!g.types[a.data[b].toLowerCase()]&&(g.types[a.data[b]]=a.data[b].toLowerCase())}),g.$watch("assignedSupplier",function(a){a&&(g.supply.supplier=angular.copy(a))}),g.$watch("visible",function(a){a&&!g.supplier&&(g.suppliers=g.suppliers||b.query({limit:0}))}),g.showWidth=function(){var a=g.supply.units,b=g.supply.type;return g.supply.new_supply&&("m"===a||"pc"===a||"pack"===a||"yd"===a||"kg"===a&&"packaging"===b)?!0:!1},g.showDepth=function(){var a=g.supply.units;return g.supply.new_supply&&("pc"===a||"pack"===a)?!0:!1},g.showHeight=function(){var a=g.supply.units,b=g.supply.type;return g.supply.new_supply&&("pc"===a||"pack"===a||"kg"===a&&"packaging"===b)?!0:!1},g.supply=new c,g.supply.units="pc",g.selectSupply=function(b){a.safeApply(function(){angular.extend(g.supply,b)})},g.add=function(){if(g.form.$valid){if(d.show(d.simple().hideDelay(0).position("top right").content("Creating supply...")),g.supply.suppliers=g.supply.suppliers||[],g.supply.suppliers.indexOfById(g.supply.supplier)){var a=g.supply.supplier;a.supplier={id:a.id},delete a.id,g.supply.suppliers.push(a)}delete g.supply.supplier,g.supply.hasOwnProperty("id")?g.supply.$update(function(a){g.visible=!1,g.onAdd({$supply:g.supply}),g.supply=new c,d.show(d.simple().hideDelay(2e3).position("top right").content("Supply created.")),g.assignedSupplier&&(g.supply.supplier=angular.copy(g.assignedSupplier))},function(a){f.error(a)}):g.supply.$create(function(a){g.visible=!1,g.onAdd({$supply:g.supply}),g.supply=new c,d.show(d.simple().hideDelay(2e3).position("top right").content("Supply created.")),g.assignedSupplier&&(g.supply.supplier=angular.copy(g.assignedSupplier))},function(a){f.error(a),d.show(d.simple().hideDelay(0).position("top right").content("There was an error in creating the supply"))})}else d.show(d.simple().hideDelay(0).position("top right").content("Please fill out the form properly"))},g.addImage=function(a){g.supply.image=a}}}}]),angular.module("employeeApp.directives").directive("addSupplier",["$rootScope","Supplier","$mdToast","$log",function(a,b,c,d){return{templateUrl:"views/templates/add-supplier.html",replace:!0,restrict:"EA",scope:{visible:"=addSupplier",onAdd:"&"},link:function(a,e,f){a.supplier=new b,a.contact={},a.nameTip="What is the supplier's name (required)",a.thaiNameTip="Enter the supplier's name in Thai",a.emailTip="Enter a valid email address (required)",a.telTip="Enter a valid phone number (required)",a.currencyTip="What currency does this supplier deal in? (required)",a.discountTip="What discount do we get? (required)",a.termsTip="How many days of credit do we get? (required)",a.addrTip="What is the supplier's address (required)",a.cityTip="What city is the supplier in? (required)",a.territoryTip="What chaengwat/territory/state is the supplier in? (required)",a.countryTip="What country is the supplier in? (requied)",a.zipcodeTip="What zipcode is the supplier in? (required)",a.addContact=function(b){a.supplier.contacts=a.supplier.contacts||[],0===a.supplier.contacts.length&&(b=b||a.contact,b.primary=!0),a.supplier.contacts.push(b),a.contact={}},a.validation=function(){for(var b=[],c=0;c<(a.supplier.contacts&&a.supplier.contacts.length);c++)a.supplier.contacts[c].primary&&b.append(a.supplier.contacts[c]);if(1!=b.length)throw ValueError("There can only be 1 primary contact")},a.add=function(){try{a.form.$valid?(c.show(c.simple().position("top right").hideDelay(0).content("Creating supplier...")),a.supplier.$save(function(d){c.show(c.simple().position("top right").hideDelay(2e3).content("Supplier created.")),a.onAdd({$supplier:a.supplier}),a.visible=!1,a.supplier=new b},function(a){d.error(a),c.show(c.simple().position("top right").hideDelay(0).content("There was an error in creating the supplier"))})):c.show(c.simple().position("top right").hideDelay(0).content("Please fill out the form properly"))}catch(e){c.show(c.simple().position("top right").hideDelay(0).content(e))}}}}}]),angular.module("employeeApp").factory("inventory",[function(){var a=42;return{someMethod:function(){return a}}}]),angular.module("employeeApp").directive("onScrollEnd",["$log",function(a){return{restrict:"A",link:function(a,b,c){b.bind("scroll",function(d){var e=$(b.children()[0]).height(),f=b.height();if(e>=f&&b.scrollTop()+f>=e-10)try{a.$eval(c.onScrollEnd)}catch(g){console.error("Missing a function for 'on-scroll-end'")}})}}}]),angular.module("employeeApp").directive("customerList",["Customer","$mdToast","KeyboardNavigation","$rootScope","$filter",function(a,b,c,d,e){return{templateUrl:"views/templates/customer-list.html",replace:!0,restrict:"A",scope:{visible:"=customerList",onSelect:"&"},link:function(f,g,h){function i(a){return e("orderBy")(e("filter")(f.customers,f.query),"name")}function j(a){d.safeApply(function(){k&&(k.$selected=!1),k=i(f.customers)[a],k&&(k.$selected=!0)});var b=$(".customer.selected"),c=b.parents(".inner-container"),e=c.scrollTop(),g=c.innerHeight();e>b.outerHeight()*a?c.scrollTop(b.outerHeight()*a):e+g<b.outerHeight()*a&&c.scrollTop(b.outerHeight()*a)}var k,l=!0,m=0;f.customers=a.query({limit:20},function(a){l=!1,j(m)}),f.$watch("query",function(b){b&&a.query({q:b,limit:5},function(a){for(var b=0;b<a.length;b++)-1==f.customers.indexOfById(a[b].id)&&f.customers.push(a[b]);m=0,j(m)})}),f.loadNext=function(){l||(b.show(b.simple().position("right top").hideDelay(0).content("Loading customers suppliers...")),l=!0,a.query({offset:f.customers.length,limit:50},function(a){l=!1,b.hide();for(var c=0;c<a.length;c++)f.customers.push(a[c])}))},f.select=function(a){f.onSelect({customer:a})};var n=new c;n.ondown=function(){m<i(f.customers).length-1&&(m+=1,j(m))},n.onup=function(){0!==m&&(m-=1,j(m))},n.onenter=function(){d.safeApply(function(){f.select(k)})},f.$watch("visible",function(a){a?n.enable():n.disable()}),f.$on("$destroy",function(){n.disable()})}}}]),angular.module("employeeApp").directive("upholsteryList",["Upholstery","Notification","$filter","KeyboardNavigation","$rootScope",function(a,b,c,d,e){return{templateUrl:"views/templates/upholstery-list.html",replace:!0,restrict:"A",scope:{onSelect:"&",safeApply:"&",visible:"="},link:function(f,g,h){function i(a){e.safeApply(function(){j&&(j.$selected=!1),j=c("filter")(f.upholsteries,f.query)[a],j&&(j.$selected=!0)});var b=$(".upholstery.selected"),d=b.parents(".inner-container"),g=d.scrollTop(),h=d.innerHeight();g>b.outerHeight()*a?d.scrollTop(b.outerHeight()*a):g+h<b.outerHeight()*a&&d.scrollTop(b.outerHeight()*a)}var j,k=!0,l=0;f.upholsteries=a.query({limit:20},function(a){k=!1,i(l)}),f.$watch("query",function(b){b&&(f.currentIndex=0,a.query({q:b,limit:10+2*f.query.length},function(a){for(var b=0;b<a.length;b++)-1==f.upholsteries.indexOfById(a[b].id)&&f.upholsteries.push(a[b]);l=0,i(l)}))}),f.loadNext=function(){k||(b.display("Loading more upholsteries...",!1),k=!0,a.query({offset:f.upholsteries.length,limit:50},function(a){k=!1,b.hide();for(var c=0;c<a.length;c++)f.upholsteries.push(a[c])}))},f.select=function(a){f.onSelect({$upholstery:a})};var m=new d;m.ondown=function(){l<c("filter")(f.upholsteries,f.query).length-1&&(l+=1,i(l))},m.onup=function(){0!==l&&(l-=1,i(l))},m.onenter=function(){e.safeApply(function(){f.select(j)})},f.$watch("visible",function(a){a?m.enable():m.disable()}),f.$on("$destroy",function(){m.disable()})}}}]),angular.module("employeeApp").directive("tableList",["Table","Notification","KeyboardNavigation","$rootScope","$filter",function(a,b,c,d,e){return{templateUrl:"views/templates/table-list.html",replace:!0,restrict:"A",scope:{onSelect:"&",visible:"="},link:function(f,g,h){function i(a){d.safeApply(function(){j&&(j.$selected=!1),j=e("filter")(f.tables,f.query)[a],j&&(j.$selected=!0)});var b=$(".table.selected"),c=b.parents(".inner-container"),g=c.scrollTop(),h=c.innerHeight();g>b.outerHeight()*a?c.scrollTop(b.outerHeight()*a):g+h<b.outerHeight()*a&&c.scrollTop(b.outerHeight()*a)}var j,k=!0,l=0;f.tables=a.query({limit:20},function(a){k=!1,i(l)}),f.$watch("query",function(b){b&&a.query({q:b,limit:10},function(a){for(var b=0;b<a.length;b++)-1==f.tables.indexOfById(a[b].id)&&f.tables.push(a[b]);l=0,i(l)})}),f.loadNext=function(){k||(b.display("Loading more tables...",!1),k=!0,a.query({offset:f.tables.length,limit:50},function(a){k=!1,b.hide();for(var c=0;c<a.length;c++)f.tables.push(a[c]);0===a.length&&(k=!0)}))},f.select=function(a){f.onSelect({$table:a})},f.select=function(a){f.onSelect({$table:a})};var m=new c;m.ondown=function(){l<e("filter")(f.tables,f.query).length-1&&(l+=1,i(l))},m.onup=function(){0!==l&&(l-=1,i(l))},m.onenter=function(){d.safeApply(function(){f.select(j)})},m.enable(),f.$watch("visible",function(a){a?m.enable():m.disable()}),f.$on("$destroy",function(){m.disable()})}}}]),angular.module("employeeApp").directive("fabricSelector",["Fabric","$mdToast","$parse",function(a,b,c){return{templateUrl:"views/templates/fabric-selector.html",replace:!0,restrict:"A",scope:{product:"=",onComplete:"&"},link:function(c,d,e){function f(a){if(13===a.which)try{c.$apply(function(){c.done()})}catch(b){}}var g=!0;c.fabrics=a.query(function(a){g=!1}),c.$watch("query",function(b){b&&a.query({q:b,limit:5},function(a){for(var b=0;b<a.length;b++)-1==c.fabrics.indexOfById(a[b].id)&&c.fabrics.push(a[b])})}),c.loadNext=function(){g||(b.show(b.simple().hideDelay(0).position("top right").content("Loading more fabrics...")),g=!0,a.query({offset:c.fabrics.length,limit:50},function(a){g=!1,b.hide();for(var d=0;d<a.length;d++)c.fabrics.push(a[d])}))},c.done=function(){c.onComplete()},$(window).on("keydown",f),c.$on("$destroy",function(){$(window).off("keydown",f)})}}}]),angular.module("employeeApp").controller("OrderPurchaseOrderDetailsCtrl",["$scope","$routeParams","PurchaseOrder","$mdToast","$location","$window","Project","$mdDialog","Room","Phase","$log",function(a,b,c,d,e,f,g,h,i,j,k){function l(b){var c=b.address.latitude||b.latitude,d=b.address.longitude||b.longitude,e=new google.maps.Marker({position:new google.maps.LatLng(c,d),map:m,title:b.title,draggable:!0});return b.icon&&e.setIcon(b.icon),b.marker=e,b.address.marker=!0,google.maps.event.addListener(e,"dragend",function(){var b=this.marker.getPosition();Number(this.marker.getTitle())-1;this.address.latitude=b.lat(),this.address.longitude=b.lng(),(this.address.latitude!=a.supplier.addresses[0].latitude||this.address.longitude!=a.supplier.addresses[0].longitude)&&(a.po.supplier.addresses[0].latitude=b.lat(),a.po.supplier.addresses[0].longitude=b.lng()),e.setIcon("http://maps.google.com/mapfiles/ms/icons/green-dot.png")}.bind(b)),b.marker}var m,n=(new google.maps.Geocoder,{center:new google.maps.LatLng(13.776239,100.527884),zoom:4,mapTypeId:google.maps.MapTypeId.ROAD}),o=[{featureType:"road",stylers:[{visibility:"on"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#DDDDDD"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#FFFFFF"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{visibility:"off"}]}];m=new google.maps.Map($("#po-map")[0],n),m.setOptions({styles:o}),a.po=c.get({id:b.id},function(){if(a.po.id&&a.po.project&&a.projects.length){var b=a.projects.indexOfById(a.po.project.id);a.po.project=a.projects[b]||a.po.project,a.po.room&&(b=a.po.project.rooms.indexOfById(a.po.room.id),a.po.room=a.po.project.rooms[b]||a.po.room),a.po.phase&&(b=a.po.project.phases.indexOfById(a.po.phase.id),a.po.phase=a.po.project.phases[b])}var c=a.po.supplier.addresses[0]||{};if(c.latitude&&c.longitude){var d=m.getCenter();marker=l({address:c,title:a.po.supplier.name,latitude:d.lat(),longitude:d.lng(),icon:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"}),m.panTo(marker.getPosition()),m.setZoom(17)}}),a.projects=g.query({limit:0,page_size:1e3},function(){if(a.po.id&&a.po.project){var b=a.projects.indexOfById(a.po.project.id);a.po.project=a.projects[b],a.po.room&&(b=a.po.project.rooms.indexOfById(a.po.room.id),a.po.room=a.po.project.rooms[b]||a.po.room),a.po.phase&&(b=a.po.project.phases.indexOfById(a.po.phase.id),a.po.phase=a.po.project.phases[b])}}),a.showAddProject=function(){a.project=new g,h.show({templateUrl:"views/templates/add-project.html",controllerAs:"ctrl",controller:function(){this.parent=a}})},a.completeAddProject=function(){h.hide(),d.show(d.simple().content("Creating project...").hideDelay(0)),a.project.$create(function(b){a.projects.push(b),a.po.project=b,d.hide(),a.project=new g},function(){})},a.cancelAddProject=function(){h.hide(),a.project=new g},a.showAddRoom=function(){a.room=new i,h.show({templateUrl:"views/templates/add-room.html",controllerAs:"ctrl",controller:function(){this.parent=a}})},a.completeAddRoom=function(){h.hide();var b=angular.copy(a.room);b.project=a.po.project,a.room=new i,b.$create(function(b){a.po.project.rooms.push(b),a.po.room=b})},a.cancelAddRoom=function(){h.hide(),a.room=new i},a.showAddPhase=function(){a.phase=new j,h.show({templateUrl:"views/templates/add-phase.html",controllerAs:"ctrl",controller:function(){this.parent=a}})},a.completeAddPhase=function(){h.hide();var b=angular.copy(a.phase);b.project=a.po.project.id,a.phase=void 0,b.$create(function(b){a.po.project.phases.push(b),a.po.phase=b})},a.cancelAddPhase=function(){h.hide(),a.phase=void 0},a.save=function(){d.show(d.simple().position("top right").content("Saving changes to purchase order "+a.po.id).hideDelay(0)),a.po.$update(function(){if(d.show(d.simple().position("top right").content("Changes to purchase order "+a.po.id+" saved.").hideDelay(2e3)),f.open(a.po.pdf.url),a.po.id&&a.po.project){var b=a.projects.indexOfById(a.po.project.id);a.po.project=a.projects[b],a.po.room&&(b=a.po.project.rooms.indexOfById(a.po.room.id),a.po.room=a.po.project.rooms[b]||a.po.room),a.po.phase&&(b=a.po.project.phases.indexOfById(a.po.phase.id),a.po.phase=a.po.project.phases[b])}},function(a){k.error(a)})},a.unitCost=function(a,b){return a-a*(b/100)},a.subtotal=function(){var b=0;if(a.po.items)for(var c=0;c<a.po.items.length;c++){var d=a.po.items[c];b+=a.unitCost(d.unit_cost,d.discount)*d.quantity}return b},a.discount=function(){return a.subtotal()*(a.po.discount/100)},a.total=function(){return a.subtotal()-a.discount()},a.grandTotal=function(){var b=a.total();return b+b*(a.po.vat/100)},a.addItem=function(b){if(a.po.items=a.po.items||[],-1==a.po.items.indexOfById(b)){a.showAddItem=!1;var c=angular.copy(b);delete c.quantity,c.supply={id:c.id},delete c.id,c.cost?c.unit_cost=c.unit_cost||c.cost:c.unit_cost=c.unit_cost||c.suppliers[0].cost,a.po.items.push(c)}else d.show(d.simple().position("top right").content("This item is already present in the purchase order").hideDelay(2e3))},a.removeItem=function(b){a.po.items.splice(b,1),0===a.po.items.length&&delete a.po.items},a.viewPDF=function(){f.open(a.po.pdf.url)},a.order=function(){d.show(d.simple().content("Updating purchase order...").hideDelay(0)),a.showCal=!1,a.po.status="Ordered";for(var b=0;b<a.po.items.length;b++)a.po.items[b].status="Ordered";a.po.$update(function(){d.show(d.simple().content("Purchase order updated."))})},a.receive=function(){if(a.po.receive_date){d.show(d.simple().content("Updating purchase order...").hideDelay(0)),a.showCal=!1,a.po.status="Received";for(var b=0;b<a.po.items.length;b++)"paid"!=a.po.items[b].status.toLowerCase()&&(a.po.items[b].status="Received");a.po.$update(function(){d.show(d.simple().content("Purchase order updated."))})}else a.showCal=!0},a.pay=function(){d.show(d.simple().content("Updating purchase order...").hideDelay(0)),a.showPaidCal=!1,a.po.status="PAID";for(var b=0;b<a.po.items.length;b++)a.po.items[b].status="PAID";a.po.$update(function(){d.show(d.simple().content("Purchase order updated."))})},a.cancel=function(){d.show(d.simple().content("Updating purchase order...").hideDelay(0)),a.po.status="Cancelled";for(var b=0;b<a.po.items.length;b++)a.po.items[b].status="Cancelled";a.po.$update(function(){d.show(d.simple().content("Purchase order "+a.po.id+" cancelled.")),e.path("order/purchase_order")})}}]),angular.module("employeeApp").controller("SupplyDetailsCtrl",["$scope","$routeParams","Notification","Supply","$timeout","$location","scanner","$window","$http","$log",function(a,b,c,d,e,f,g,h,i,j){c.display("Retrieving supply...",!1),a.action="subtract",a.showQuantity=!1,a.supply=d.get({id:b.id,country:a.country},function(){c.hide();for(var b in a.supply.suppliers){var d=a.supply.suppliers[b];"object"==typeof d&&i.get("/api/v1/log",{params:{action:"PRICE CHANGE",supply:a.supply.id,supplier:d.id}}).then(function(a){for(var b=a.config.params.supplier,c=[],d=a.data,e=0;e<a.data.length;e++)c.push(a.data[e].cost);if(largest=Math.max.apply(Math,c),c.length>0){var f=d3.select("div.price-chart-supplier-"+b+" .chart").selectAll("div").data(d).enter().append("div").attr("class","price-box").style("left",function(a,b){return 6*b+b+"em"}).attr("class",function(a,b){try{if(Number(d[b-1].cost)>Number(a.cost))return"green";if(Number(d[b-1].cost)<Number(a.cost))return"red"}catch(c){return"black"}});f.append("span").text(function(a){return a.cost+"thb"}).attr("class","price"),f.append("span").attr("class","date").text(function(a){var b=new Date(a.timestamp);return b.toLocaleDateString("en-us",{year:"numeric",month:"short",day:"numeric"})});d3.select("div.price-chart-supplier-"+b).transition().duration(1e3).style("background-color","#FFF").style("height","10em"),f.transition().duration(2e3).delay(1e3).style("height",function(a){return a.cost/largest*8+"em"})}else d3.select("div.price-chart-supplier-"+b+" .chart").style("display","none")})}i.get("/api/v1/log",{params:{action:"SUBTRACT",supply:a.supply.id}}).then(function(a){for(var b=[],c=a.data,d=0;d<a.data.length;d++)b.push(a.data[d].quantity);if(largest=Math.max.apply(Math,b),b.length>0){var e=d3.select("div.usage .chart").selectAll("div").data(c).enter().append("div").attr("class","price-box").style("left",function(a,b){return 6*b+b+"em"}).style("background-color",function(a,b){try{if(Number(c[b-1].quantity)>Number(a.quantity))return"green";if(Number(c[b-1].quantity)<Number(a.quantity))return"red"}catch(d){return"black"}});e.append("span").text(function(a){return a.quantity}).attr("class","price"),e.append("span").attr("class","date").text(function(a){var b=new Date(a.timestamp);return b.toLocaleDateString("en-us",{year:"numeric",month:"short",day:"numeric"})});d3.select("div.usage").transition().duration(500).style("background-color","#FFF"),e.transition().duration(2e3).delay(500).style("height",function(a){return a.quantity/largest*8+"em"})}});try{1==a.supply.suppliers.length&&(a.selectedSupplier=a.supply.suppliers[0])}catch(e){}}),globalScanner.disable();var k,l=!1,m=["m","yd","pc","pack","container","fabric"],n=["pc","pack","container"],o=["pack","pc"];a.showWidth=function(){return m.indexOf(a.supply.units)>-1||m.indexOf(a.supply.type)>-1||"kg"==a.supply.units&&"packaging"==a.supply.type?!0:!1},a.showDepth=function(){return n.indexOf(a.supply.units)>-1?!0:!1},a.showHeight=function(){return o.indexOf(a.supply.units)>-1||"kg"==a.supply.units&&"packaging"==a.supply.type?!0:!1},a.addImage=function(b){a.supply.image=b},a.viewStickers=function(){try{h.open(a.supply.sticker.url)}catch(b){c.display("This supply is missing a sticker")}},g=new g("supply/details"),g.disableStandard(),g.register(/^\d+(\-\d+)*$/,function(b){a.safeApply(function(){a.selectedSupplier.upc=b,a.showAddUPC=!1})}),a.$watch(function(){var b=angular.copy(a.supply);return delete b.last_modified,delete b.image,delete b.supplier,delete b.quantity,b},function(b,d){!l&&d.hasOwnProperty("id")&&(l=!0,k=e(function(){c.display("Updating "+a.supply.description+"...",!1);var b=angular.copy(a.supply);b.$update({country:a.country},function(){l=!1,c.display(a.supply.description+" updated")},function(){c.display("There was an error in updating "+a.supply.description)})},5e3))},!0),a.$watch("showAddUPC",function(a,b){a?g.enable():g.disable()}),a.add=function(b){a.showQuantity=!1,b||(b=a.quantity),a.supply.$add({quantity:b,country:a.country},function(){a.supply.hasOwnProperty("suppliers")||(a.supply.suppliers=a.suppliers)})},a.subtract=function(b){a.showQuantity=!1,b||(b=a.quantity),a.supply.$subtract({quantity:b,country:a.country},function(){a.supply.hasOwnProperty("suppliers")||(a.supply.suppliers=a.suppliers)})},a.changeQuantity=function(b,c){if(!c)throw ValueError("Expecting a quantity");a[b]()},a.$on("$destroy",function(){g.disable(),e.cancel(k),c.display("Updating "+a.supply.description+"...",!1),a.supply.$update({country:"TH"},function(){c.display(a.supply.description+" updated.")}),globalScanner.enable()}),a.remove=function(){a.currentUser.hasPermission("delete_supply")&&(c.display("Deleting supply...",!1),a.supply.$delete(function(){c.display("Supply deleted"),f.path("/supply")}))}}]),angular.module("employeeApp").directive("imageUploader",["$mdToast","FileUploader",function(a,b){return{templateUrl:"views/templates/image-uploader.html",restrict:"EA",replace:!0,scope:{url:"@url",onUpload:"&",square:"="},link:function(c,d,e){c.selection="addImage",c.showUploadButton=!1,c.buttonOn=function(){c.showUploadButton=!0},c.buttonOff=function(){c.showUploadButton=!1},c.upload=function(d,e){var f=b.upload(d,c.url);f.then(function(b){a.show(a.simple().position("top right").hideDelay(3e3).content("File was uploaded.")),c.onUpload({data:b.data,$image:b.data}),(e||angular.noop)(b.data)},function(){a.show(a.simple().position("top right").hideDelay(0).content("There was an error uploading the file"))})}}}}]),angular.module("employeeApp.directives").directive("addCustomer",["Customer","$mdToast","Geocoder","$log",function(a,b,c,d){return{templateUrl:"views/templates/add-customer.html",replace:!0,restrict:"A",scope:{visible:"=addCustomer"},link:function(e,f,g){e.customer=new a,e.firstNameTip="Enter the customer's first name or name (required)",e.lastNameTip="Enter the customer's last name if applicable",e.emailTip="Enter a valid email address (required)",e.telTip="Enter a valid phone number (required)",e.typeTip="What type of customer is this? (required)",e.currencyTip="What currency does this customer deal in? (required)",e.getLocation=function(){if(e.customer.address.address1&&e.customer.address.city&&e.customer.address.territory&&e.customer.address.country&&e.customer.address.zipcode&&!e.customer.address.user_defined_latlng){var a=c.geocode(e.customer.address);a.then(function(a){e.marker?e.marker.setPosition(a[0].geometry.location):(e.marker=e.map.createMarker(a[0].geometry.location),e.marker.onchange=function(a){e.customer.address.lat=e.marker.lat,e.customer.address.lng=e.marker.lng,e.customer.address.user_defined_latlng=!0}),e.map.setPosition(a[0].geometry.location),e.customer.address.lat=e.marker.lat,e.customer.address.lng=e.marker.lng},function(a){d.error(a)})}},e.add=function(){e.form.$valid?(b.show(b.simple().position("top right").hideDelay(0).content("Creating customer...")),e.customer.$save(function(c){b.show(b.simple().position("top right").hideDelay(2e3).content("Customer created.")),e.visible=!1,e.customer=new a},function(a){d.error(a),b.show(b.simple().position("top right").hideDelay(0).content("There was an error in creating the customer"))})):b.show(b.simple().position("top right").hideDelay(0).content("Please fill out the form properly"))}}}}]),angular.module("employeeApp").controller("MainCtrl",["$scope","$location","Acknowledgement","mapMarker","PurchaseOrder","$rootScope","$log",function(a,b,c,d,e,f,g){function h(a,b){var c=new google.maps.LatLng(Math.max.apply(null,a),Math.max.apply(null,b)),d=new google.maps.LatLng(Math.min.apply(null,a),Math.min.apply(null,b)),e=new google.maps.LatLngBounds(d,c);l.fitBounds(e)}function i(a,b){var c,d=[];if("acknowledgement"==b)c=["acknowledged","in production","deposit received"];else{if("purchase order"!=b)throw Error("Invalid data type.");c=["processed","ordered"]}for(var e=0;e<a.length;e++)c.indexOf(a[e].status.toLowerCase())>-1&&d.push(a[e]);return d}var j=a.currentUser,k=function(){!j.hasModule("supplies")||j.hasModule("acknowledgements")||j.hasModule("shipping")||(f.inventory=!0,b.path("/scanner"))};a.currentUser.ready?k():j.onready=k;var l,m,n={acknowledgements:[],purchaseOrders:[]},o={center:new google.maps.LatLng(13.776239,100.527884),zoom:4,mapTypeId:google.maps.MapTypeId.ROAD},p=[{featureType:"road",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#DDDDDD"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#FFFFFF"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{visibility:"off"}]}];l=new google.maps.Map($("#main-map")[0],o),l.setOptions({styles:p}),a.pos=e.query(function(){},function(){}),a.acknowledgements=c.query(function(b){a.active="acknowledgements";for(var c=0;20>c;c++)try{var d=b[c].customer;d.latitude&&d.longitude&&(m=new google.maps.Marker({position:new google.maps.LatLng(d.latitude,d.longitude),map:l,title:"Order #"+b[c].id,draggable:!1}),n[a.active].push(m))}catch(e){g.error(e)}l.setZoom(6)}),a.view=function(b){var c,d,e=[],f=[];for(var j in n[a.active])try{n[a.active][j].setMap(null)}catch(k){g.error(k)}for(a.active=b,n[a.active]=[],"acknowledgements"===b?(c=i(a.acknowledgements,"acknowledgement"),d=function(a){return a.customer}):"purchaseOrders"===b&&(c=i(a.pos,"purchase order"),d=function(a){return a.supplier.addresses[0]||{}}),j=0;j<c.length;j++)try{var m=d(c[j]);if(m.latitude&&m.longitude){e.push(m.latitude),f.push(m.longitude);var o=new google.maps.Marker({position:new google.maps.LatLng(m.latitude,m.longitude),map:l,title:(c[j].customer||c[j].supplier).name,draggable:!1});n[a.active].push(o)}}catch(k){g.error(k)}h(e,f)}}]),angular.module("employeeApp").directive("img",[function(){function a(a){if(a.height&&a.parentHeight&&a.elementHeight){var b=a.parentHeight-a.elementHeight;a.element.css("top",b/2)}else if(a.width&&a.parentWidth&&a.elementWidth){var c=a.parentWidth-a.elementWidth;a.element.css("left",c/2)}}return{restrict:"E",compile:function(b,c){return b.hasClass("logo")||b.addClass("preloaded"),{post:function(b,c,d){c.on("load",function(){if(d.center){var b=c.parent(),e=b.innerWidth();b.innerWidth();a({element:c,width:!0,parentWidth:e,elementWidth:c.outerWidth()})}c.removeClass("preloaded")})}}}}}]),angular.module("employeeApp.services").factory("KeyboardNavigation",["$rootScope","$log",function(a,b){function c(b){function c(a){b.array&&p.$apply(function(){n+=a})}function d(a,b){a.preventDefault(),a.stopPropagation(),b()}function e(a){switch(a.which){case 37:i&&d(a,i);break;case 38:c(-1),k&&d(a,k);break;case 39:j&&d(a,j);break;case 40:c(1),l&&d(a,l);break;case 13:m&&d(a,m)}}function f(){o&&($(window).off("keydown",e),o=!1)}function g(){o||($(window).on("keydown",e),o=!0)}function h(){g(),b.scope&&b.scope.$on("$destroy",function(){f()})}var i,j,k,l,m,n=0,o=!1,p=b&&b.scope?b.scope:a.$new();return b=b||{},h.prototype.disable=function(){f()},h.prototype.enable=function(){g()},Object.defineProperties(h.prototype,{onup:{set:function(a){k=a}},ondown:{
set:function(a){l=a}},onleft:{set:function(a){i=a}},onright:{set:function(a){j=a}},onenter:{set:function(a){m=a}}}),new h}return c}]),angular.module("employeeApp").directive("supplierList",["Supplier","$mdToast","KeyboardNavigation","$rootScope","$filter",function(a,b,c,d,e){return{templateUrl:"views/templates/supplier-list.html",replace:!0,restrict:"A",scope:{visible:"=supplierList",onSelect:"&"},link:function(f,g,h){function i(a){return e("orderBy")(e("filter")(f.suppliers,f.query),"name")}function j(a){d.safeApply(function(){k&&(k.$selected=!1),k=i(f.suppliers)[a],k&&(k.$selected=!0)});var b=$(".supplier.selected"),c=b.parents(".inner-container"),e=c.scrollTop(),g=c.innerHeight();e>b.outerHeight()*a?c.scrollTop(b.outerHeight()*a):e+g<b.outerHeight()*a&&c.scrollTop(b.outerHeight()*a)}var k,l=!0,m=0;f.suppliers=a.query({limit:20},function(a){l=!1,j(m)}),f.$watch("query",function(b){b&&a.query({q:b,limit:5},function(a){for(var b=0;b<a.length;b++)-1==f.suppliers.indexOfById(a[b].id)&&f.suppliers.push(a[b]);m=0,j(m)})}),f.loadNext=function(){l||(b.show(b.simple().position("right top").hideDelay(0).content("Loading more suppliers...")),l=!0,a.query({offset:f.suppliers.length,limit:50},function(a){l=!1,b.hide();for(var c=0;c<a.length;c++)f.suppliers.push(a[c])}))},f.select=function(a){f.onSelect({$supplier:a})};var n=new c;n.ondown=function(){m<i(f.suppliers).length-1&&(m+=1,j(m))},n.onup=function(){0!==m&&(m-=1,j(m))},n.onenter=function(){d.safeApply(function(){f.select(k)})},f.$watch("visible",function(a){a?n.enable():n.disable()}),f.$on("$destroy",function(){n.disable()})}}}]),angular.module("employeeApp").directive("supplyList",["Supply","$filter","KeyboardNavigation","$mdToast","$rootScope","$http","$compile",function(a,b,c,d,e,f,g){return{templateUrl:"views/templates/supply-list.html",replace:!0,restrict:"A",scope:{visible:"=supplyList",onSelect:"&",supplier:"=",newSupply:"="},compile:function(g,h,i){return{post:function(g,h,i){function j(a){return b("filter")(a,g.query)}function k(a){e.safeApply(function(){m&&(m.$selected=!1),m=j(g.supplies)[a],m&&(m.$selected=!0)});var b=$(".supply.selected"),c=b.parents(".inner-container"),d=c.scrollTop(),f=c.innerHeight();d>b.outerHeight()*a?c.scrollTop(b.outerHeight()*a):d+f<b.outerHeight()*a&&c.scrollTop(b.outerHeight()*a)}var l,m,n=!0,o=0,p=f.get("/api/v1/supply/type/");p.success(function(a){g.types=a,g.types.splice(g.types.indexOf(null),1)}),i.supplier?g.$watch("supplier",function(b){b&&(l=b.id,g.supplies=a.query({supplier_id:b.id,limit:20},function(a){n=!1,k(o)}))}):g.supplies=a.query({limit:20},function(a){n=!1,k(o)}),g.$watch("query",function(b){if(b){var c={q:b,limit:10+2*b.length};l&&(c.supplier_id=l),a.query(c,function(a){for(var b=0;b<a.length;b++)-1==g.supplies.indexOfById(a[b].id)&&g.supplies.push(a[b]);o=0,k(o)})}}),g.$watch("newSupply",function(b){b instanceof a&&(g.supplies=g.supplies||[],-1==g.supplies.indexOfById(b.id)&&g.supplies.push(b))}),g.loadNext=function(){if(n=!1,!n){d.show(d.simple().position("top right").hideDelay(0).content("Loading more supplies...")),n=!0;var b={offset:g.supplies.length,limit:50};l&&(b.supplier_id=l),a.query(b,function(a){n=!1,d.hide();for(var b=0;b<a.length;b++)-1==g.supplies.indexOfById(a[b])&&g.supplies.push(a[b])})}},g.select=function(a){g.onSelect({$supply:a})};var q=new c;q.ondown=function(){o<j(g.supplies).length-1&&(o+=1,k(o))},q.onup=function(){0!==o&&(o-=1,k(o))},q.onenter=function(){e.safeApply(function(){g.select(m)})},g.$watch("visible",function(a){a?q.enable():q.disable()}),g.$on("$destroy",function(){q.disable()})}}}}}]),angular.module("employeeApp.services").service("CameraService",function(){function a(){return navigator.getUserMedia=window.navigator.getUserMedia||window.navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia||window.navigator.msGetUserMedia,navigator.getUserMedia}return{hasUserMedia:function(){return!!a()},getUserMedia:a}}),angular.module("employeeApp.directives").directive("camera",["CameraService","$log",function(a,b){return{template:'<div class="camera"><div class="guide"></div><div class="active-media-area"><canvas></canvas><video class="camera-video"></video></div><div class="snapshot-btn" ng-click="takeSnapshot()"></div><div class="btn-menu"><div  class="save-btn" ng-click="save()">Save</div><div class="retake-btn" ng-click="retake()">Retake</div></div></div>',restrict:"EA",replace:!0,scope:{onSnapshot:"&",cropOptions:"=",square:"=",depth:"="},link:function(c,d,e){function f(a){var b=atob(a.split(",")[1]),c=new Uint8Array(b.length);for(var d in b)c[d]=b.charCodeAt(d);return new Blob([c],{type:"image/jpeg"})}if(a.hasUserMedia()){var g=(a.getUserMedia,d.find("canvas")[0]),h=g.getContext("2d"),i=d.find("video")[0],j=c.width||1280,k=c.height||720;c.square&&angular.element(g).addClass("square");var l=function(a){i.src=window.URL.createObjectURL(a),i.play()};navigator.getUserMedia({video:{mandatory:{minWidth:j,minHeight:k}},audio:!1},l,function(a){navigator.getUserMedia({video:!0,audio:!1},l,function(a){b.error(a)})}),c.retake=function(){$(d).removeClass("active")},c.save=function(){var a=f(g.toDataURL("image/jpeg"));c.onSnapshot({$image:a}),c.retake()},c.takeSnapshot=function(){j=c.square?i.videoHeight:i.videoWidth,k=i.videoHeight,g.height=c.square?angular.element(i).height():k,g.width=c.square?g.height:j,h.fillRect(0,0,j,k),c.square?h.drawImage(i,(i.videoWidth-j)/2,0,j,k,0,0,g.width,g.height):h.drawImage(i,0,0,j,k),$(d).addClass("active")}}}}}]),angular.module("employeeApp.services").factory("requestError",["$q",function(a){return{response:function(b){return b||a.when(b)},responseError:function(b){if(b.status>400){var c="AJAX failed. status: "+b.status+". response: "+b.statusText;$.ajax({type:"POST",url:"/api/v1/client/log/",data:{type:"error",message:c},processData:!0})}return a.reject(b)}}}]).config(function(a){a.interceptors.push("requestError")}),angular.module("employeeApp.directives").directive("supplyScannerModal",["scanner","Supply","$mdToast","KeyboardNavigation","$timeout","$rootScope","Equipment",function(a,b,c,d,e,f,g){return{templateUrl:"views/templates/supply-scanner-modal.html",restrict:"A",replace:!0,scope:{visible:"=supplyScannerModal"},link:function(h,i,j){function k(a){"$digest"===h.$$phase||"$apply"===h.$$phase?h.action=a:h.$apply(function(){h.action=a})}var l=new d;h.action="subtract",h.disabled=!1,h.scanner=new a("supply-scanner-modal"),h.equipment={description:"F-50",brand:"Red King"},h.interfaceType="equipment";var m=function(){var a=i.find("input");a.focus(),a.val("")};h.fractSize=function(){return h.supply&&"pc"==h.supply.units?0:2},h.$watch("showAddImage",function(a){a?i.addClass("add-image"):i.removeClass("add-image")}),h.addImage=function(a){c.show(c.simple().hideDelay(0).position("top right").content("Updating the supply's image"));var b=a.hasOwnProperty("data")?a.data:a;h.supply.image=b,h.supply.$update(function(){c.show(c.simple().hideDelay(2e3).position("top right").content("Supply's image updated."))})},h.interfaceType="supply",h.changeQuantity=function(a){if(a=a||h.quantity,h.supply.hasOwnProperty("id")&&a>0&&!h.disabled){if("subtract"==h.action&&h.supply.quantity-a<0)throw Error("Cannot have a negative quantity");h.disabled=!0,"subtract"==h.action?h.supply.quantity-=Number(a):"add"==h.action&&(h.supply.quantity+=Number(a)),h.supply.$update({country:f.country},function(){c.show(c.simple().hideDelay(2e3).position("top right").content("Quantity of "+h.supply.description+" changed to "+h.supply.quantity)),h.quantity=0,e(function(){h.supply=void 0},1500)},function(a){c.show(c.simple().hideDelay(2e3).position("top right").content(a))})}},h.scanner.register(/^DRS-\d+$/,function(a){c.show(c.simple().hideDelay(0).position("top right").content("Looking up supply")),h.interfaceType="supply",h.supply=b.get({id:a.split("-")[1],country:f.country},function(a){h.disabled=!1,Notification.hide(),m()},function(){c.show(c.simple().hideDelay(0).position("top right").content("Unable to find supply."))})}),h.scanner.register(/^\d+(\-\d+)*$/,function(a){h.interfaceType="supply",b.query({upc:a,country:f.country},function(a){h.disabled=!1,m();try{h.supply=a[0]}catch(b){}},function(a){})}),h.scanner.register(/^DRE-\d+$/,function(a){c.show(c.simple().hideDelay(0).position("top right").content("Looking up equipment.")),h.interfaceType="equipment",h.equipment=g.get({id:a.split("-")[1]},function(a){h.disabled=!1,c.hide()},function(){c.show(c.simple().hideDelay(0).position("top right").content("Unable to find equipment."))})}),l.onright=function(){k("subtract")},l.onleft=function(){k("add")},l.onenter=function(){h.changeQuantity(h.quantity)},h.$watch("visible",function(a){if(a){try{window.globalScanner.disable()}catch(b){}h.scanner.enable(),l.enable(),h.scanner.disableStandard()}else h.scanner.disable(),l.disable(),h.scanner.enableStandard(),h.showAddImage=!1}),h.$on("$destroy",function(){l.disable(),h.scanner.disable(),h.showAddImage=!1})}}}]),angular.module("employeeApp").service("Resizer",function(){}),angular.module("employeeApp").directive("touchstart",function(){return{restrict:"A",link:function(a,b,c){function d(a){b.addClass("touch-start")}window.iOS&&(b.on("touchstart",d),a.$on("$destroy",function(){b.off("touchstart",d)}))}}}),angular.module("employeeApp").directive("touchmove",function(){return{restrict:"A",link:function(a,b,c){function d(a){b.addClass("touch-move"),b.removeClass("touch-start")}window.iOS&&(b.on("touchmove",d),a.$on("$destroy",function(){b.off("touchmove",d)}))}}}),angular.module("employeeApp").directive("touchend",function(){return{restrict:"A",link:function(a,b,c){function d(a){b.removeClass("touch-start"),b.removeClass("touch-move")}window.iOS&&(b.on("touchend",d),a.$on("$destroy",function(){b.off("touchmove",d)}))}}}),angular.module("employeeApp").directive("touchselect",["$location",function(a){return{restrict:"A",link:function(b,c,d){function e(a){a.preventDefault(),a.stopPropagation()}function f(){i=!0}function g(){j=!0}function h(){if(i&&!j){var e=d.ngHref||d.href;b.safeApply(function(){a.path(e)}),c.click()}i=!1,j=!1}var i=!1,j=!1;window.iOS&&(c.on("click",e),c.on("touchstart",f),c.on("touchmove",g),c.on("touchend",h),b.$on("$destroy",function(){c.off("click",e),c.off("touchstart",f),c.off("touchmove",g),c.off("touchEnd",h)}))}}}]),angular.module("employeeApp").controller("SupplyLogCtrl",["$scope","$http","SupplyLog",function(a,b,c){a.logs=c.query()}]),angular.module("employeeApp").factory("SupplyLog",["$resource",function(a){return a("/api/v1/log/:id/",{id:"@id"},{create:{method:"POST"},update:{method:"PUT"}})}]),angular.module("employeeApp").controller("SupplyBuyingGuideCtrl",["$scope","Supply","$http",function(a,b,c){var d;a.d?d=a.d:(d=new Date,d.setDate(d.getDate()-21)),a.supplies=b.query({log__action:"SUBTRACT",log__timestamp__gt:d.toISOString()})}]),angular.module("employeeApp.directives").directive("supply",["$http","Supply","$rootScope","$mdToast","$timeout","$window","scanner","D3","$compile","FileUploader","$log",function(a,b,c,d,e,f,g,h,i,j,k){function l(a,b,c,d){var e=h.select("div."+d+" .chart").selectAll("div").data(a).enter().append("div").attr("class","price-box").style("left",function(a,b){return 6*b+b+"em"}).attr("class",function(c,d){try{return Number(a[d+1][b])>Number(c[b])?"price-box green":Number(a[d+1][b])<Number(c[b])?"price-box red":"price-box black"}catch(e){return"price-box black"}});e.append("span").text(function(a){return a[b]}).attr("class","price"),e.append("span").attr("class","date").text(function(a){var b=new Date(a.timestamp);return b.toLocaleDateString("en-us",{year:"numeric",month:"short",day:"numeric"})});h.select("div."+d).transition().duration(1e3).style("border","1px solid #CCC").style("height","10em"),e.transition().duration(2e3).delay(1e3).style("height",function(a){return a[b]/c*8+"em"})}var m,n=a.get("views/templates/supply-details.html");return n.then(function(a){m=a.data||a},function(){}),{templateUrl:"views/templates/supply.html",replace:!0,restrict:"A",scope:{supply:"=",onSelect:"&"},link:function(n,o,p){function q(){v=n.$watch(function(){for(var a=angular.copy(n.supply),b=["last_modified","image","supplier","suppliers","sticker","$promise","$resolved"],c=0;c<b.length;c++)delete a[b[c]];return a},function(a,b){b.hasOwnProperty("id")&&!angular.equals(a,b)&&(e.cancel(u),u=e(function(){var a=angular.copy(n.supply);d.show(d.simple().hideDelay(0).position("top right").content("Saving "+n.supply.description+"...")),a.$update({country:c.country},function(){d.show(d.simple().hideDelay(2e3).position("top right").content(n.supply.description+" saved"))},function(){d.show(d.simple().hideDelay(0).position("top right").content("There was an error in saving "+n.supply.description))})},750))},!0)}function r(a,b){for(var c=a.data||a,d=[],e=0;e<c.length;e++)d.push(c[e][b]);return largest=Math.max.apply(Math,d),{largest:Math.max.apply(Math,d),data:c}}function s(){var a=function(){$(".print").empty()};if(window.matchMedia){var b=window.matchMedia("print");b.addListener(function(b){b.matches?angular.noop():a()})}window.onafterprint=a,this.contentWindow.focus(),this.contentWindow.print()}var t=!1;n.fetched=!1,n.units=angular.copy(c.units),n.types=angular.copy(c.types||[]),n.scanner=new g("supply/"+n.supply.id),n.scanner.disableStandard(),n.scanner.register(/^\d+(\-\d+)*$/,function(a){n.upcTarget&&(n.supply.suppliers[n.supply.suppliers.indexOfById(n.upcTarget.id)].code=a,n.scanner.disable(),globalScanner.enable(),n.upcTarget=void 0)});for(var u,v=angular.noop(),w=["custom",null],x=0;x<w.length;x++){var y=n.types.indexOf(w[x]);-1!=y&&n.types.splice(n.types.indexOf(w[x]),1)}n.showWidth=function(){return validWidth.indexOf($scope.supply.units)>-1||validWidth.indexOf($scope.supply.type)>-1||"kg"==$scope.supply.units&&"packaging"==$scope.supply.type?!0:!1},n.showDepth=function(){return validDepth.indexOf($scope.supply.units)>-1?!0:!1},n.showHeight=function(){return validHeight.indexOf($scope.supply.units)>-1||"kg"==$scope.supply.units&&"packaging"==$scope.supply.type?!0:!1},n.viewStickers=function(){try{f.open(n.supply.sticker.url)}catch(a){d.show(d.simple().hideDelay(0).position("top right").content("This supply is missing a sticker"))}},n.activate=function(){if(0===o.find(".supply-details").children().length){var c=i(m)(n);angular.element(o.find(".supply-details")).append(c),t=!0}if(o.hasClass("active"))o.removeClass("active"),v();else{o.addClass("active");try{n.onSelect({$element:o})}catch(d){k.warn(d)}b.get({id:n.supply.id},function(b){angular.extend(n.supply,b),q(),n.fetched=!0,a.get("/api/v1/log/",{params:{action:"SUBTRACT",supply:n.supply.id}}).then(function(a){var b=r(a,"quantity");b.data.length>0&&l(b.data,"quantity",b.largest,"usage-chart-supply-"+n.supply.id)});for(var c in n.supply.suppliers){var d=n.supply.suppliers[c];"object"==typeof d&&a.get("/api/v1/log/",{params:{action:"PRICE CHANGE",supply:n.supply.id,supplier:d.id}}).then(function(a){var b=a.config.params.supplier,c=r(a,"cost");n.price_logs=n.price_logs||[],n.price_logs.push(c.data),c.data.length>0?l(c.data,"cost",c.largest,"price-chart-supplier-"+b):h.select("div.price-chart-supplier-"+b+" .chart").style("display","none")})}})}},n.addUPC=function(a){globalScanner.disable(),n.upcTarget=a,n.scanner.enable()};var z=o.find(".image-capture")[0];angular.element(z).on("change",function(a){if(a.target.files.length>0){var b=a.target.files[0],e=j.upload(b,"/api/v1/supply/image/");d.show(d.simple().position("top right").hideDelay(0).content("Uploading file...")),e.then(function(a){d.show(d.simple().position("top right").hideDelay(3e3).content("File was uploaded.")),n.supply.image=a.data,n.supply.$update({country:c.country},function(){d.show(d.simple().position("top right").hideDelay(3e3).content(n.supply.description+" was updated."))},function(a){d.show(d.simple().position("top right").hideDelay(3e3).content(a))})},function(){d.show(d.simple().position("top right").hideDelay(0).content("There was an error uploading the file"))})}}),n.printSticker=function(){var a=$(".print").empty(),b=document.createElement("iframe");b.onload=s,b.src="api/v1/supply/"+n.supply.id+"/sticker/",a.append(b)}}}}]),angular.module("employeeApp.services").factory("Employee",["$resource","$http",function(a){return a("/api/v1/employee/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp").directive("employee",["$rootScope","$timeout","Notification","Attendance","$log",function(a,b,c,d,e){return{templateUrl:"views/templates/employee.html",replace:!0,restrict:"EA",scope:{employee:"=",onSelect:"&"},link:function(a,f,g){function h(){k=a.$watch("employee",function(d,e){!j&&e.hasOwnProperty("id")&&(j=!0,i=b(function(){var b=angular.copy(a.employee);c.display("Updating "+a.employee.name+"...",!1),b.$update(function(){j=!1,c.display(a.employee.name+" updated")},function(){c.display("There was an error in updating "+a.employee.name)})},5e3))},!0)}a.fetched=!1,a.departments=["carpentry","painting","polishing","sewing","upholstery","foam","management","tufting","shearing","dying","inventory","packing","front office","graphics","accounting","landscaping"];var i,j=!1,k=angular.noop();a.addImage=function(b){var d=b.hasOwnProperty("data")?b.data:b;a.employee.image=d,a.employee.$update(function(){c.hide()})},a.activate=function(){if(f.hasClass("active"))f.removeClass("active"),k();else{f.addClass("active"),h();try{a.onSelect({$element:f})}catch(b){e.error(b)}a.attendances=d.query({employee__id:a.employee.id},function(b){a.attendances=[],a.attendances.push.apply(a.attendances,b)})}}}}}]),angular.module("employeeApp").factory("Attendance",["$resource","$http",function(a,b){return a("/api/v1/attendance/:id",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp").directive("attendanceChart",["D3","$log",function(a,b){return{templateUrl:"views/templates/attendance-chart.html",replace:!0,restrict:"EA",scope:{data:"=",active:"=",onSelect:"&"},link:function(c,d,e){function f(){for(var e,f=d.parents(".suppliers").width()/2,g=20,h=90,i=[],j=[],k=[],l=!1,m=0;m<c.data.length;m++)i.push(c.data[m].total_time);var n=a.max(i),o=a.select(d[0]).append("svg").attr("class","chart").attr("width",f).attr("height",20*c.data.length),p=(a.scale.linear().domain([0,a.max(i)]).range([0,f-h]),o.selectAll("g").data(c.data).enter().append("g").attr("transform",function(a,b){return"translate(0,"+20*b+")"}).on("mouseover",function(b){var d=a.select(this);if(l){var e=j.indexOfById(b);-1==e&&(j.push(b),k.push(this),d.attr("class","selected"))}else c.$apply(function(){c.active=b}),d.attr("class","active")}).on("mouseout",function(c){var d=$(this).offset().top,e=a.select(this);if(l){b.log(d+" : "+a.event.y);var f=j.indexOfById(c);d>=a.event.y&&(e.classed("selected",!1),j.splice(f,1))}else e.classed("active",!1)}).on("mousedown",function(b){l=!0,j.push(b);var c=a.event;e={x:c.x,y:c.y},a.select(this).classed("selected",!0).classed("active",!1)}).on("mouseup",function(){if(l=!1,j.length){window.alert(j.length);for(var a=0;a<k.length;a++)$(k[a]).removeClass("selected");j=[],k=[]}})),q=p.append("rect").attr("class","overtime").attr("x",h).attr("width",0).attr("height",g-1),r=p.append("rect").attr("class","regular-time").attr("x",h).attr("width",0).attr("height",g-1);p.append("text").attr("class","date").style("width",h+"px").attr("x",h-2).attr("y",10).attr("dy",".35em").text(function(a){var b=new Date(a.date);return b.toLocaleDateString("en-us",{year:"numeric",month:"short",day:"numeric"})});q.transition().duration(2e3).delay(function(){return 100*Math.random()}).attr("width",function(a){return a.total_time?a.total_time/n*f-h:0}),r.transition().duration(2e3).delay(function(){return 100*Math.random()}).attr("width",function(a){return a.regular_time?(a.regular_time/n||0)*f-h:0})}c.$watch("data",function(a){a&&f()})}}}]),angular.module("employeeApp.services").service("D3",function(){return d3}),angular.module("employeeApp").directive("supplies",["Supply","$filter","KeyboardNavigation","$mdToast","$rootScope","$http","$compile",function(a,b,c,d,e,f,g){return{templateUrl:"views/templates/supplies.html",replace:!0,restrict:"A",scope:{onSelect:"&",supplier:"=",newSupply:"="},compile:function(g,h,i){return{post:function(g,h,i){function j(a){return b("filter")(a,g.query)}function k(a){e.safeApply(function(){m&&(m.$selected=!1),m=j(g.supplies)[a],m&&(m.$selected=!0)});var b=$(".supply.selected"),c=b.parents(".inner-container"),d=c.scrollTop(),f=c.innerHeight();d>b.outerHeight()*a?c.scrollTop(b.outerHeight()*a):d+f<b.outerHeight()*a&&c.scrollTop(b.outerHeight()*a)}var l,m,n=!0,o=0,p=f.get("/api/v1/supply/type/");p.success(function(a){g.types=a,g.types.splice(g.types.indexOf(null),1)}),i.supplier?g.$watch("supplier",function(b){b&&(l=b.id,g.supplies=a.query({supplier_id:b.id,limit:20},function(a){n=!1,k(o)}))}):g.supplies=a.query({limit:20},function(a){n=!1,k(o)}),g.$watch("query",function(b){b&&(options={q:b,limit:10+2*b.length},l&&(options.supplier_id=l),a.query(options,function(a){for(var b=0;b<a.length;b++)-1==g.supplies.indexOfById(a[b].id)&&g.supplies.push(a[b]);o=0,k(o)}))}),g.$watch("newSupply",function(b){b instanceof a&&(g.supplies=g.supplies||[],-1==g.supplies.indexOfById(b.id)&&g.supplies.push(b))}),g.loadNext=function(){if(n=!1,!n){d.show(d.simple().position("top right").hideDelay(0).content("Loading more supplies...")),n=!0;var b={offset:g.supplies.length,limit:50};l&&(b.supplier_id=l),a.query(b,function(a){n=!1,d.hide();for(var b=0;b<a.length;b++)-1==g.supplies.indexOfById(a[b])&&g.supplies.push(a[b])})}},g.select=function(a){g.onSelect({$supply:a})};var q=new c;q.ondown=function(){o<j(g.supplies).length-1&&(o+=1,k(o))},q.onup=function(){0!==o&&(o-=1,k(o))},q.onenter=function(){e.safeApply(function(){g.select(m)})},g.$watch("visible",function(a){a?q.enable():q.disable()}),g.$on("$destroy",function(){q.disable()})}}}}}]),angular.module("employeeApp.services").factory("Equipment",["$resource","$http",function(a){return a("/api/v1/equipment/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp.directives").directive("addEquipment",["$rootScope","Supplier","Supply","Notification","$http","Equipment",function(a,b,c,d,e,f){return{templateUrl:"views/templates/add-equipment.html",replace:!0,restrict:"EA",scope:{visible:"=addEquipment",onAdd:"&"},link:function(a,b,c){a.equipment=new f,a.descriptions=[{description:"F-50 Pnuematic Stapler",image:"img/equipment/F50.jpg"},{description:"F-30 Pnuematic Stapler",image:"img/equipment/F30.jpg"},{description:"J-1022 Pnuematic Stapler",image:"img/equipment/J1022.jpg"},{description:"ST-64 Pneumatic Stapler",image:"img/equipment/ST64.jpg"},{description:"Electric Hand Drill",image:"img/equipment/hand_drill.jpg"},{description:"Electric Jigsaw",image:"img/equipment/jigsaw.jpg"},{description:"Electric Router",image:"img/equipment/router.jpg"},{description:"Polisher",image:"img/equipment/polisher.jpg"},{description:"Electric Sander",image:"img/equipment/electric_sander.jpg"}],a.brands=["Maktec","Red King","King","DMax","Puma","Ken","Jumbo","Makita","Bosch","BEC","Unknown"],a.statuses=["checked out","checked in","repair"],a.showDescription=!1,a.selectDescription=function(b){a.equipment.description=b.description,a.showDescription=!1},a.add=function(b){a.form.$valid&&a.equipment.description&&(d.display("Adding new "+a.description+"...",!1),a.equipment.$create(function(){d.display(a.description+" Added."),a.equipment=new f},function(){Notication.display("Could not add "+a.description,!1)}))},a.addImage=function(b){a.equipment.image=b}}}}]),angular.module("employeeApp").controller("EquipmentViewCtrl",["$scope","Equipment","Notification","$filter","KeyboardNavigation","$rootScope","$location","$http","FileUploader","$timeout","$log",function(a,b,c,d,e,f,g,h,i,j,k){function l(b){f.safeApply(function(){m&&(m.$selected=!1),m=filter(a.supplies)[b],m&&(m.$selected=!0)});var c=$(".item.selected"),d=c.parents(".outer-container"),e=d.scrollTop(),g=d.innerHeight();e>c.outerHeight()*b?d.scrollTop(c.outerHeight()*b):e+g<c.outerHeight()*b&&d.scrollTop(c.outerHeight()*b)}var m,n=!0,o=0;c.display("Loading supplies...",!1),a.scannerMode=!1,a.equipmentList=b.query({country:a.country},function(a){n=!1,c.hide(),l(o)}),a.focus=function(a){var b=$("div.outer-container");b.animate({scrollTop:b.scrollTop()+a.offset().top-$(".mainMenu").height()})},a.addImage=function(b,d){var e=i.upload(b.files[0],"/api/v1/supply/image");e.then(function(b){c.display("Image uploaded"),a.safeApply(function(){d.image=b.hasOwnProperty("data")?b.data:b,d.save()})},function(a){k.error(a),c.display("Unable to upload image",!1)})},a.$watch("query",function(b){b&&Supply.query({limit:b.length,q:b,country:a.country},function(b){for(var c=0;c<b.length;c++)-1==a.supplies.indexOfById(b[c].id)&&a.supplies.push(b[c]);o=0,l(o)})}),a.loadNext=function(){n||(c.display("Loading more supplies...",!1),b.query({offset:a.equipmentList.length,limit:50},function(b){c.hide();for(var d=0;d<b.length;d++)-1==a.equipmentList.indexOfById(b[d].id)&&a.equipmentList.push(b[d])}))};var p=new e;p.ondown=function(){o<filter(a.supplies).length-1&&(o+=1,l(o))},p.onup=function(){0!==o&&(o-=1,l(o))},p.onenter=function(){f.safeApply(function(){g.path("/supply/"+m.id)})},p.enable(),a.$watch("showAddSupply",function(a,b){a&&!b?p.disable():!a&&b&&p.enable()}),a.$watch("showAddSupplier",function(a,b){a&&!b?p.disable():!a&&b&&p.enable()}),a.$watch("scannerMode",function(a,b){a&&!b?(globalScanner.disable(),p.disable()):!a&&b&&(globalScanner.enable(),p.enable())}),a.$on("$destroy",function(){p.disable()})}]),angular.module("employeeApp.directives").directive("equipment",["$http","Equipment","$rootScope","Notification","$timeout","$window","scanner","D3","$compile","$log",function(a,b,c,d,e,f,g,h,i,j){var k,l=["Maktec","Red King","King","DMax","Puma","Ken","Jumbo","Makita","Bosch","BEC","Unknown"],m=["checked in","checked out","repair","out of service"],n=a.get("views/templates/supply-details.html");return n.then(function(a){k=a.data||a},function(){}),{templateUrl:"views/templates/equipment.html",replace:!0,restrict:"EA",scope:{equipment:"=",onSelect:"&"},link:function(a,c,f){function g(){i=a.$watch(function(){for(var b=angular.copy(a.equipment),c=["last_modified","image","supplier","sticker"],d=0;d<c.length;d++)delete b[c[d]];return b},function(b,c){c.hasOwnProperty("id")&&(e.cancel(h),h=e(function(){equipment=angular.copy(a.equipment),d.display("Saving DRE-"+a.equipment.id+"...",!1),equipment.$update(function(){d.display("DRE-"+a.equipment.id+" saved")},function(){d.display("There was an error in saving DRE-"+a.equipment.id)})},1250))},!0)}a.fetched=!1,a.brands=l,a.statuses=m;var h,i=angular.noop();a.activate=function(){if(c.hasClass("active"))c.removeClass("active"),i();else{c.addClass("active");try{a.onSelect({$element:c})}catch(d){j.error(d)}b.get({id:a.equipment.id},function(b){angular.extend(a.equipment,b),g(),a.fetched=!0})}}}}}]),angular.module("employeeApp").controller("SupplyShoppingListCtrl",["$scope","$http",function(a,b){var c=b.get("/api/v1/supply/shopping_list");c.then(function(b){a.supplies=b.data})}]),angular.module("employeeApp").directive("suppliers",["Supplier","$mdToast","KeyboardNavigation","$rootScope","$filter",function(a,b,c,d,e){return{templateUrl:"views/templates/suppliers.html",replace:!0,restrict:"A",scope:{onSelect:"&"},link:function(f,g,h){function i(a){return e("orderBy")(e("filter")(f.suppliers,f.query),"name")}function j(a){d.safeApply(function(){k&&(k.$selected=!1),k=i(f.suppliers)[a],k&&(k.$selected=!0)});var b=$(".supplier.selected"),c=b.parents(".inner-container"),e=c.scrollTop(),g=c.innerHeight();e>b.outerHeight()*a?c.scrollTop(b.outerHeight()*a):e+g<b.outerHeight()*a&&c.scrollTop(b.outerHeight()*a)}var k,l=!0,m=0;f.suppliers=a.query({limit:20},function(a){l=!1,j(m)}),f.$watch("query",function(b){b&&a.query({q:b,limit:5},function(a){for(var b=0;b<a.length;b++)-1==f.suppliers.indexOfById(a[b].id)&&f.suppliers.push(a[b]);m=0,j(m)})}),f.loadNext=function(){l||(b.show(b.simple().position("top right").hideDelay(0).content("Loading more suppliers...")),l=!0,a.query({offset:f.suppliers.length,limit:50},function(a){l=!1,b.hide();for(var c=0;c<a.length;c++)f.suppliers.push(a[c])}))},f.select=function(a){f.onSelect({$supplier:a})};var n=new c;n.ondown=function(){m<i(f.suppliers).length-1&&(m+=1,j(m))},n.onup=function(){0!==m&&(m-=1,j(m))},n.onenter=function(){d.safeApply(function(){f.select(k)})},f.$watch("visible",function(a){a?n.enable():n.disable()}),f.$on("$destroy",function(){n.disable()})}}}]),angular.module("employeeApp").controller("DialogsSupplyScannerCtrl",["$scope","$mdDialog","scanner","$timeout","Supply","$mdToast","Employee","$http","$rootScope","Equipment","PurchaseOrder","KeyboardNavigation",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=new l,n=!1;a.scanner=new c("supply-scanner-modal"),a.interfaceType="equipment",a.supplies=[],a.equipmentList=[],a.poList=k.query(),a.scanner.enable(),a.scanner.disableStandard(),m.onenter=function(a){a.preventDefault()};try{window.globalScanner.disable()}catch(o){}a.fractSize=function(){return a.supply&&"pc"==a.supply.units?0:2},a.remove=function(b,c){a.supplies.splice(b,1)},a.removeItem=function(b){a.po.items[b].$$action=!1},a.addImage=function(b){Notification.display("Updating the supply's image",!1);var c=b.hasOwnProperty("data")?b.data:b;a.supply.image=c,a.supply.$update(function(){Notification.display("Supply's image updated.")})},a.scanner.register(/^DRS-\d+$/,function(b){try{f.show(f.simple().hideDelay(3e3).position("top right").content("Looking up supply..."))}catch(c){}e.get({id:b.split("-")[1],country:i.country},function(b){f.hide(),-1==a.supplies.indexOfById(b)?(b.$$action="subtract",a.supplies.push(b),f.show(f.simple().hideDelay(2e3).position("top right").content("Added "+b.description+" to checkout."))):f.show(f.simple().hideDelay(2e3).position("top right").content(b.description+" already in checkout"))},function(){f.show(f.simple().hideDelay(0).position("top right").action("Close").content("Unable to find supply."))})}),a.scanner.register(/^\d+(\-\d+)*$/,function(b){try{f.show(f.simple().hideDelay(3e3).position("top right").content("Looking up supply..."))}catch(c){}e.query({upc:b,country:i.country},function(b){b[0].$$action="subtract",a.supplies.push(b[0]),f.hide(),f.show(f.simple().hideDelay(2e3).position("top right").content("Added "+b.description+" to checkout."))},function(a){})}),a.scanner.register(/^PO-\d+$/,function(b){try{f.show(f.simple().hideDelay(3e3).position("top right").content("Looking up Purchase Order..."))}catch(c){}k.get({id:b.split("-")[1]},function(b){a.po=b,f.hide();for(var c=0;c<a.po.items.length;c++)a.po.items[c].$$action=!0},function(a){})}),a.scanner.register(/^DRE-\d+$/,function(b){f.show(f.simple().hideDelay(0).position("top right").action("Close").content("Looking up Equipment...")),j.get({id:b.split("-")[1]},function(b){f.hide(),a.equipmentList.push(b)},function(){f.show(f.simple().content("Unable to find equipment.").position("top right").action("Close").hideDelay(0))})}),a.scanner.register(/^DREM-\d+$/,function(b){f.hide(),f.show(f.simple().content("Looking up employee...").position("top right").action("close").hideDelay(0)),a.equipment=g.get({id:b.split("-")[1]},function(b){a.employee=b,f.hide()},function(){f.show(f.simple().content("Unable to find employee.").position("top right").action("close").hideDelay(0))})}),a.verify=function(){f.hide();for(var b=0;b<a.supplies.length;b++)if("subtract"==a.supplies[b].$$action&&a.supplies[b].$$quantity>a.supplies[b].quantity)throw Error(a.supplies[b].description+" quantity cannot be negative");return!0},a.checkout=function(){if(f.show(f.simple().position("top right").hideDelay(0).content("Processing checkout...")),!n){n=!0;try{a.verify();for(var b=angular.copy(a.supplies),c=0;c<b.length;c++)b[c].employee=angular.copy(a.employee),"subtract"==b[c].$$action?b[c].quantity-=b[c].$$quantity:"add"==b[c].$$action&&(b[c].quantity+=b[c].$$quantity);
if(b.length>0){var d=h.put("/api/v1/supply/",b);d.success(function(){a.supplies=[],a.postCheckout()}).error(function(b){a.checkoutError(b)})}for(var e=0;e<a.equipmentList.length;e++)a.equipmentList[e].employee=angular.copy(a.employee);if(a.equipmentList.length>0){var g=h.put("/api/v1/equipment/",a.equipmentList);g.success(function(){a.equipmentList=[],a.postCheckout()}).error(function(b){a.checkoutError(b)})}}catch(i){n=!1,f.show(f.simple().position("top right").hideDelay(0).action("close").content(i.message))}if(a.po){for(var j=0;j<a.po.items.length;j++)a.po.items[j].$$action&&(a.po.items[j].status="Received");a.po.status="Received",a.po.$update(function(){delete a.po,a.postCheckout()})}}},a.postCheckout=function(){0!==a.supplies.length||0!==a.equipmentList.length||a.po||(n=!1,a.employee=void 0,f.show(f.simple().position("top right").hideDelay(2e3).content("Checkout complete.")))},a.checkoutError=function(a){f.show(f.simple().position("top right").hideDelay(0).action("Close").content("There was a checkout error"))},a.$on("$destroy",function(){a.scanner.disable();try{window.globalScanner.enable()}catch(b){}})}]),angular.module("employeeApp").controller("DialogsAddEmployeeCtrl",["$scope","Employee","$mdToast",function(a,b,c){a.employee=new b,a.departments=["carpentry","painting","polishing","sewing","upholstery","foam","management","tufting","shearing","dying","inventory","packing","front office","graphics","accounting","landscaping"],a.addImage=function(b){var c=b.hasOwnProperty("data")?b.data:b;a.employee.image=c},a.create=function(){c.show(c.simple().hideDelay(0).position("top right").content("Creating employee "+a.employee.first_name+".")),a.employee.$create(function(){c.hide(),c.show(c.simple().hideDelay(2e3).position("top right").content("Employee "+a.employee.first_name+" created.")),a.reset()})},a.reset=function(){a.employee=new b}}]),angular.module("employeeApp").controller("AddSupplierContactCtrl",["$scope","$mdDialog",function(a,b){a.complete=function(){b.hide()}}]),angular.module("employeeApp").directive("fileDrop",function(){return{restrict:"EA",scope:{onDrop:"&fileDrop"},link:function(a,b,c){var d=new FileReader;d.onload=function(b){a.onDrop({$file:b.target.result})},b.bind("drag",function(a){a.preventDefault(),a.stopPropagation(),b.addClass("drag-active")}),b.bind("dragenter",function(a){a.preventDefault(),a.stopPropagation(),b.addClass("drag-activeactive")}),b.bind("dragleave",function(a){a.preventDefault(),a.stopPropagation(),b.removeClass("drag-activeactive")}),b.bind("dragover",function(a){a.preventDefault(),a.stopPropagation(),b.addClass("drag-activeactive")}),b.bind("drop",function(c){c.preventDefault(),c.stopPropagation(),b.removeClass("drag-activeactive");var d=c.originalEvent,e=d.dataTransfer.files;a.onDrop({$files:e})})}}}),angular.module("employeeApp").controller("OrderEstimateViewCtrl",["$scope","Estimate","$location","$filter","KeyboardNavigation","$mdToast",function(a,b,c,d,e,f){function g(b){return d("filter")(b,a.query)}function h(b){a.safeApply(function(){i&&(i.$selected=!1),i=g(a.estimates)[b],i&&(i.$selected=!0)});var c=$(".item.selected"),d=c.parents(".outer-container"),e=d.scrollTop(),f=d.innerHeight();e>c.outerHeight()*b?d.scrollTop(c.outerHeight()*b):e+f<c.outerHeight()*b&&d.scrollTop(c.outerHeight()*b)}var i,j=!0,k=0;f.show(f.simple().position("top right").content("Loading estimates...").hideDelay(0));a.estimates=b.query({limit:20},function(a){f.hide(),j=!1,h(k)}),a.$watch("query.$.$",function(c){c&&b.query({q:c,limit:c?c.length:5},function(b){for(var c=0;c<b.length;c++)-1==a.estimates.indexOfById(b[c].id)&&a.estimates.push(b[c]);k=0,h(k)})}),a.loadNext=function(){if(!j){j=!0;f.show(f.simple().position("top right").hideDelay(0).content("Loading more acknowledgements..."));b.query({limit:50,offset:a.estimates.length},function(b){j=!1,f.hide();for(var c=0;c<b.length;c++)a.estimates.push(b[c])})}};var l=new e;l.ondown=function(){k<g(a.estimates).length-1&&(k+=1,h(k))},l.onup=function(){0!==k&&(k-=1,h(k))},l.onenter=function(){a.safeApply(function(){c.path("/order/acknowledgement/"+i.id)})},l.enable(),a.$on("$destroy",function(){l.disable()})}]),angular.module("employeeApp.services").factory("Estimate",["$resource","$http",function(a,b){return a("/api/v1/estimate/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp").controller("OrderEstimateCreateCtrl",["$scope","Estimate","Customer","$filter","$window","Project","$mdToast","FileUploader","$log",function(a,b,c,d,e,f,g,h,i){a.showFabric=!1,a.uploading=!1,a.customImageScale=100,a.projects=f.query({page_size:99999}),a.estimate=new b;var j=window.localStorage;j.getItem("estimate-create")&&angular.extend(a.estimate,JSON.parse(j.getItem("estimate-create"))),a.estimate.items=a.estimate.items||[],a.employee={id:a.currentUser.id},a.tempSave=function(){j.setItem("estimate-create",JSON.stringify(a.estimate))},a.addCustomer=function(b){a.estimate.customer=b,a.showCustomers=!1,a.tempSave()},a.addItem=function(b){a.estimate.items.push(b),a.tempSave()},a.removeItem=function(b){a.estimate.items.splice(b,1),a.tempSave()},a.addFiles=function(b){a.estimate.files=a.estimate.files||[];for(var c=0;c<b.length;c++){a.estimate.files.push({filename:b[c].name});var d=h.upload(b[c],"/api/v1/acknowledgement/file/");d.then(function(b){for(var c=b.data||b,d=0;d<a.estimate.files.length;d++)c.filename==a.estimate.files[d].filename&&angular.extend(a.estimate.files[d],c)},function(){})}},a.create=function(){a.estimate.employee=a.currentUser,a.tempSave();try{a.isValidated()&&(g.show(g.simple().position("top right").content("Creating new acknowledgement...").hideDelay(0)),a.estimate.newProject&&(a.estimate.project={codename:a.estimate.newProjectName},delete a.estimate.newProject,delete a.estimate.newProjectName),a.estimate.$create(function(b){g.show(g.simple().position("top right").content("Estimate created with ID: "+a.estimate.id).hideDelay(2e3)),b.pdf&&e.open(b.pdf),angular.extend(a.estimate,JSON.parse(j.getItem("estimate-create"))),delete a.estimate.newProject,delete a.estimate.newProjectName},function(a){i.error(a),g.show(g.simple().content(a).hideDelay(0))}))}catch(b){g.show(g.simple().position("top right").content(b).hideDelay(0))}},a.reset=function(){a.estimate=new b,a.estimate.items=[],j.removeItem("estimate-create")},a.isValidated=function(){if(!a.estimate.customer)throw new TypeError("Please add a customer.");if(!a.estimate.customer.hasOwnProperty("id"))throw new ReferenceError("Missin customer ID");if(!a.estimate.items)throw new TypeError("Products is not an array");if(a.estimate.items.length<=0)throw new RangeError("No products added to the order");for(var b=0;b<a.estimate.items.length;b++){var c=a.estimate.items[b];if(!a.estimate.items[b].hasOwnProperty("quantity")||!a.estimate.items[b].quantity)throw new RangeError("Expecting a quantity of at least 1 for "+a.estimate.items[b].description);if(a.estimate.items[b].hasOwnProperty("has_price")&&!a.estimate.items[b].has_price,!c.hasOwnProperty("id")&&!c.is_custom)throw new TypeError("Item without id is not custom. Please contact an Administrator.")}if(!a.estimate.delivery_date)throw new TypeError("Please select a preliminary delivery date.");if(void 0===a.estimate.vat||null===a.estimate.vat)throw new TypeError("Please set the vat.");return!0}}]),angular.module("employeeApp").controller("OrderEstimateDetailsCtrl",["$scope","Estimate","$routeParams","$http","$window","$mdToast","FileUploader",function(a,b,c,d,e,f,g){f.show(f.simple().position("top right").content("Loading estimate...").hideDelay(0)),a.showCal=!1,a.estimate=b.get({id:c.id,pdf:!0},function(){f.hide()}),a.gridOptions={data:"acknowledgement.products",columnDefs:[{field:"image",displayName:"Image"}]},a.addFiles=function(b){a.estimate.files=a.estimate.files||[];for(var c=0;c<b.length;c++){a.estimate.files.push({filename:b[c].name});var d=g.upload(b[c],"/api/v1/acknowledgement/file/");d.then(function(b){for(var c=b.data||b,d=0;d<a.estimate.files.length;d++)c.filename==a.estimate.files[d].filename&&angular.extend(a.estimate.files[d],c);a.estimate.$update()},function(){})}},a.save=function(){f.show(f.simple().position("top right").content("Saving acknowledgement...").hideDelay(0)),a.estimate.$update(function(b){f.show(f.simple().position("top right").content("Acknowledgement "+a.estimate.id+" saved."))},function(){f.show(f.simple().position("top right").content("Failed to save acknowledgement "+a.estimate.id))})}}]),angular.module("employeeApp").directive("purchaseOrderSummary",["D3","$http","$filter",function(a,b,c){function d(b,d){var e=a.select(b[0]).selectAll("div").data(d).enter().append("div").attr("class",function(a){return a.category.toLowerCase()});e.append("span").text(function(a){return"$"+c("number")(a.amount)}),e.append("span").text(function(a){return a.category+" "+a.count}),e.append("div").attr("class","arrow"),e.transition().duration(2e3).ease("cubic-in-out").style("width",function(a){var b=a.count/a.total*100;return 10>b?b=10:b>80&&(b=80),b+"%"})}return{restrict:"EA",link:function(a,c,e){c.addClass("purchase-order-summary");var f=b.get("/api/v1/purchase-order/stats/");f.then(function(a){a=a.data;var b=a.total.count,e=[{count:a.processed.count,amount:a.processed.amount,category:"Processed",total:b},{count:a.received.count,amount:a.received.amount,category:"Received",total:b},{count:a.paid.count,amount:a.paid.amount,category:"Paid",total:b}];d(c,e)})}}}]),angular.module("employeeApp").directive("acknowledgementSummary",["D3","$http","$filter","$log","$rootScope",function(a,b,c,d,e){function f(a,b){if(a)for(var c in a.logs)if(a.logs[c].hasOwnProperty("message")&&a.logs[c].message.indexOf(b)>-1)return!0;return!1}function g(b,c,g,h){var i=a.select(b[0]).selectAll("div").data(c).enter().append("div").attr("class",function(a){return a.category.toLowerCase().replace(/ /gi,"-")});i.append("span").text(function(a){return a.category+" "+a.count}),i.append("div").attr("class","arrow"),i.on("click",function(a){angular.element(".acknowledgement-summary div.active").removeClass("active"),d3.select(this).attr("class","active "+a.category.toLowerCase().replace(/ /gi,"-")),(g||angular.noop)({$category:a.category})}).on("mouseenter",function(a){var b="acknowledged"==a.category.toLowerCase()?"open":a.category.toLowerCase();e.safeApply(function(){for(var a in h||[])try{f(h[a],b)&&(h[a].$active=!0)}catch(c){d.warn(c)}})}).on("mouseleave",function(a){e.safeApply(function(){for(var a in h||[])h[a].$active=!1})}),i.transition().duration(2e3).ease("cubic-in-out").style("width",function(a){var b=a.count/a.total*100;return 17>b?b=17:b>70&&(b=66),b+"%"})}return{restrict:"EA",scope:{onClick:"&",acknowledgements:"="},link:function(a,c,d){c.addClass("acknowledgement-summary");var e=b.get("/api/v1/acknowledgement/stats/");e.then(function(b){b=b.data;var d=b.total.count,e=[{count:b.acknowledged.count,amount:b.acknowledged.amount,category:"Acknowledged",total:d},{count:b.deposit_received.count,amount:b.deposit_received.amount,category:"Deposit Received",total:d},{count:b.in_production.count,amount:b.in_production.amount,category:"In Production",total:d},{count:b.ready_to_ship.count,amount:b.ready_to_ship.amount,category:"Ready to Ship",total:d},{count:b.shipped.count,amount:b.shipped.amount,category:"Shipped",total:d},{count:b.invoiced.count,amount:b.invoiced.amount,category:"Invoiced",total:d},{count:b.paid.count,amount:b.paid.amount,category:"Paid",total:d}];g(c,e,a.onClick,a.acknowledgements)})}}}]),angular.module("employeeApp").controller("DialogsAddRoomCtrl",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("employeeApp.services").factory("RoomItem",["$resource","$http",function(a,b){return a("/api/v1/room-item/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp").factory("Phase",["$resource","$http",function(a,b){return a("/api/v1/phase/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp").factory("ProjectItemPart",["$resource","$http",function(a,b){return a("/api/v1/project-part/:id/",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"}})}]),angular.module("employeeApp").controller("DialogsChangePasswordCtrl",["$scope","$mdDialog","$http","$mdToast","$log",function(a,b,c,d,e){a.changePassword=function(){if(a.old_password&&a.new_password===a.repeat_password){var f={old:a.old_password,newPass:a.new_password,repeatPass:a.repeat_password},g=c.post("/api/v1/change_password/",f);g.then(function(){b.hide(),d.show(d.simple().position("top right").content("Password Changed.").hideDelay(2e3))},function(a){e.log(a),d.show(d.simple().position("top right").action("Close").content(a.data.status).hideDelay(0))})}else{var h;h=a.old_password?"New passwords do not match.":"Must input current password.",d.show(d.simple().position("top right").action("Close").content(h).hideDelay(0))}},a.cancel=function(){b.hide()}}]),angular.module("employeeApp").controller("DialogsCreatePackingListCtrl",["$scope","$mdDialog","Room","Shipping","$log",function(a,b,c,d,e){function f(){function b(b){angular.extend(a.project.rooms[a.project.rooms.indexOfById(b)],b)}for(var d=0;d<a.project.rooms.length;d++){c.get({id:a.project.rooms[d].id},b)}}setTimeout(function(){a.project=this.project,f()}.bind(this)),a.completeAddPacking=function(){var c=new d;c.phase=a.phase,c.project=a.project,c.items=[];for(var f=0;f<a.project.rooms.length;f++)for(var g=0;g<a.project.rooms[f].items.length;g++)for(var h=0;h<a.project.rooms[f].items[g].parts.length;h++)c.items.push(a.project.rooms[f].items[g].parts[h]);b.hide(),c.$create(function(a){e.log(a)})},a.cancelAddPacking=function(){b.hide(),a.room=new c}}]),angular.module("employeeApp").controller("DialogsChangeFabricCtrl",["$scope","$mdDialog",function(a,b){a.close=function(){b.hide()}}]),angular.module("employeeApp").directive("fabricStorage",["$rootScope",function(a){function b(){this.hMargin=10}function c(){this.x=10,this.y=10,this.h=50,this.w=50,this.color="#AAAAAA",this.textColor="#000000",this.active=!1;for(var a=0;4>a;a++)this.shelves=[]}function d(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}}return b.prototype.draw=function(a,b){a.beginPath(),a.fillStyle="#CCCCCC",a.fillRect(10+this.hMargin,20,200-2*this.hMargin,100-2*this.hMargin)},b.prototype.isPointInElement=function(a,b){return a>=this.x&&a<=this.x+this.w&&b>=this.y&&b<=this.y+this.h?!0:!1},c.prototype.draw=function(a){if(a.beginPath(),a.fillStyle=this.color,a.fillRect(this.x,this.y,this.h,this.w),a.fillStyle=this.textColor,a.fillText(this.id,this.x+20,this.y+25),this.active){a.fillStyle="#CCCCCC",a.strokeRect(10,10,200,300);for(var b=0;b<this.shelves.length;b++)this.shelves[b].draw(a,this)}},c.prototype.isPointInElement=function(a,b){return a>=this.x&&a<=this.x+this.w&&b>=this.y&&b<=this.y+this.h?!0:!1},{template:"<canvas></canvas>",replace:!0,restrict:"EA",link:function(a,b,e){for(var f=[{id:11,x:410,y:10},{id:12,x:465,y:10},{id:13,x:410,y:85},{id:14,x:465,y:85},{id:15,x:410,y:140},{id:16,x:465,y:140},{id:17,x:410,y:215},{id:18,x:465,y:215}],g=[],h=0;5>h;h++)f.push({id:10-2*h,x:540,y:50*h+5*h+10}),f.push({id:10-2*h-1,x:595,y:50*h+5*h+10});var i=b[0].getContext("2d");for(i.canvas.height=400,i.canvas.width=800,h=0;h<f.length;h++){var j=new c;g.push(j),j.id=f[h].id,j.x=f[h].x,j.y=f[h].y,j.draw(i)}b[0].addEventListener("mousemove",function(a){for(var c=d(b[0],a),e=!1,f=0;f<g.length;f++)g[f].isPointInElement(c.x,c.y)&&(e=!0),document.body.style.cursor=e?"pointer":"default"}),b[0].addEventListener("click",function(a){for(var c=d(b[0],a),e=0;e<g.length;e++)g[e].active=!1,g[e].color="#AAAAAA",g[e].textColor="#000000",g[e].isPointInElement(c.x,c.y)&&(g[e].active=!0,g[e].color="#313131",g[e].textColor="#FFFFFF"),g[e].draw(i)})}}}]),angular.module("employeeApp").controller("ScannerCtrl",["$scope","$mdDialog","scanner","$timeout","Supply","$mdToast","Employee","$http","$rootScope","Equipment","PurchaseOrder","KeyboardNavigation","FileUploader","$log",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){var a=function(){$(".print").empty()};if(window.matchMedia){var b=window.matchMedia("print");b.addListener(function(b){b.matches?angular.noop():a()})}window.onafterprint=a,this.contentWindow.focus(),this.contentWindow.print()}var p=new l,q=!1;a.scanner=new c("supply-scanner-modal"),a.interfaceType="equipment",a.supplies=[],a.equipmentList=[],a.poList=k.query(),a.employees=g.query({limit:0,page_size:99999}),a.scanner.enable(),a.scanner.disableStandard(),a.tempUrl="http://mineolalionsclub.org/wp-content/uploads/2014/02/employee_placeholder.png",p.onenter=function(a){a.preventDefault()};try{window.globalScanner.disable()}catch(r){}a.fractSize=function(){return a.supply&&"pc"==a.supply.units?0:2},a.remove=function(b,c){a.supplies.splice(b,1)},a.removeItem=function(b){a.po.items[b].$$action=!1},a.addNewEquipment=function(){var b=new j;b.$new=!0,a.equipmentList.push(b)},a.createEquipment=function(a){if(a.id=a.id||void 0,a.$new){var b=a.id?"$update":"$create";a[b](function(){delete this.$new}.bind(a))}},a.addEquipmentImage=function(a,b){var c=m.upload(a,"/api/v1/supply/image/");c.then(function(a){b.image=a.hasOwnProperty("data")?a.data:a},function(){})},a.removeEquipment=function(b,c){a.equipmentList.splice(c,1)},a.addImage=function(b){var c=b.hasOwnProperty("data")?b.data:b;a.supply.image=c,a.supply.$update(function(){})},a.scanner.register(/^DRS-\d+$/,function(b){try{f.show(f.simple().hideDelay(3e3).position("top right").content("Looking up supply..."))}catch(c){}e.get({id:b.split("-")[1],country:i.country},function(b){f.hide(),-1==a.supplies.indexOfById(b)?(b.$$action="subtract",a.supplies.push(b),f.show(f.simple().hideDelay(2e3).position("top right").content("Added "+b.description+" to checkout."))):f.show(f.simple().hideDelay(2e3).position("top right").content(b.description+" already in checkout"))},function(a){var b=JSON.stringify(a);n.error(b),f.show(f.simple().hideDelay(0).position("top right").action("Close").content("Unable to find supply."))})}),a.scanner.register(/^\d+(\-\d+)*$/,function(b){try{f.show(f.simple().hideDelay(3e3).position("top right").content("Looking up supply..."))}catch(c){}e.query({upc:b,country:i.country},function(b){b[0].$$action="subtract",a.supplies.push(b[0]),f.hide(),f.show(f.simple().hideDelay(2e3).position("top right").content("Added "+b.description+" to checkout."))},function(a){var b=JSON.stringify(a);n.error(b)})}),a.scanner.register(/^PO-\d+$/,function(b){try{f.show(f.simple().hideDelay(3e3).position("top right").content("Looking up Purchase Order..."))}catch(c){}k.get({id:b.split("-")[1]},function(b){a.po=b,f.hide();for(var c=0;c<a.po.items.length;c++)a.po.items[c].$$action=!0},function(a){JSON.stringify(a);n.error(a)})}),a.scanner.register(/^DRE-\d+$/,function(b){f.show(f.simple().hideDelay(0).position("top right").action("Close").content("Looking up Equipment...")),j.get({id:b.split("-")[1]},function(b){f.hide(),a.equipmentList.push(b)},function(a){var b=JSON.stringify(a);n.error(b),f.show(f.simple().content("Unable to find equipment.").position("top right").action("Close").hideDelay(0))})}),a.scanner.register(/^DREM-\d+$/,function(b){f.hide(),f.show(f.simple().content("Looking up employee...").position("top right").action("close").hideDelay(0)),a.equipment=g.get({id:b.split("-")[1]},function(b){a.employee=b,f.hide()},function(a){var b=JSON.stringify(a);n.error(b),f.show(f.simple().content("Unable to find employee.").position("top right").action("close").hideDelay(0))})}),a.verify=function(){f.hide();for(var b=0;b<a.supplies.length;b++)if("subtract"==a.supplies[b].$$action&&a.supplies[b].$$quantity>a.supplies[b].quantity)throw Error(a.supplies[b].description+" quantity cannot be negative");return!0},a.checkout=function(){if(f.show(f.simple().position("top right").hideDelay(0).content("Processing checkout...")),!q){q=!0;try{a.verify();for(var b=angular.copy(a.supplies),c=0;c<b.length;c++)b[c].employee=angular.copy(a.employee),"subtract"==b[c].$$action?b[c].quantity-=b[c].$$quantity:"add"==b[c].$$action&&(b[c].quantity+=b[c].$$quantity);if(b.length>0){var d=h.put("/api/v1/supply/",b);d.success(function(){a.supplies=[],a.postCheckout()}).error(function(b){a.checkoutError(b)})}for(var e=0;e<a.equipmentList.length;e++)a.equipmentList[e].employee=angular.copy(a.employee);if(a.equipmentList.length>0){var g=h.put("/api/v1/equipment/",a.equipmentList);g.success(function(){a.equipmentList=[],a.postCheckout()}).error(function(b){a.checkoutError(b)})}}catch(i){n.error(i),q=!1,f.show(f.simple().position("top right").hideDelay(0).action("close").content(i.message))}if(a.po){for(var j=0;j<a.po.items.length;j++)a.po.items[j].$$action&&(a.po.items[j].status="Received");a.po.status="Received",a.po.$update(function(){delete a.po,a.postCheckout()},function(a){n.error(JSON.stringify(a))})}}},a.postCheckout=function(){0!==a.supplies.length||0!==a.equipmentList.length||a.po||(q=!1,a.employee=void 0,f.show(f.simple().position("top right").hideDelay(2e3).content("Checkout complete.")))},a.checkoutError=function(a){n.error(JSON.stringify(a)),f.show(f.simple().position("top right").hideDelay(0).action("Close").content("There was a checkout error"))},a.printEquipmentSticker=function(a){var b=$(".print").empty(),c=document.createElement("iframe");c.onload=o,c.src="api/v1/equipment/"+a.id+"/sticker/",b.append(c)},a.printSupplySticker=function(a){var b=$(".print").empty(),c=document.createElement("iframe");c.onload=o,c.src="api/v1/supply/"+a.id+"/sticker/",b.append(c)},a.$on("$destroy",function(){a.scanner.disable();try{window.globalScanner.enable()}catch(b){}})}]),angular.module("employeeApp").factory("ProductSupply",["$resource",function(a){return a("/api/v1/product/supply/:id/",{id:"@id"},{create:{method:"POST"},update:{method:"PUT"}})}]),angular.module("employeeApp.services").factory("number",["$q","$log",function(a,b){return{response:function(c){function d(a){f++;for(var b in a)"object"==typeof a[b]?d(a[b]):e.test(a[b])&&(a[b]=Number(a[b]));return a}var e=/^\d+(\.\d+)?$/,f=0;try{"object"==typeof c&&(c=d(c))}catch(g){b.warn(f)}return c||a.when(c)},responseError:function(b){return a.reject(b)}}}]).config(function(a){a.interceptors.push("number")});