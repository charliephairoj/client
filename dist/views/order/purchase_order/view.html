<div class="po-view-page view-page">

    <!--
        Workspace
    -->

    <div class="workspace">

		<md-toolbar layout="column" md-scroll-shrink="true">

			<div class="container" layout="row" layout-align="center center">
				<h3><span>Purchase Orders</span></h3>
				<div flex></div>

				<md-button class="md-icon-button md-primary md-raised" ng-href="#/order/purchase_order/create">
					<md-tooltip>
						Create New Purchase Order
					</md-tooltip>
					<i class="material-icons">create</i>
				</md-button>
				
				
				<input type="text" ng-model="query.$.$" class="search" />
			</div>
			
		</md-toolbar>


		<md-content>
			<div class="container">
				<md-card class="stage leads"  on-drop="updateStage($file, 'awaiting approval')">
					<md-card-title>
						<md-card-title-text>
							<h4>Waiting Approval</h4>
						</md-card-title-text>
					</md-card-title>
					<md-card-content>
						<div ng-repeat="po in poList | filter:{status:'awaiting approval'} | filter:query | orderBy:'-id' track by po.id">
							<purchase-order>
							</purchase-order>
						</div>
					</md-card-content>
					<md-card-actions>
						<h5>Amount: ฿{{getTotal('awaiting approval') | number}}</h5>
					</md-card-actions>
				</md-card>
				<md-card class="stage qualification" on-drop="updateStage($file, 'approved')">
					<md-card-title>
						<md-card-title-text>
							<h4>Approved</h4>
						</md-card-title-text>
					</md-card-title>
					<md-card-content>
						<div ng-repeat="po in poList | filter:{status:'approved'} | filter:query | orderBy:'-id' track by po.id">
								<purchase-order>
								</purchase-order>
						</div>
					</md-card-content>
					<md-card-actions>
						<h5>Amount: ฿{{getTotal('approved') | number}}</h5>
					</md-card-actions>
				</md-card>
				<md-card class="stage meeting"  on-drop="updateStage($file, 'awaiting deposit')">
					<md-card-title>
						<md-card-title-text>
							<h4>Awaiting Deposit</h4>
						</md-card-title-text>
					</md-card-title>
					<md-card-content>
						<div ng-repeat="po in poList | filter:{status:'awaiting deposit'} | filter:query | orderBy:'-id' track by po.id">
								<purchase-order>
								</purchase-order>
						</div>
					</md-card-content>
					<md-card-actions>
						<h5>Amount: ฿{{getTotal('awaiting deposit') | number}}</h5>
					</md-card-actions>
				</md-card>
				<md-card class="stage proposal" on-drop="updateStage($file, 'in production')">
					<md-card-title>
						<md-card-title-text>
							<h4>In Production</h4>
						</md-card-title-text>
					</md-card-title>
					<md-card-content>
						<div ng-repeat="po in poList | filter:{status:'in production'} | filter:query | orderBy:'-id' track by po.id">
								<purchase-order>
									</purchase-order>
						</div>
					</md-card-content>
					<md-card-actions>
						<h5>Amount: ฿{{getTotal('in production') | number}}</h5>
					</md-card-actions>
				</md-card>
				<md-card class="stage closed-won" on-drop="updateStage($file, 'received')">
					<md-card-title>
						<md-card-title-text>
							<h4>Received</h4>
						</md-card-title-text>
					</md-card-title>
					<md-card-content>
						<div ng-repeat="po in poList | filter:{status:'received'} | filter:query | orderBy:'-id' track by po.id">
							<purchase-order>
							</purchase-order>
						</div>
					</md-card-content>
					<md-card-actions>
						<h5>Amount: ฿{{getTotal('received') | number}}</h5>
					</md-card-actions>
				</md-card>
				<md-card class="stage closed-lost" on-drop="updateStage($file, 'invoiced')">
					<md-card-title>
						<md-card-title-text>
							<h4>Invoiced</h4>
						</md-card-title-text>
					</md-card-title>
					<md-card-content>
						<div ng-repeat="po in poList | filter:{status:'invoiced'} | filter:query | orderBy:'-id' track by po.id">
								<purchase-order>
									</purchase-order>
						</div>
					</md-card-content>
					<md-card-actions>
						<h5>Amount: ฿{{getTotal('invoiced') | number}}</h5>
					</md-card-actions>
				</md-card>
				<md-card class="stage closed-lost" on-drop="updateStage($file, 'closed')">
					<md-card-title>
						<md-card-title-text>
							<h4>Closed</h4>
						</md-card-title-text>
					</md-card-title>
					<md-card-content>
						<div ng-repeat="po in poList | filter:{status:'closed'} | filter:query | orderBy:'-id' track by po.id">
								<purchase-order>
									</purchase-order>
						</div>
					</md-card-content>
					<md-card-actions>
						<h5>Amount: ฿{{getTotal('closed') | number}}</h5>
					</md-card-actions>
				</md-card>
			</div>



				<!--
				<md-card class="po" ng-class="{'active': active}" ng-repeat="po in poList | filter: query track by po.id ">
					<md-card-title class="md-primary title" ng-show="active" layout="row" layout-align="center center">
						<md-card-title-text ng-click="active=false">
							<span>Purchase Order {{::po.id}}</span>
						</md-card-title-text>
						<div class="filler" flex ng-click="active=false"></div>
						<md-button class="md-icon-button md-raised md-primary" ng-click="update(po)" ng-disabled="::!currentUser.hasPermission('change_acknowledgement')">
							<md-tooltip>Save</md-tooltip>
							<i class="material-icons">save</i>
						</md-button>
						<md-button class="md-icon-button" ng-click="active=false">
							<md-tooltip>Minimize</md-tooltip>
							<i class="material-icons">expand_less</i>
						</md-button>
					</md-card-title>
					<md-card-content>
						<div class="background-switch" ng-click="active=false"></div>
			    		<div class="item-preview-container" ng-hide="active">
		    				<div class="item" ng-class="{'selected':po.$selected}" ng-click="active=true">
								<div class="id">{{::po.id}}</div>
								<div class="order-date">{{::po.order_date | date: "MMM d, yyyy"}}</div>
								<div class="customer">{{::po.supplier.name}}</div>
								<div class="project-id">{{::po.project.id}}</div>
								<div class="project">{{::po.project.codename}}</div>
								<div class="delivery-date">{{po.receive_date | date: "MMM d, yyyy"}}</div>
								<div class="paid-date">{{po.paid_date | date: "MMM d, yyyy"}}</div>
								<div class="total">{{po.grand_total | number:2}}</div>
								<div class="status" ng-class="po.status.toLowerCase()">{{po.status}}</div>

							</div>
						</div>
						<div class="item-container" ng-if="active">
						  	<section layout="row">
								<md-card class="summary">
									<md-card-content>
										<table>
											<tr>
												<td>Supplier</td>
												<td><a ng-href="#/contact/supplier/{{po.supplier.id}}">{{po.supplier.name}}</a></td>
											</tr>
											<tr ng-if="::ack.supplier.telephone">
												<td>Telephone</td>
												<td>{{po.supplier.telephone}}</td>
											</tr>
											<tr ng-if="::ack.supplier.fax">
												<td>Fax</td>
												<td>{{po.supplier.fax}}</td>
											</tr>
											<tr ng-if="::ack.supplier.email">
												<td>Email</td>
												<td>{{po.supplier.email}}</td>
											</tr>
											<tr ng-if="::ack.supplier.website">
												<td>Website</td>
												<td>{{po.supplier.website}}</td>
											</tr>
											<tr>
												<td>Acknowledged By</td>
												<td>{{po.employee.name}}</td>
											</tr>
											<tr>
												<td>Delivery Date</td>
												<td><md-datepicker ng-model="po.receive_date"></md-datepicker></td>
											</tr>
											<tr>
												<td>Order Status</td>
												<td>
											        <md-select ng-model="po.status" ng-disabled="::!currentUser.hasPermission('change_purchaseorder')">
														<md-option value='Processed'>Processed</md-option>
														<md-option value='deposited'>Deposited</md-option>
														<md-option value='received'>Received</md-option>
														<md-option value='invoiced'>Invoiced</md-option>
														<md-option value='paid'>Paid</md-option>
														<md-option value='cancelled'>Cancelled</md-option>
											        </md-select>
												</td>
											</tr>
											<tr>
												<td>Terms</td>
												<td><input type="number" ng-model="po.terms"/></td>
											</tr>
											<tr>
													<td>Discount</td>
													<td><input type="number" ng-model="po.discount"/></td>
												</tr>
											<tr>
												<td>VAT</td>
												<td><input type="number" ng-model="po.vat"/></td>
											</tr>
											<tr>
													<td>Deposit</td>
													<td><input type="number" ng-model="po.deposit"/></td>
												</tr>
											<tr>
												<td>Project</td>
												<td><a ng-href="#/project/{{po.project.id}}">{{po.project.name}}</a></td>
											</tr>
											<tr>
												<td>Room</td>
												<td><a ng-href="#/project/{{po.project.id}}">{{po.room.description}}</a></td>
											</tr>
											<tr>
												<td>Phase</td>
												<td><a ng-href="#/project/{{po.project.id}}">{{po.phase.description}}</a></td>
											</tr>
											<tr>
												<td>Remarks</td>
												<td>
													<textarea ng-model="po.remarks">
													</textarea>
												</td>
											</tr>
										</table>
									</md-card-content>
								</md-card>

								<section class="files" file-drop="addFiles($files, ack)" file-drop-class="files-drag-active">
									<div class="files">
		  								<md-card class="file" ng-repeat="file in [po.pdf]" ng-class="{'uploaded': file.id}" ng-click="openAttachment(file.url)">
		  						        	<md-card-title>
		  						          		<md-card-title-text layout="row">
													<i class="material-icons">attachment</i>
		  						            		<span class="md-headline">{{file.filename}}</span>
		  						          	  	</md-card-title-text>
		  						        	</md-card-title>
		  						      	</md-card>
									</div>
								</section>
							</section>

							<div class="status-bar">
								<div class="event processed" ng-class="{'active': hasEvent(po, 'processed') || hasEvent(po, 'acknowledged')}">
									<span>Processed</span>
									<div class="arrow"></div>
									<div class="arrow2"></div>
								</div>
								<div class="event deposited" ng-class="{'active': hasEvent(po, 'deposited')}">
									<span>Deposited</span>
									<div class="arrow"></div>
									<div class="arrow2"></div>
								</div>
								<div class="event received" ng-class="{'active': hasEvent(po, 'received')}">
									<span>Received</span>
									<div class="arrow"></div>
									<div class="arrow2"></div>
								</div>

								<div class="event invoiced" ng-class="{'active': hasEvent(po, 'invoice')}">
									<span>Invoiced</span>
									<div class="arrow"></div>
									<div class="arrow2"></div>
								</div>
								<div class="event paid" ng-class="{'active': hasEvent(po, 'paid')}">
									<span>Paid</span>
									<div class="arrow"></div>
									<div class="arrow2"></div>
								</div>
							</div>

							<section>
								<div class="items">
									<md-card class="add-product" layout="row" layout-align="start center">
										<md-card-actions layout="column" layout-align="center center">
											<md-button class="add md-accent md-raised md-icon-button" ng-click="addItem(po, selectedSupply || {description: supplySearchText});supplySearchText=''">
												<md-tooltip>Add Product</md-tooltip>
												<i class="material-icons">add_shopping_cart</i>
											</md-button>
											<md-button class="add md-accent md-raised md-icon-button" ng-click="listView=true">
												<md-tooltip>View as List</md-tooltip>
												<i class="material-icons"><i class="material-icons">list</i></i>
											</md-button>
											<md-button class="add md-accent md-raised md-icon-button" ng-click="listView=false">
												<md-tooltip>View as Cards</md-tooltip>
												<i class="material-icons"><i class="material-icons">view_module</i></i>
											</md-button>
								        </md-card-actions>
										<md-card-content layout="row" layout-align="start center" flex="auto">
											<md-autocomplete flex required
												md-items="supply in searchSupplies(supplySearchText)"
												md-search-text-change="retrieveSupplies(supplySearchText)"
												md-selected-item="selectedSupply"
												md-search-text="supplySearchText"
												md-item-text="supply.description"
												md-no-cache="true"
												md-floating-label="Supply Description"
												md-min-length="0">
											    <md-item-template>
											    	<span md-highlight-text="supplySearchText">{{supply.description}}</span>
											    </md-item-template>
											</md-autocomplete>
										</md-card-content>
										<md-card-title-media>
											<div class="md-media-md card-media">
												<img ng-src="{{tempProduct.image.url}}">
											</div>
										</md-card-title-media>
									</md-card>

									<md-card class="item" ng-repeat="item in po.items" ng-show="!listView">
										<md-card-title layout="row" layout-align="center center">
								          	<md-card-title-text>
								            	<span class="md-headline">{{::item.description}}</span>
								          	</md-card-title-text>
											<md-button class="md-icon-button md-warn md-raised" ng-click="removeItem(po, $index)">
												<i class="material-icons">remove</i>
											</md-button>
								        </md-card-title>
										<md-card-content layout="row">
											<div class="product-container">
												<table class="product-details">
													<tr>
														<td>
															<span>Description</span>
														</td>
														<td>
															<input name="description" type="text" size="60" ng-model="item.description" required />
														</td>

													</tr>
													<tr>
														<td>
															<span>Quantity</span>
														</td>
														<td>
															<input name="quantity" type="number" ng-model="item.quantity" min="0" required />
														</td>
													<tr>
														<td>
															<span>Unit Price<span>
														</td>
														<td>
															<input name="price" type="number" ng-model="item.unit_cost" required />
														</td>
													</tr>
													<tr>
														<td>
															<span>Discount<span>
														</td>
														<td>
															<input name="discount" type="number" ng-model="item.discount" required />
														</td>
													</tr>
                                                    <tr>
														<td>
															<span>Item Total<span>
														</td>
														<td>
															{{(item.unit_cost * item.quantity) * (1.00 - (item.discount/100))}}
														</td>
													</tr>
													<tr>
														<td>
															<span>Width(mm)<span>
														</td>
														<td>
															<input type="number" ng-model="item.width" min="0" required />
														</td>
													</tr>
													<tr>
														<td>
															<span>Depth(mm)<span>
														</td>
														<td>
															<input type="number" ng-model="item.depth" min="0" required />
														</td>
													</tr>
													<tr>
														<td>
															<span>Height(mm)<span>
														</td>
														<td>
															<input type="number" ng-model="item.height" min="0" required />
														</td>
													</tr>

													<tr>
														<td><span>Fabric Image</span></td>
														<td>
															<img ng-src="{{pillow.fabric.image.url}}" />
														</td>
													</tr>
													<tr>
														<td><span>Remarks</span></td>
														<td>
															<textarea ng-model="item.comments"></textarea>
														</td>
													</tr>
												</table>
												<div class="img-container">
													<img ng-src="{{item.image.url}}">
												</div>
											</div>
										</md-card-content>
									</md-card>

									<md-card class="order-details" ng-show="listView && po.items">
						            	<md-card-content>
											<table ng-show="po.items">
												<thead>
													<tr class='heading'>
														<td>Description</td>
														<td>Comments</td>
														<td>Discount</td>
														<td>Unit Cost</td>
														<td>Quantity</td>
														<td colspan="2">Total</td>
													</tr>
												</thead>
												<tbody>
													<tr class="items" ng-repeat="item in po.items">
														<td class='description'>{{::item.description}}</td>
														<td><textarea ng-model=item.comments row="4"></textarea></td>
														<td class='discount'>
															<input required type="number" min="0" ng-model="item.discount"/>
														</td>
														<td class='unit-cost'><input required min="0" type="number" ng-model="item.cost" /></td>
														<td class='quantity'>
															<input required type="number" min="0" ng-model="item.quantity" />
														</td>
														<td class='total'>{{unitCost(item.cost, item.discount) * item.quantity || 0 | number:2}}</td>
														<td>
															<md-button class="md-icon-button md-warn md-raised" ng-click="removeItem(po, $index)">
																<i class="material-icons">remove</i>
															</md-button>
														</td>
													</tr>
													<tr class="summary subtotal">
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td class="title">Subtotal</td>
														<td class="value">{{subtotal() || 0 | number:2}}</td>
														<td></td>
													</tr>
													<tr class="summary discount" ng-show="po.discount">
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td class="title">Discount {{po.discount}}%</td>
														<td class="value">-{{discount() || 0 | number:2}}</td>
														<td></td>
													</tr>
													<tr class="summary total" ng-show="po.discount">
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td class="title">Total</td>
														<td class="value"> {{total() || 0 | number:2}}</td>
														<td></td>
													</tr>
													<tr class="summary vat" ng-show="po.vat">
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td class="title">Vat {{po.vat}}%</td>
														<td class="value">{{total() * (po.vat / 100) || 0 | number:2}}</td>
														<td></td>
													</tr>
													<tr class="summary grand-total" ng-show="po.vat">
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td class="title">Grand Total</td>
														<td class="value">{{grandTotal() || 0 | number:2}}</td>
														<td></td>
													</tr>
												</tbody>
											</table>
										</md-card-content>
						            </md-card>
								</div>
							</section>

						</div>
				
					</md-card-content>

				</md-card>
			-->

		</md-content>

    </div>

</div>
